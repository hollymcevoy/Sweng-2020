"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = useTrackTiming;

var _react = require("react");

var _createCustomEvent = _interopRequireDefault(require("../utils/createCustomEvent"));

var _randomId = _interopRequireDefault(require("../utils/randomId"));

var _useReadTelemetryDimensions = _interopRequireDefault(require("./internal/useReadTelemetryDimensions"));

var _useTrackException = _interopRequireDefault(require("./useTrackException"));

var _useWebChatAPIContext2 = _interopRequireDefault(require("./internal/useWebChatAPIContext"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function useTrackTiming() {
  var _useWebChatAPIContext = (0, _useWebChatAPIContext2.default)(),
      onTelemetry = _useWebChatAPIContext.onTelemetry;

  var readTelemetryDimensions = (0, _useReadTelemetryDimensions.default)();
  var trackException = (0, _useTrackException.default)();
  return (0, _react.useCallback)( /*#__PURE__*/function () {
    var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(name, functionOrPromise) {
      var timingId, startTime, duration;
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              if (!(!name || typeof name !== 'string')) {
                _context.next = 4;
                break;
              }

              return _context.abrupt("return", console.warn('botframework-webchat: "name" passed to "useTrackTiming" hook must be specified and of type string.'));

            case 4:
              if (!(typeof functionOrPromise !== 'function' && typeof functionOrPromise.then !== 'function')) {
                _context.next = 6;
                break;
              }

              return _context.abrupt("return", console.warn('botframework-webchat: "functionOrPromise" passed to "useTrackTiming" hook must be specified, of type function or Promise.'));

            case 6:
              timingId = (0, _randomId.default)();
              onTelemetry && onTelemetry((0, _createCustomEvent.default)('timingstart', {
                dimensions: readTelemetryDimensions(),
                name: name,
                timingId: timingId
              }));
              startTime = Date.now();
              _context.prev = 9;
              _context.next = 12;
              return typeof functionOrPromise === 'function' ? functionOrPromise() : functionOrPromise;

            case 12:
              return _context.abrupt("return", _context.sent);

            case 15:
              _context.prev = 15;
              _context.t0 = _context["catch"](9);
              trackException(_context.t0, false);
              throw _context.t0;

            case 19:
              _context.prev = 19;
              duration = Date.now() - startTime;
              onTelemetry && onTelemetry((0, _createCustomEvent.default)('timingend', {
                dimensions: readTelemetryDimensions(),
                duration: duration,
                name: name,
                timingId: timingId
              }));
              return _context.finish(19);

            case 23:
            case "end":
              return _context.stop();
          }
        }
      }, _callee, null, [[9, 15, 19, 23]]);
    }));

    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }(), [onTelemetry, readTelemetryDimensions, trackException]);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ob29rcy91c2VUcmFja1RpbWluZy50cyJdLCJuYW1lcyI6WyJ1c2VUcmFja1RpbWluZyIsIm9uVGVsZW1ldHJ5IiwicmVhZFRlbGVtZXRyeURpbWVuc2lvbnMiLCJ0cmFja0V4Y2VwdGlvbiIsIm5hbWUiLCJmdW5jdGlvbk9yUHJvbWlzZSIsImNvbnNvbGUiLCJ3YXJuIiwidGhlbiIsInRpbWluZ0lkIiwiZGltZW5zaW9ucyIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJkdXJhdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVlLFNBQVNBLGNBQVQsR0FHUTtBQUNyQiw4QkFBd0IscUNBQXhCO0FBQUEsTUFBUUMsV0FBUix5QkFBUUEsV0FBUjs7QUFDQSxNQUFNQyx1QkFBdUIsR0FBRywwQ0FBaEM7QUFDQSxNQUFNQyxjQUFjLEdBQUcsaUNBQXZCO0FBRUEsU0FBTztBQUFBLHVFQUNMLGlCQUFPQyxJQUFQLEVBQWFDLGlCQUFiO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLG9CQUNNLENBQUNELElBQUQsSUFBUyxPQUFPQSxJQUFQLEtBQWdCLFFBRC9CO0FBQUE7QUFBQTtBQUFBOztBQUFBLCtDQUVXRSxPQUFPLENBQUNDLElBQVIsQ0FDTCxvR0FESyxDQUZYOztBQUFBO0FBQUEsb0JBS2EsT0FBT0YsaUJBQVAsS0FBNkIsVUFBN0IsSUFBMkMsT0FBT0EsaUJBQWlCLENBQUNHLElBQXpCLEtBQWtDLFVBTDFGO0FBQUE7QUFBQTtBQUFBOztBQUFBLCtDQU1XRixPQUFPLENBQUNDLElBQVIsQ0FDTCwySEFESyxDQU5YOztBQUFBO0FBV1FFLGNBQUFBLFFBWFIsR0FXbUIsd0JBWG5CO0FBYUVSLGNBQUFBLFdBQVcsSUFDVEEsV0FBVyxDQUNULGdDQUFrQixhQUFsQixFQUFpQztBQUMvQlMsZ0JBQUFBLFVBQVUsRUFBRVIsdUJBQXVCLEVBREo7QUFFL0JFLGdCQUFBQSxJQUFJLEVBQUpBLElBRitCO0FBRy9CSyxnQkFBQUEsUUFBUSxFQUFSQTtBQUgrQixlQUFqQyxDQURTLENBRGI7QUFTTUUsY0FBQUEsU0F0QlIsR0FzQm9CQyxJQUFJLENBQUNDLEdBQUwsRUF0QnBCO0FBQUE7QUFBQTtBQUFBLHFCQXlCa0IsT0FBT1IsaUJBQVAsS0FBNkIsVUFBN0IsR0FBMENBLGlCQUFpQixFQUEzRCxHQUFnRUEsaUJBekJsRjs7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTtBQTJCSUYsY0FBQUEsY0FBYyxjQUFNLEtBQU4sQ0FBZDtBQTNCSjs7QUFBQTtBQUFBO0FBK0JVVyxjQUFBQSxRQS9CVixHQStCcUJGLElBQUksQ0FBQ0MsR0FBTCxLQUFhRixTQS9CbEM7QUFpQ0lWLGNBQUFBLFdBQVcsSUFDVEEsV0FBVyxDQUNULGdDQUFrQixXQUFsQixFQUErQjtBQUM3QlMsZ0JBQUFBLFVBQVUsRUFBRVIsdUJBQXVCLEVBRE47QUFFN0JZLGdCQUFBQSxRQUFRLEVBQVJBLFFBRjZCO0FBRzdCVixnQkFBQUEsSUFBSSxFQUFKQSxJQUg2QjtBQUk3QkssZ0JBQUFBLFFBQVEsRUFBUkE7QUFKNkIsZUFBL0IsQ0FEUyxDQURiO0FBakNKOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEtBREs7O0FBQUE7QUFBQTtBQUFBO0FBQUEsT0E2Q0wsQ0FBQ1IsV0FBRCxFQUFjQyx1QkFBZCxFQUF1Q0MsY0FBdkMsQ0E3Q0ssQ0FBUDtBQStDRCIsInNvdXJjZVJvb3QiOiJjb21wb25lbnQ6Ly8vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCBjcmVhdGVDdXN0b21FdmVudCBmcm9tICcuLi91dGlscy9jcmVhdGVDdXN0b21FdmVudCc7XG5pbXBvcnQgcmFuZG9tSWQgZnJvbSAnLi4vdXRpbHMvcmFuZG9tSWQnO1xuaW1wb3J0IHVzZVJlYWRUZWxlbWV0cnlEaW1lbnNpb25zIGZyb20gJy4vaW50ZXJuYWwvdXNlUmVhZFRlbGVtZXRyeURpbWVuc2lvbnMnO1xuaW1wb3J0IHVzZVRyYWNrRXhjZXB0aW9uIGZyb20gJy4vdXNlVHJhY2tFeGNlcHRpb24nO1xuaW1wb3J0IHVzZVdlYkNoYXRBUElDb250ZXh0IGZyb20gJy4vaW50ZXJuYWwvdXNlV2ViQ2hhdEFQSUNvbnRleHQnO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiB1c2VUcmFja1RpbWluZzxUPigpOiAoXG4gIG5hbWU6IHN0cmluZyxcbiAgZnVuY3Rpb25PclByb21pc2U6ICgoKSA9PiBUKSB8IFByb21pc2U8VD5cbikgPT4gUHJvbWlzZTxUIHwgdm9pZD4ge1xuICBjb25zdCB7IG9uVGVsZW1ldHJ5IH0gPSB1c2VXZWJDaGF0QVBJQ29udGV4dCgpO1xuICBjb25zdCByZWFkVGVsZW1ldHJ5RGltZW5zaW9ucyA9IHVzZVJlYWRUZWxlbWV0cnlEaW1lbnNpb25zKCk7XG4gIGNvbnN0IHRyYWNrRXhjZXB0aW9uID0gdXNlVHJhY2tFeGNlcHRpb24oKTtcblxuICByZXR1cm4gdXNlQ2FsbGJhY2soXG4gICAgYXN5bmMgKG5hbWUsIGZ1bmN0aW9uT3JQcm9taXNlKSA9PiB7XG4gICAgICBpZiAoIW5hbWUgfHwgdHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oXG4gICAgICAgICAgJ2JvdGZyYW1ld29yay13ZWJjaGF0OiBcIm5hbWVcIiBwYXNzZWQgdG8gXCJ1c2VUcmFja1RpbWluZ1wiIGhvb2sgbXVzdCBiZSBzcGVjaWZpZWQgYW5kIG9mIHR5cGUgc3RyaW5nLidcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGZ1bmN0aW9uT3JQcm9taXNlICE9PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBmdW5jdGlvbk9yUHJvbWlzZS50aGVuICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oXG4gICAgICAgICAgJ2JvdGZyYW1ld29yay13ZWJjaGF0OiBcImZ1bmN0aW9uT3JQcm9taXNlXCIgcGFzc2VkIHRvIFwidXNlVHJhY2tUaW1pbmdcIiBob29rIG11c3QgYmUgc3BlY2lmaWVkLCBvZiB0eXBlIGZ1bmN0aW9uIG9yIFByb21pc2UuJ1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0aW1pbmdJZCA9IHJhbmRvbUlkKCk7XG5cbiAgICAgIG9uVGVsZW1ldHJ5ICYmXG4gICAgICAgIG9uVGVsZW1ldHJ5KFxuICAgICAgICAgIGNyZWF0ZUN1c3RvbUV2ZW50KCd0aW1pbmdzdGFydCcsIHtcbiAgICAgICAgICAgIGRpbWVuc2lvbnM6IHJlYWRUZWxlbWV0cnlEaW1lbnNpb25zKCksXG4gICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgdGltaW5nSWRcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuXG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gYXdhaXQgKHR5cGVvZiBmdW5jdGlvbk9yUHJvbWlzZSA9PT0gJ2Z1bmN0aW9uJyA/IGZ1bmN0aW9uT3JQcm9taXNlKCkgOiBmdW5jdGlvbk9yUHJvbWlzZSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgdHJhY2tFeGNlcHRpb24oZXJyLCBmYWxzZSk7XG5cbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICAgIG9uVGVsZW1ldHJ5ICYmXG4gICAgICAgICAgb25UZWxlbWV0cnkoXG4gICAgICAgICAgICBjcmVhdGVDdXN0b21FdmVudCgndGltaW5nZW5kJywge1xuICAgICAgICAgICAgICBkaW1lbnNpb25zOiByZWFkVGVsZW1ldHJ5RGltZW5zaW9ucygpLFxuICAgICAgICAgICAgICBkdXJhdGlvbixcbiAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgdGltaW5nSWRcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFtvblRlbGVtZXRyeSwgcmVhZFRlbGVtZXRyeURpbWVuc2lvbnMsIHRyYWNrRXhjZXB0aW9uXVxuICApO1xufVxuIl19