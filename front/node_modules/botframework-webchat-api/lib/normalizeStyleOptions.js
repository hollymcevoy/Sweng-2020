"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = normalizeStyleOptions;

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _defaultStyleOptions = _interopRequireDefault(require("./defaultStyleOptions"));

var _excluded = ["hideScrollToEndButton", "newMessagesButtonFontSize"];

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }

function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }

var hideScrollToEndButtonDeprecation = (0, _botframeworkWebchatCore.warnOnce)('"styleOptions.hideScrollToEndButton" has been deprecated. To hide scroll to end button, set "scrollToEndBehavior" to false. This deprecation migration will be removed on or after 2023-06-02.');
var newMessagesButtonFontSizeDeprecation = (0, _botframeworkWebchatCore.warnOnce)('"styleOptions.newMessagesButtonFontSize" has been renamed to "styleOptions.scrollToEndButtonFontSize". This deprecation migration will be removed on or after 2023-06-02.');
var suggestedActionBackgroundDeprecation = (0, _botframeworkWebchatCore.warnOnce)('"styleOptions.suggestedActionBackground" has been deprecated. Please use "styleOptions.suggestedActionBackgroundColor" instead. This deprecation migration will be removed on or after 2021-09-16.');
var suggestedActionXXXBackgroundDeprecation = (0, _botframeworkWebchatCore.warnOnce)('"styleOptions.suggestedActionXXXBackground" has been deprecated. Please use "styleOptions.suggestedActionBackgroundColorOnXXX" instead. This deprecation migration will be removed on or after 2021-09-16.');
var suggestedActionDisabledDeprecation = (0, _botframeworkWebchatCore.warnOnce)('"styleOptions.suggestedActionDisabledXXX" has been renamed to "styleOptions.suggestedActionXXXOnDisabled". This deprecation migration will be removed on or after 2021-09-16.'); // TODO: [P4] We should add a notice for people who want to use "styleSet" instead of "styleOptions".
//       "styleSet" is actually CSS stylesheet and it is based on the DOM tree.
//       DOM tree may change from time to time, thus, maintaining "styleSet" becomes a constant effort.
// eslint-disable-next-line complexity

function normalizeStyleOptions() {
  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  var hideScrollToEndButton = _ref.hideScrollToEndButton,
      newMessagesButtonFontSize = _ref.newMessagesButtonFontSize,
      options = _objectWithoutProperties(_ref, _excluded);

  var filledOptions = _objectSpread(_objectSpread({}, _defaultStyleOptions.default), options); // Keep this list flat (no nested style) and serializable (no functions)


  var bubbleFromUserNubOffset = filledOptions.bubbleFromUserNubOffset,
      bubbleNubOffset = filledOptions.bubbleNubOffset,
      emojiSet = filledOptions.emojiSet;
  var normalizedBubbleFromUserNubOffset;
  var normalizedBubbleNubOffset;
  var normalizedEmojiSet;

  if (bubbleFromUserNubOffset === 'top') {
    normalizedBubbleFromUserNubOffset = 0;
  } else if (typeof bubbleFromUserNubOffset !== 'number') {
    normalizedBubbleFromUserNubOffset = -0;
  } else {
    normalizedBubbleFromUserNubOffset = bubbleFromUserNubOffset;
  }

  if (bubbleNubOffset === 'top') {
    normalizedBubbleNubOffset = 0;
  } else if (typeof bubbleNubOffset !== 'number') {
    normalizedBubbleNubOffset = -0;
  } else {
    normalizedBubbleNubOffset = bubbleNubOffset;
  }

  if (emojiSet === true) {
    normalizedEmojiSet = {
      ':)': '😊',
      ':-)': '😊',
      '(:': '😊',
      '(-:': '😊',
      ':-|': '😐',
      ':|': '😐',
      ':-(': '☹️',
      ':(': '☹️',
      ':-D': '😀',
      ':D': '😀',
      ':-p': '😛',
      ':p': '😛',
      ':-P': '😛',
      ':P': '😛',
      ':-o': '😲',
      ':o': '😲',
      ':O': '😲',
      ':-O': '😲',
      ':-0': '😲',
      ':0': '😲',
      ';-)': '😉',
      ';)': '😉',
      '<3': '❤️',
      '</3': '💔',
      '<\\3': '💔'
    };
  } else if (Object.prototype.toString.call(emojiSet) !== '[object Object]') {
    console.warn('botframework-webchat: emojiSet must be a boolean or an object with emoticon: emojiValues');
    normalizedEmojiSet = false;
  } else {
    normalizedEmojiSet = emojiSet;
  }

  if (hideScrollToEndButton) {
    hideScrollToEndButtonDeprecation(); // Only set if the "scrollToEndButtonBehavior" is not set.
    // If it has been set, the developer should know the older "hideScrollToEndButton" option is deprecated.

    filledOptions.scrollToEndButtonBehavior = options.scrollToEndButtonBehavior || false;
  }

  var patchedScrollToEndButtonBehavior = filledOptions.scrollToEndButtonBehavior;

  if (patchedScrollToEndButtonBehavior !== 'any' && patchedScrollToEndButtonBehavior !== false) {
    patchedScrollToEndButtonBehavior === 'unread' || console.warn('Web Chat: "scrollToEndButtonBehavior" must be either "unread", "any", or false, will set to "unread".');
    patchedScrollToEndButtonBehavior = 'unread';
  }

  if (newMessagesButtonFontSize) {
    newMessagesButtonFontSizeDeprecation(); // Only set if the "scrollToEndButtonFontSize" is not set.

    filledOptions.scrollToEndButtonFontSize = options.scrollToEndButtonFontSize || newMessagesButtonFontSize;
  }

  options.suggestedActionBackground && suggestedActionBackgroundDeprecation();

  if (options.suggestedActionActiveBackground) {
    suggestedActionXXXBackgroundDeprecation();
    filledOptions.suggestedActionBackgroundColorOnActive = options.suggestedActionBackgroundColorOnActive || options.suggestedActionActiveBackground;
  }

  if (options.suggestedActionFocusBackground) {
    suggestedActionXXXBackgroundDeprecation();
    filledOptions.suggestedActionBackgroundColorOnFocus = options.suggestedActionBackgroundColorOnFocus || options.suggestedActionFocusBackground;
  }

  if (options.suggestedActionHoverBackground) {
    suggestedActionXXXBackgroundDeprecation();
    filledOptions.suggestedActionBackgroundColorOnHover = options.suggestedActionBackgroundColorOnHover || options.suggestedActionHoverBackground;
  }

  if (options.suggestedActionDisabledBackground) {
    suggestedActionXXXBackgroundDeprecation();
    filledOptions.suggestedActionBackgroundColorOnDisabled = options.suggestedActionBackgroundColorOnDisabled || options.suggestedActionDisabledBackground;
  }

  if (options.suggestedActionDisabledBorderColor) {
    suggestedActionDisabledDeprecation();
    filledOptions.suggestedActionBorderColorOnDisabled = options.suggestedActionBorderColorOnDisabled || options.suggestedActionDisabledBorderColor;
  }

  if (options.suggestedActionDisabledBorderStyle) {
    suggestedActionDisabledDeprecation();
    filledOptions.suggestedActionBorderStyleOnDisabled = options.suggestedActionBorderStyleOnDisabled || options.suggestedActionDisabledBorderStyle;
  }

  if (options.suggestedActionDisabledBorderWidth) {
    suggestedActionDisabledDeprecation();
    filledOptions.suggestedActionBorderWidthOnDisabled = options.suggestedActionBorderWidthOnDisabled || options.suggestedActionDisabledBorderWidth;
  }

  if (options.suggestedActionDisabledTextColor) {
    suggestedActionDisabledDeprecation();
    filledOptions.suggestedActionTextColorOnDisabled = options.suggestedActionTextColorOnDisabled || options.suggestedActionDisabledTextColor;
  }

  return _objectSpread(_objectSpread({}, filledOptions), {}, {
    bubbleFromUserNubOffset: normalizedBubbleFromUserNubOffset,
    bubbleNubOffset: normalizedBubbleNubOffset,
    emojiSet: normalizedEmojiSet,
    scrollToEndButtonBehavior: patchedScrollToEndButtonBehavior
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9ub3JtYWxpemVTdHlsZU9wdGlvbnMudHMiXSwibmFtZXMiOlsiaGlkZVNjcm9sbFRvRW5kQnV0dG9uRGVwcmVjYXRpb24iLCJuZXdNZXNzYWdlc0J1dHRvbkZvbnRTaXplRGVwcmVjYXRpb24iLCJzdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kRGVwcmVjYXRpb24iLCJzdWdnZXN0ZWRBY3Rpb25YWFhCYWNrZ3JvdW5kRGVwcmVjYXRpb24iLCJzdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZERlcHJlY2F0aW9uIiwibm9ybWFsaXplU3R5bGVPcHRpb25zIiwiaGlkZVNjcm9sbFRvRW5kQnV0dG9uIiwibmV3TWVzc2FnZXNCdXR0b25Gb250U2l6ZSIsIm9wdGlvbnMiLCJmaWxsZWRPcHRpb25zIiwiZGVmYXVsdFN0eWxlT3B0aW9ucyIsImJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0IiwiYnViYmxlTnViT2Zmc2V0IiwiZW1vamlTZXQiLCJub3JtYWxpemVkQnViYmxlRnJvbVVzZXJOdWJPZmZzZXQiLCJub3JtYWxpemVkQnViYmxlTnViT2Zmc2V0Iiwibm9ybWFsaXplZEVtb2ppU2V0IiwiT2JqZWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJjYWxsIiwiY29uc29sZSIsIndhcm4iLCJzY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yIiwicGF0Y2hlZFNjcm9sbFRvRW5kQnV0dG9uQmVoYXZpb3IiLCJzY3JvbGxUb0VuZEJ1dHRvbkZvbnRTaXplIiwic3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZCIsInN1Z2dlc3RlZEFjdGlvbkFjdGl2ZUJhY2tncm91bmQiLCJzdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kQ29sb3JPbkFjdGl2ZSIsInN1Z2dlc3RlZEFjdGlvbkZvY3VzQmFja2dyb3VuZCIsInN1Z2dlc3RlZEFjdGlvbkJhY2tncm91bmRDb2xvck9uRm9jdXMiLCJzdWdnZXN0ZWRBY3Rpb25Ib3ZlckJhY2tncm91bmQiLCJzdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kQ29sb3JPbkhvdmVyIiwic3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWRCYWNrZ3JvdW5kIiwic3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZENvbG9yT25EaXNhYmxlZCIsInN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkQm9yZGVyQ29sb3IiLCJzdWdnZXN0ZWRBY3Rpb25Cb3JkZXJDb2xvck9uRGlzYWJsZWQiLCJzdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZEJvcmRlclN0eWxlIiwic3VnZ2VzdGVkQWN0aW9uQm9yZGVyU3R5bGVPbkRpc2FibGVkIiwic3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWRCb3JkZXJXaWR0aCIsInN1Z2dlc3RlZEFjdGlvbkJvcmRlcldpZHRoT25EaXNhYmxlZCIsInN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkVGV4dENvbG9yIiwic3VnZ2VzdGVkQWN0aW9uVGV4dENvbG9yT25EaXNhYmxlZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOzs7Ozs7Ozs7Ozs7Ozs7O0FBR0EsSUFBTUEsZ0NBQWdDLEdBQUcsdUNBQ3ZDLGdNQUR1QyxDQUF6QztBQUlBLElBQU1DLG9DQUFvQyxHQUFHLHVDQUMzQywyS0FEMkMsQ0FBN0M7QUFJQSxJQUFNQyxvQ0FBb0MsR0FBRyx1Q0FDM0Msb01BRDJDLENBQTdDO0FBSUEsSUFBTUMsdUNBQXVDLEdBQUcsdUNBQzlDLDRNQUQ4QyxDQUFoRDtBQUlBLElBQU1DLGtDQUFrQyxHQUFHLHVDQUN6QywrS0FEeUMsQ0FBM0MsQyxDQUlBO0FBQ0E7QUFDQTtBQUVBOztBQUNlLFNBQVNDLHFCQUFULEdBSTJCO0FBQUEsaUZBQXhCLEVBQXdCOztBQUFBLE1BSHhDQyxxQkFHd0MsUUFIeENBLHFCQUd3QztBQUFBLE1BRnhDQyx5QkFFd0MsUUFGeENBLHlCQUV3QztBQUFBLE1BRHJDQyxPQUNxQzs7QUFDeEMsTUFBTUMsYUFBcUMsbUNBQVFDLDRCQUFSLEdBQWdDRixPQUFoQyxDQUEzQyxDQUR3QyxDQUd4Qzs7O0FBQ0EsTUFBUUcsdUJBQVIsR0FBK0RGLGFB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O0FBQzlDbkMsSUFBQUEsa0NBQWtDO0FBRWxDSyxJQUFBQSxhQUFhLENBQUMrQixvQ0FBZCxHQUNFaEMsT0FBTyxDQUFDZ0Msb0NBQVIsSUFBZ0RoQyxPQUFPLENBQUMrQixrQ0FEMUQ7QUFFRDs7QUFFRCxNQUFJL0IsT0FBTyxDQUFDaUMsZ0NBQVosRUFBOEM7QUFDNUNyQyxJQUFBQSxrQ0FBa0M7QUFFbENLLElBQUFBLGFBQWEsQ0FBQ2lDLGtDQUFkLEdBQ0VsQyxPQUFPLENBQUNrQyxrQ0FBUixJQUE4Q2xDLE9BQU8sQ0FBQ2lDLGdDQUR4RDtBQUVEOztBQUVELHlDQUNLaEMsYUFETDtBQUVFRSxJQUFBQSx1QkFBdUIsRUFBRUcsaUNBRjNCO0FBR0VGLElBQUFBLGVBQWUsRUFBRUcseUJBSG5CO0FBSUVGLElBQUFBLFFBQVEsRUFBRUcsa0JBSlo7QUFLRU8sSUFBQUEseUJBQXlCLEVBQUVDO0FBTDdCO0FBT0QiLCJzb3VyY2VSb290IjoiY29tcG9uZW50Oi8vLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHdhcm5PbmNlIH0gZnJvbSAnYm90ZnJhbWV3b3JrLXdlYmNoYXQtY29yZSc7XG5cbmltcG9ydCBkZWZhdWx0U3R5bGVPcHRpb25zIGZyb20gJy4vZGVmYXVsdFN0eWxlT3B0aW9ucyc7XG5pbXBvcnQgU3R5bGVPcHRpb25zLCB7IFN0cmljdFN0eWxlT3B0aW9ucyB9IGZyb20gJy4vU3R5bGVPcHRpb25zJztcblxuY29uc3QgaGlkZVNjcm9sbFRvRW5kQnV0dG9uRGVwcmVjYXRpb24gPSB3YXJuT25jZShcbiAgJ1wic3R5bGVPcHRpb25zLmhpZGVTY3JvbGxUb0VuZEJ1dHRvblwiIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFRvIGhpZGUgc2Nyb2xsIHRvIGVuZCBidXR0b24sIHNldCBcInNjcm9sbFRvRW5kQmVoYXZpb3JcIiB0byBmYWxzZS4gVGhpcyBkZXByZWNhdGlvbiBtaWdyYXRpb24gd2lsbCBiZSByZW1vdmVkIG9uIG9yIGFmdGVyIDIwMjMtMDYtMDIuJ1xuKTtcblxuY29uc3QgbmV3TWVzc2FnZXNCdXR0b25Gb250U2l6ZURlcHJlY2F0aW9uID0gd2Fybk9uY2UoXG4gICdcInN0eWxlT3B0aW9ucy5uZXdNZXNzYWdlc0J1dHRvbkZvbnRTaXplXCIgaGFzIGJlZW4gcmVuYW1lZCB0byBcInN0eWxlT3B0aW9ucy5zY3JvbGxUb0VuZEJ1dHRvbkZvbnRTaXplXCIuIFRoaXMgZGVwcmVjYXRpb24gbWlncmF0aW9uIHdpbGwgYmUgcmVtb3ZlZCBvbiBvciBhZnRlciAyMDIzLTA2LTAyLidcbik7XG5cbmNvbnN0IHN1Z2dlc3RlZEFjdGlvbkJhY2tncm91bmREZXByZWNhdGlvbiA9IHdhcm5PbmNlKFxuICAnXCJzdHlsZU9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZFwiIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgXCJzdHlsZU9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZENvbG9yXCIgaW5zdGVhZC4gVGhpcyBkZXByZWNhdGlvbiBtaWdyYXRpb24gd2lsbCBiZSByZW1vdmVkIG9uIG9yIGFmdGVyIDIwMjEtMDktMTYuJ1xuKTtcblxuY29uc3Qgc3VnZ2VzdGVkQWN0aW9uWFhYQmFja2dyb3VuZERlcHJlY2F0aW9uID0gd2Fybk9uY2UoXG4gICdcInN0eWxlT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25YWFhCYWNrZ3JvdW5kXCIgaGFzIGJlZW4gZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSBcInN0eWxlT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kQ29sb3JPblhYWFwiIGluc3RlYWQuIFRoaXMgZGVwcmVjYXRpb24gbWlncmF0aW9uIHdpbGwgYmUgcmVtb3ZlZCBvbiBvciBhZnRlciAyMDIxLTA5LTE2Lidcbik7XG5cbmNvbnN0IHN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkRGVwcmVjYXRpb24gPSB3YXJuT25jZShcbiAgJ1wic3R5bGVPcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkWFhYXCIgaGFzIGJlZW4gcmVuYW1lZCB0byBcInN0eWxlT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25YWFhPbkRpc2FibGVkXCIuIFRoaXMgZGVwcmVjYXRpb24gbWlncmF0aW9uIHdpbGwgYmUgcmVtb3ZlZCBvbiBvciBhZnRlciAyMDIxLTA5LTE2Lidcbik7XG5cbi8vIFRPRE86IFtQNF0gV2Ugc2hvdWxkIGFkZCBhIG5vdGljZSBmb3IgcGVvcGxlIHdobyB3YW50IHRvIHVzZSBcInN0eWxlU2V0XCIgaW5zdGVhZCBvZiBcInN0eWxlT3B0aW9uc1wiLlxuLy8gICAgICAgXCJzdHlsZVNldFwiIGlzIGFjdHVhbGx5IENTUyBzdHlsZXNoZWV0IGFuZCBpdCBpcyBiYXNlZCBvbiB0aGUgRE9NIHRyZWUuXG4vLyAgICAgICBET00gdHJlZSBtYXkgY2hhbmdlIGZyb20gdGltZSB0byB0aW1lLCB0aHVzLCBtYWludGFpbmluZyBcInN0eWxlU2V0XCIgYmVjb21lcyBhIGNvbnN0YW50IGVmZm9ydC5cblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBsZXhpdHlcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG5vcm1hbGl6ZVN0eWxlT3B0aW9ucyh7XG4gIGhpZGVTY3JvbGxUb0VuZEJ1dHRvbixcbiAgbmV3TWVzc2FnZXNCdXR0b25Gb250U2l6ZSxcbiAgLi4ub3B0aW9uc1xufTogU3R5bGVPcHRpb25zID0ge30pOiBTdHJpY3RTdHlsZU9wdGlvbnMge1xuICBjb25zdCBmaWxsZWRPcHRpb25zOiBSZXF1aXJlZDxTdHlsZU9wdGlvbnM+ID0geyAuLi5kZWZhdWx0U3R5bGVPcHRpb25zLCAuLi5vcHRpb25zIH07XG5cbiAgLy8gS2VlcCB0aGlzIGxpc3QgZmxhdCAobm8gbmVzdGVkIHN0eWxlKSBhbmQgc2VyaWFsaXphYmxlIChubyBmdW5jdGlvbnMpXG4gIGNvbnN0IHsgYnViYmxlRnJvbVVzZXJOdWJPZmZzZXQsIGJ1YmJsZU51Yk9mZnNldCwgZW1vamlTZXQgfSA9IGZpbGxlZE9wdGlvbnM7XG5cbiAgbGV0IG5vcm1hbGl6ZWRCdWJibGVGcm9tVXNlck51Yk9mZnNldDogbnVtYmVyO1xuICBsZXQgbm9ybWFsaXplZEJ1YmJsZU51Yk9mZnNldDogbnVtYmVyO1xuICBsZXQgbm9ybWFsaXplZEVtb2ppU2V0OiBmYWxzZSB8IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG5cbiAgaWYgKGJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0ID09PSAndG9wJykge1xuICAgIG5vcm1hbGl6ZWRCdWJibGVGcm9tVXNlck51Yk9mZnNldCA9IDA7XG4gIH0gZWxzZSBpZiAodHlwZW9mIGJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0ICE9PSAnbnVtYmVyJykge1xuICAgIG5vcm1hbGl6ZWRCdWJibGVGcm9tVXNlck51Yk9mZnNldCA9IC0wO1xuICB9IGVsc2Uge1xuICAgIG5vcm1hbGl6ZWRCdWJibGVGcm9tVXNlck51Yk9mZnNldCA9IGJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0O1xuICB9XG5cbiAgaWYgKGJ1YmJsZU51Yk9mZnNldCA9PT0gJ3RvcCcpIHtcbiAgICBub3JtYWxpemVkQnViYmxlTnViT2Zmc2V0ID0gMDtcbiAgfSBlbHNlIGlmICh0eXBlb2YgYnViYmxlTnViT2Zmc2V0ICE9PSAnbnVtYmVyJykge1xuICAgIG5vcm1hbGl6ZWRCdWJibGVOdWJPZmZzZXQgPSAtMDtcbiAgfSBlbHNlIHtcbiAgICBub3JtYWxpemVkQnViYmxlTnViT2Zmc2V0ID0gYnViYmxlTnViT2Zmc2V0O1xuICB9XG5cbiAgaWYgKGVtb2ppU2V0ID09PSB0cnVlKSB7XG4gICAgbm9ybWFsaXplZEVtb2ppU2V0ID0ge1xuICAgICAgJzopJzogJ/CfmIonLFxuICAgICAgJzotKSc6ICfwn5iKJyxcbiAgICAgICcoOic6ICfwn5iKJyxcbiAgICAgICcoLTonOiAn8J+YiicsXG4gICAgICAnOi18JzogJ/CfmJAnLFxuICAgICAgJzp8JzogJ/CfmJAnLFxuICAgICAgJzotKCc6ICfimLnvuI8nLFxuICAgICAgJzooJzogJ+KYue+4jycsXG4gICAgICAnOi1EJzogJ/CfmIAnLFxuICAgICAgJzpEJzogJ/CfmIAnLFxuICAgICAgJzotcCc6ICfwn5ibJyxcbiAgICAgICc6cCc6ICfwn5ibJyxcbiAgICAgICc6LVAnOiAn8J+YmycsXG4gICAgICAnOlAnOiAn8J+YmycsXG4gICAgICAnOi1vJzogJ/CfmLInLFxuICAgICAgJzpvJzogJ/CfmLInLFxuICAgICAgJzpPJzogJ/CfmLInLFxuICAgICAgJzotTyc6ICfwn5iyJyxcbiAgICAgICc6LTAnOiAn8J+YsicsXG4gICAgICAnOjAnOiAn8J+YsicsXG4gICAgICAnOy0pJzogJ/CfmIknLFxuICAgICAgJzspJzogJ/CfmIknLFxuICAgICAgJzwzJzogJ+KdpO+4jycsXG4gICAgICAnPC8zJzogJ/CfkpQnLFxuICAgICAgJzxcXFxcMyc6ICfwn5KUJ1xuICAgIH07XG4gIH0gZWxzZSBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGVtb2ppU2V0KSAhPT0gJ1tvYmplY3QgT2JqZWN0XScpIHtcbiAgICBjb25zb2xlLndhcm4oJ2JvdGZyYW1ld29yay13ZWJjaGF0OiBlbW9qaVNldCBtdXN0IGJlIGEgYm9vbGVhbiBvciBhbiBvYmplY3Qgd2l0aCBlbW90aWNvbjogZW1vamlWYWx1ZXMnKTtcbiAgICBub3JtYWxpemVkRW1vamlTZXQgPSBmYWxzZTtcbiAgfSBlbHNlIHtcbiAgICBub3JtYWxpemVkRW1vamlTZXQgPSBlbW9qaVNldDtcbiAgfVxuXG4gIGlmIChoaWRlU2Nyb2xsVG9FbmRCdXR0b24pIHtcbiAgICBoaWRlU2Nyb2xsVG9FbmRCdXR0b25EZXByZWNhdGlvbigpO1xuXG4gICAgLy8gT25seSBzZXQgaWYgdGhlIFwic2Nyb2xsVG9FbmRCdXR0b25CZWhhdmlvclwiIGlzIG5vdCBzZXQuXG4gICAgLy8gSWYgaXQgaGFzIGJlZW4gc2V0LCB0aGUgZGV2ZWxvcGVyIHNob3VsZCBrbm93IHRoZSBvbGRlciBcImhpZGVTY3JvbGxUb0VuZEJ1dHRvblwiIG9wdGlvbiBpcyBkZXByZWNhdGVkLlxuICAgIGZpbGxlZE9wdGlvbnMuc2Nyb2xsVG9FbmRCdXR0b25CZWhhdmlvciA9IG9wdGlvbnMuc2Nyb2xsVG9FbmRCdXR0b25CZWhhdmlvciB8fCBmYWxzZTtcbiAgfVxuXG4gIGxldCBwYXRjaGVkU2Nyb2xsVG9FbmRCdXR0b25CZWhhdmlvciA9IGZpbGxlZE9wdGlvbnMuc2Nyb2xsVG9FbmRCdXR0b25CZWhhdmlvcjtcblxuICBpZiAocGF0Y2hlZFNjcm9sbFRvRW5kQnV0dG9uQmVoYXZpb3IgIT09ICdhbnknICYmIHBhdGNoZWRTY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yICE9PSBmYWxzZSkge1xuICAgIHBhdGNoZWRTY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yID09PSAndW5yZWFkJyB8fFxuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAnV2ViIENoYXQ6IFwic2Nyb2xsVG9FbmRCdXR0b25CZWhhdmlvclwiIG11c3QgYmUgZWl0aGVyIFwidW5yZWFkXCIsIFwiYW55XCIsIG9yIGZhbHNlLCB3aWxsIHNldCB0byBcInVucmVhZFwiLidcbiAgICAgICk7XG5cbiAgICBwYXRjaGVkU2Nyb2xsVG9FbmRCdXR0b25CZWhhdmlvciA9ICd1bnJlYWQnO1xuICB9XG5cbiAgaWYgKG5ld01lc3NhZ2VzQnV0dG9uRm9udFNpemUpIHtcbiAgICBuZXdNZXNzYWdlc0J1dHRvbkZvbnRTaXplRGVwcmVjYXRpb24oKTtcblxuICAgIC8vIE9ubHkgc2V0IGlmIHRoZSBcInNjcm9sbFRvRW5kQnV0dG9uRm9udFNpemVcIiBpcyBub3Qgc2V0LlxuICAgIGZpbGxlZE9wdGlvbnMuc2Nyb2xsVG9FbmRCdXR0b25Gb250U2l6ZSA9IG9wdGlvbnMuc2Nyb2xsVG9FbmRCdXR0b25Gb250U2l6ZSB8fCBuZXdNZXNzYWdlc0J1dHRvbkZvbnRTaXplO1xuICB9XG5cbiAgb3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kICYmIHN1Z2dlc3RlZEFjdGlvbkJhY2tncm91bmREZXByZWNhdGlvbigpO1xuXG4gIGlmIChvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkFjdGl2ZUJhY2tncm91bmQpIHtcbiAgICBzdWdnZXN0ZWRBY3Rpb25YWFhCYWNrZ3JvdW5kRGVwcmVjYXRpb24oKTtcblxuICAgIGZpbGxlZE9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZENvbG9yT25BY3RpdmUgPVxuICAgICAgb3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kQ29sb3JPbkFjdGl2ZSB8fCBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkFjdGl2ZUJhY2tncm91bmQ7XG4gIH1cblxuICBpZiAob3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25Gb2N1c0JhY2tncm91bmQpIHtcbiAgICBzdWdnZXN0ZWRBY3Rpb25YWFhCYWNrZ3JvdW5kRGVwcmVjYXRpb24oKTtcblxuICAgIGZpbGxlZE9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZENvbG9yT25Gb2N1cyA9XG4gICAgICBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkJhY2tncm91bmRDb2xvck9uRm9jdXMgfHwgb3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25Gb2N1c0JhY2tncm91bmQ7XG4gIH1cblxuICBpZiAob3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25Ib3ZlckJhY2tncm91bmQpIHtcbiAgICBzdWdnZXN0ZWRBY3Rpb25YWFhCYWNrZ3JvdW5kRGVwcmVjYXRpb24oKTtcblxuICAgIGZpbGxlZE9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZENvbG9yT25Ib3ZlciA9XG4gICAgICBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkJhY2tncm91bmRDb2xvck9uSG92ZXIgfHwgb3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25Ib3ZlckJhY2tncm91bmQ7XG4gIH1cblxuICBpZiAob3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZEJhY2tncm91bmQpIHtcbiAgICBzdWdnZXN0ZWRBY3Rpb25YWFhCYWNrZ3JvdW5kRGVwcmVjYXRpb24oKTtcblxuICAgIGZpbGxlZE9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZENvbG9yT25EaXNhYmxlZCA9XG4gICAgICBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkJhY2tncm91bmRDb2xvck9uRGlzYWJsZWQgfHwgb3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZEJhY2tncm91bmQ7XG4gIH1cblxuICBpZiAob3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZEJvcmRlckNvbG9yKSB7XG4gICAgc3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWREZXByZWNhdGlvbigpO1xuXG4gICAgZmlsbGVkT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25Cb3JkZXJDb2xvck9uRGlzYWJsZWQgPVxuICAgICAgb3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25Cb3JkZXJDb2xvck9uRGlzYWJsZWQgfHwgb3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZEJvcmRlckNvbG9yO1xuICB9XG5cbiAgaWYgKG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWRCb3JkZXJTdHlsZSkge1xuICAgIHN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkRGVwcmVjYXRpb24oKTtcblxuICAgIGZpbGxlZE9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQm9yZGVyU3R5bGVPbkRpc2FibGVkID1cbiAgICAgIG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQm9yZGVyU3R5bGVPbkRpc2FibGVkIHx8IG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWRCb3JkZXJTdHlsZTtcbiAgfVxuXG4gIGlmIChvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkQm9yZGVyV2lkdGgpIHtcbiAgICBzdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZERlcHJlY2F0aW9uKCk7XG5cbiAgICBmaWxsZWRPcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkJvcmRlcldpZHRoT25EaXNhYmxlZCA9XG4gICAgICBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkJvcmRlcldpZHRoT25EaXNhYmxlZCB8fCBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkQm9yZGVyV2lkdGg7XG4gIH1cblxuICBpZiAob3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZFRleHRDb2xvcikge1xuICAgIHN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkRGVwcmVjYXRpb24oKTtcblxuICAgIGZpbGxlZE9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uVGV4dENvbG9yT25EaXNhYmxlZCA9XG4gICAgICBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvblRleHRDb2xvck9uRGlzYWJsZWQgfHwgb3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZFRleHRDb2xvcjtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgLi4uZmlsbGVkT3B0aW9ucyxcbiAgICBidWJibGVGcm9tVXNlck51Yk9mZnNldDogbm9ybWFsaXplZEJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0LFxuICAgIGJ1YmJsZU51Yk9mZnNldDogbm9ybWFsaXplZEJ1YmJsZU51Yk9mZnNldCxcbiAgICBlbW9qaVNldDogbm9ybWFsaXplZEVtb2ppU2V0LFxuICAgIHNjcm9sbFRvRW5kQnV0dG9uQmVoYXZpb3I6IHBhdGNoZWRTY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yXG4gIH07XG59XG4iXX0=