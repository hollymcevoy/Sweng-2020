"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _botframeworkWebchatComponent = require("botframework-webchat-component");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _useAdaptiveCardsPackage = _interopRequireDefault(require("../hooks/useAdaptiveCardsPackage"));

var _useParseAdaptiveCardJSON = _interopRequireDefault(require("../hooks/internal/useParseAdaptiveCardJSON"));

var _useUniqueId = _interopRequireDefault(require("../hooks/internal/useUniqueId"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/* eslint-disable react/no-array-index-key */

/* eslint-disable react/forbid-dom-props */
var useLocalizer = _botframeworkWebchatComponent.hooks.useLocalizer; // Perform a depth-first search of the Adaptive Card tree.

function walkAllItems(node, fn) {
  fn(node);

  if (node.getItemAt && node.getItemCount) {
    for (var count = node.getItemCount(), index = 0; index < count; index++) {
      walkAllItems(node.getItemAt(index), fn);
    }
  }

  if (node.getActionAt && node.getActionCount) {
    for (var _count = node.getActionCount(), _index = 0; _index < _count; _index++) {
      fn(node.getActionAt(_index));
    }
  }
}

var AdaptiveCardChoiceSetInput = function AdaptiveCardChoiceSetInput(_ref) {
  var _ref$input = _ref.input,
      choices = _ref$input.choices,
      defaultValue = _ref$input.defaultValue;
  var labelId = (0, _useUniqueId.default)('webchat__id');
  var defaultChoice = choices.find(function (_ref2) {
    var value = _ref2.value;
    return defaultValue === value || !defaultValue && !value;
  });
  return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("select", {
    "aria-labelledby": defaultChoice ? labelId : undefined,
    defaultValue: defaultValue,
    tabIndex: -1
  }, choices.map(function (choice) {
    return /*#__PURE__*/_react.default.createElement("option", {
      id: choice === defaultChoice ? labelId : undefined,
      key: choice.value,
      value: choice.value
    }, choice.title);
  })));
};

AdaptiveCardChoiceSetInput.propTypes = {
  input: _propTypes.default.shape({
    choices: _propTypes.default.arrayOf(_propTypes.default.shape({
      title: _propTypes.default.string,
      value: _propTypes.default.any
    })),
    defaultValue: _propTypes.default.any,
    value: _propTypes.default.any
  }).isRequired
};

var AdaptiveCardAttachment = function AdaptiveCardAttachment(_ref3) {
  var content = _ref3.content;
  var labelId = (0, _useUniqueId.default)('webchat__id');
  var localize = useLocalizer();
  var parseAdaptiveCardJSON = (0, _useParseAdaptiveCardJSON.default)();

  var _useAdaptiveCardsPack = (0, _useAdaptiveCardsPackage.default)(),
      _useAdaptiveCardsPack2 = (0, _slicedToArray2.default)(_useAdaptiveCardsPack, 1),
      _useAdaptiveCardsPack3 = _useAdaptiveCardsPack2[0],
      ChoiceSetInput = _useAdaptiveCardsPack3.ChoiceSetInput,
      DateInput = _useAdaptiveCardsPack3.DateInput,
      NumberInput = _useAdaptiveCardsPack3.NumberInput,
      OpenUrlAction = _useAdaptiveCardsPack3.OpenUrlAction,
      ShowCardAction = _useAdaptiveCardsPack3.ShowCardAction,
      SubmitAction = _useAdaptiveCardsPack3.SubmitAction,
      TextInput = _useAdaptiveCardsPack3.TextInput,
      TimeInput = _useAdaptiveCardsPack3.TimeInput,
      ToggleInput = _useAdaptiveCardsPack3.ToggleInput;

  var card = (0, _react.useMemo)(function () {
    return parseAdaptiveCardJSON(content, {
      ignoreErrors: true
    });
  }, [content, parseAdaptiveCardJSON]);
  var inputs = (0, _react.useMemo)(function () {
    var inputs = [];
    walkAllItems(card, function (node) {
      if (node instanceof ChoiceSetInput || node instanceof DateInput || node instanceof NumberInput || node instanceof OpenUrlAction || node instanceof ShowCardAction || node instanceof SubmitAction || node instanceof TextInput || node instanceof TimeInput || node instanceof ToggleInput) {
        inputs.push(node);
      }
    });
    return inputs;
  }, [card, ChoiceSetInput, DateInput, NumberInput, OpenUrlAction, ShowCardAction, SubmitAction, TextInput, TimeInput, ToggleInput]);
  var cardLabel = localize('ATTACHMENT_CARD', card.speak || '', '', '');
  return /*#__PURE__*/_react.default.createElement("article", {
    "aria-labelledby": labelId
  }, /*#__PURE__*/_react.default.createElement("div", {
    id: labelId
  }, cardLabel), inputs.map(function (input, index) {
    return input instanceof ChoiceSetInput ? /*#__PURE__*/_react.default.createElement(AdaptiveCardChoiceSetInput, {
      input: input,
      key: index
    }) : input instanceof DateInput ? /*#__PURE__*/_react.default.createElement("div", {
      key: index
    }, /*#__PURE__*/_react.default.createElement("input", {
      placeholder: input.placeholder,
      tabIndex: -1,
      type: "date"
    })) : input instanceof NumberInput ? /*#__PURE__*/_react.default.createElement("div", {
      key: index
    }, /*#__PURE__*/_react.default.createElement("input", {
      placeholder: input.placeholder,
      tabIndex: -1,
      type: "number"
    })) : input instanceof OpenUrlAction || input instanceof ShowCardAction || input instanceof SubmitAction ? /*#__PURE__*/_react.default.createElement("div", {
      key: index
    }, /*#__PURE__*/_react.default.createElement("button", {
      tabIndex: -1,
      type: "button"
    }, input.title)) : input instanceof TextInput ? /*#__PURE__*/_react.default.createElement("div", {
      key: index
    }, /*#__PURE__*/_react.default.createElement("input", {
      placeholder: input.placeholder,
      tabIndex: -1,
      type: "text"
    })) : input instanceof TimeInput ? /*#__PURE__*/_react.default.createElement("div", {
      key: index
    }, /*#__PURE__*/_react.default.createElement("input", {
      placeholder: input.placeholder,
      tabIndex: -1,
      type: "time"
    })) : input instanceof ToggleInput ? /*#__PURE__*/_react.default.createElement("div", {
      key: index
    }, input.title, /*#__PURE__*/_react.default.createElement("input", {
      defaultChecked: input.value === input.valueOn,
      tabIndex: -1,
      type: "checkbox"
    })) : false;
  }));
};

AdaptiveCardAttachment.propTypes = {
  content: _propTypes.default.any.isRequired
};
var _default = AdaptiveCardAttachment;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hZGFwdGl2ZUNhcmRzL0F0dGFjaG1lbnRGb3JTY3JlZW5SZWFkZXIvQWRhcHRpdmVDYXJkQXR0YWNobWVudC5qcyJdLCJuYW1lcyI6WyJ1c2VMb2NhbGl6ZXIiLCJob29rcyIsIndhbGtBbGxJdGVtcyIsIm5vZGUiLCJmbiIsImdldEl0ZW1BdCIsImdldEl0ZW1Db3VudCIsImNvdW50IiwiaW5kZXgiLCJnZXRBY3Rpb25BdCIsImdldEFjdGlvbkNvdW50IiwiQWRhcHRpdmVDYXJkQ2hvaWNlU2V0SW5wdXQiLCJpbnB1dCIsImNob2ljZXMiLCJkZWZhdWx0VmFsdWUiLCJsYWJlbElkIiwiZGVmYXVsdENob2ljZSIsImZpbmQiLCJ2YWx1ZSIsInVuZGVmaW5lZCIsIm1hcCIsImNob2ljZSIsInRpdGxlIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwic2hhcGUiLCJhcnJheU9mIiwic3RyaW5nIiwiYW55IiwiaXNSZXF1aXJlZCIsIkFkYXB0aXZlQ2FyZEF0dGFjaG1lbnQiLCJjb250ZW50IiwibG9jYWxpemUiLCJwYXJzZUFkYXB0aXZlQ2FyZEpTT04iLCJDaG9pY2VTZXRJbnB1dCIsIkRhdGVJbnB1dCIsIk51bWJlcklucHV0IiwiT3BlblVybEFjdGlvbiIsIlNob3dDYXJkQWN0aW9uIiwiU3VibWl0QWN0aW9uIiwiVGV4dElucHV0IiwiVGltZUlucHV0IiwiVG9nZ2xlSW5wdXQiLCJjYXJkIiwiaWdub3JlRXJyb3JzIiwiaW5wdXRzIiwicHVzaCIsImNhcmRMYWJlbCIsInNwZWFrIiwicGxhY2Vob2xkZXIiLCJ2YWx1ZU9uIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7Ozs7OztBQVJBOztBQUNBO0FBU0EsSUFBUUEsWUFBUixHQUF5QkMsbUNBQXpCLENBQVFELFlBQVIsQyxDQUVBOztBQUNBLFNBQVNFLFlBQVQsQ0FBc0JDLElBQXRCLEVBQTRCQyxFQUE1QixFQUFn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QUFDVSxLQURULENBREYsQ0FERSxHQU1BVixLQUFLLFlBQVk0QixTQUFqQixnQkFDRjtBQUFLLE1BQUEsR0FBRyxFQUFFaEM7QUFBVixvQkFDRTtBQUFPLE1BQUEsV0FBVyxFQUFFSSxLQUFLLENBQUNxQyxXQUExQjtBQUF1QyxNQUFBLFFBQVEsRUFBRSxDQUFDLENBQWxEO0FBQXFELE1BQUEsSUFBSSxFQUFDO0FBQTFELE1BREYsQ0FERSxHQUlBckMsS0FBSyxZQUFZNkIsU0FBakIsZ0JBQ0Y7QUFBSyxNQUFBLEdBQUcsRUFBRWpDO0FBQVYsb0JBQ0U7QUFBTyxNQUFBLFdBQVcsRUFBRUksS0FBSyxDQUFDcUMsV0FBMUI7QUFBdUMsTUFBQSxRQUFRLEVBQUUsQ0FBQyxDQUFsRDtBQUFxRCxNQUFBLElBQUksRUFBQztBQUExRCxNQURGLENBREUsR0FJQXJDLEtBQUssWUFBWThCLFdBQWpCLGdCQUNGO0FBQUssTUFBQSxHQUFHLEVBQUVsQztBQUFWLE9BQ0dJLEtBQUssQ0FBQ1UsS0FEVCxlQUVFO0FBQU8sTUFBQSxjQUFjLEVBQUVWLEtBQUssQ0FBQ00sS0FBTixLQUFnQk4sS0FBSyxDQUFDc0MsT0FBN0M7QUFBc0QsTUFBQSxRQUFRLEVBQUUsQ0FBQyxDQUFqRTtBQUFvRSxNQUFBLElBQUksRUFBQztBQUF6RSxNQUZGLENBREUsR0FNRixLQS9CUTtBQUFBLEdBQVgsQ0FGSCxDQURGO0FBdUNELENBN0ZEOztBQStGQXBCLHNCQUFzQixDQUFDUCxTQUF2QixHQUFtQztBQUNqQ1EsRUFBQUEsT0FBTyxFQUFFUCxtQkFBVUksR0FBVixDQUFjQztBQURVLENBQW5DO2VBSWVDLHNCIiwic291cmNlUm9vdCI6ImJ1bmRsZTovLy8iLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSByZWFjdC9uby1hcnJheS1pbmRleC1rZXkgKi9cbi8qIGVzbGludC1kaXNhYmxlIHJlYWN0L2ZvcmJpZC1kb20tcHJvcHMgKi9cbmltcG9ydCB7IGhvb2tzIH0gZnJvbSAnYm90ZnJhbWV3b3JrLXdlYmNoYXQtY29tcG9uZW50JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QsIHsgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHVzZUFkYXB0aXZlQ2FyZHNQYWNrYWdlIGZyb20gJy4uL2hvb2tzL3VzZUFkYXB0aXZlQ2FyZHNQYWNrYWdlJztcbmltcG9ydCB1c2VQYXJzZUFkYXB0aXZlQ2FyZEpTT04gZnJvbSAnLi4vaG9va3MvaW50ZXJuYWwvdXNlUGFyc2VBZGFwdGl2ZUNhcmRKU09OJztcbmltcG9ydCB1c2VVbmlxdWVJZCBmcm9tICcuLi9ob29rcy9pbnRlcm5hbC91c2VVbmlxdWVJZCc7XG5cbmNvbnN0IHsgdXNlTG9jYWxpemVyIH0gPSBob29rcztcblxuLy8gUGVyZm9ybSBhIGRlcHRoLWZpcnN0IHNlYXJjaCBvZiB0aGUgQWRhcHRpdmUgQ2FyZCB0cmVlLlxuZnVuY3Rpb24gd2Fsa0FsbEl0ZW1zKG5vZGUsIGZuKSB7XG4gIGZuKG5vZGUpO1xuXG4gIGlmIChub2RlLmdldEl0ZW1BdCAmJiBub2RlLmdldEl0ZW1Db3VudCkge1xuICAgIGZvciAobGV0IGNvdW50ID0gbm9kZS5nZXRJdGVtQ291bnQoKSwgaW5kZXggPSAwOyBpbmRleCA8IGNvdW50OyBpbmRleCsrKSB7XG4gICAgICB3YWxrQWxsSXRlbXMobm9kZS5nZXRJdGVtQXQoaW5kZXgpLCBmbik7XG4gICAgfVxuICB9XG5cbiAgaWYgKG5vZGUuZ2V0QWN0aW9uQXQgJiYgbm9kZS5nZXRBY3Rpb25Db3VudCkge1xuICAgIGZvciAobGV0IGNvdW50ID0gbm9kZS5nZXRBY3Rpb25Db3VudCgpLCBpbmRleCA9IDA7IGluZGV4IDwgY291bnQ7IGluZGV4KyspIHtcbiAgICAgIGZuKG5vZGUuZ2V0QWN0aW9uQXQoaW5kZXgpKTtcbiAgICB9XG4gIH1cbn1cblxuY29uc3QgQWRhcHRpdmVDYXJkQ2hvaWNlU2V0SW5wdXQgPSAoeyBpbnB1dDogeyBjaG9pY2VzLCBkZWZhdWx0VmFsdWUgfSB9KSA9PiB7XG4gIGNvbnN0IGxhYmVsSWQgPSB1c2VVbmlxdWVJZCgnd2ViY2hhdF9faWQnKTtcbiAgY29uc3QgZGVmYXVsdENob2ljZSA9IGNob2ljZXMuZmluZCgoeyB2YWx1ZSB9KSA9PiBkZWZhdWx0VmFsdWUgPT09IHZhbHVlIHx8ICghZGVmYXVsdFZhbHVlICYmICF2YWx1ZSkpO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdj5cbiAgICAgIDxzZWxlY3QgYXJpYS1sYWJlbGxlZGJ5PXtkZWZhdWx0Q2hvaWNlID8gbGFiZWxJZCA6IHVuZGVmaW5lZH0gZGVmYXVsdFZhbHVlPXtkZWZhdWx0VmFsdWV9IHRhYkluZGV4PXstMX0+XG4gICAgICAgIHtjaG9pY2VzLm1hcChjaG9pY2UgPT4gKFxuICAgICAgICAgIDxvcHRpb24gaWQ9e2Nob2ljZSA9PT0gZGVmYXVsdENob2ljZSA/IGxhYmVsSWQgOiB1bmRlZmluZWR9IGtleT17Y2hvaWNlLnZhbHVlfSB2YWx1ZT17Y2hvaWNlLnZhbHVlfT5cbiAgICAgICAgICAgIHtjaG9pY2UudGl0bGV9XG4gICAgICAgICAgPC9vcHRpb24+XG4gICAgICAgICkpfVxuICAgICAgPC9zZWxlY3Q+XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG5BZGFwdGl2ZUNhcmRDaG9pY2VTZXRJbnB1dC5wcm9wVHlwZXMgPSB7XG4gIGlucHV0OiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgIGNob2ljZXM6IFByb3BUeXBlcy5hcnJheU9mKFxuICAgICAgUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgdGl0bGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIHZhbHVlOiBQcm9wVHlwZXMuYW55XG4gICAgICB9KVxuICAgICksXG4gICAgZGVmYXVsdFZhbHVlOiBQcm9wVHlwZXMuYW55LFxuICAgIHZhbHVlOiBQcm9wVHlwZXMuYW55XG4gIH0pLmlzUmVxdWlyZWRcbn07XG5cbmNvbnN0IEFkYXB0aXZlQ2FyZEF0dGFjaG1lbnQgPSAoeyBjb250ZW50IH0pID0+IHtcbiAgY29uc3QgbGFiZWxJZCA9IHVzZVVuaXF1ZUlkKCd3ZWJjaGF0X19pZCcpO1xuICBjb25zdCBsb2NhbGl6ZSA9IHVzZUxvY2FsaXplcigpO1xuICBjb25zdCBwYXJzZUFkYXB0aXZlQ2FyZEpTT04gPSB1c2VQYXJzZUFkYXB0aXZlQ2FyZEpTT04oKTtcbiAgY29uc3QgW1xuICAgIHtcbiAgICAgIENob2ljZVNldElucHV0LFxuICAgICAgRGF0ZUlucHV0LFxuICAgICAgTnVtYmVySW5wdXQsXG4gICAgICBPcGVuVXJsQWN0aW9uLFxuICAgICAgU2hvd0NhcmRBY3Rpb24sXG4gICAgICBTdWJtaXRBY3Rpb24sXG4gICAgICBUZXh0SW5wdXQsXG4gICAgICBUaW1lSW5wdXQsXG4gICAgICBUb2dnbGVJbnB1dFxuICAgIH1cbiAgXSA9IHVzZUFkYXB0aXZlQ2FyZHNQYWNrYWdlKCk7XG5cbiAgY29uc3QgY2FyZCA9IHVzZU1lbW8oKCkgPT4gcGFyc2VBZGFwdGl2ZUNhcmRKU09OKGNvbnRlbnQsIHsgaWdub3JlRXJyb3JzOiB0cnVlIH0pLCBbY29udGVudCwgcGFyc2VBZGFwdGl2ZUNhcmRKU09OXSk7XG4gIGNvbnN0IGlucHV0cyA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGNvbnN0IGlucHV0cyA9IFtdO1xuXG4gICAgd2Fsa0FsbEl0ZW1zKGNhcmQsIG5vZGUgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBub2RlIGluc3RhbmNlb2YgQ2hvaWNlU2V0SW5wdXQgfHxcbiAgICAgICAgbm9kZSBpbnN0YW5jZW9mIERhdGVJbnB1dCB8fFxuICAgICAgICBub2RlIGluc3RhbmNlb2YgTnVtYmVySW5wdXQgfHxcbiAgICAgICAgbm9kZSBpbnN0YW5jZW9mIE9wZW5VcmxBY3Rpb24gfHxcbiAgICAgICAgbm9kZSBpbnN0YW5jZW9mIFNob3dDYXJkQWN0aW9uIHx8XG4gICAgICAgIG5vZGUgaW5zdGFuY2VvZiBTdWJtaXRBY3Rpb24gfHxcbiAgICAgICAgbm9kZSBpbnN0YW5jZW9mIFRleHRJbnB1dCB8fFxuICAgICAgICBub2RlIGluc3RhbmNlb2YgVGltZUlucHV0IHx8XG4gICAgICAgIG5vZGUgaW5zdGFuY2VvZiBUb2dnbGVJbnB1dFxuICAgICAgKSB7XG4gICAgICAgIGlucHV0cy5wdXNoKG5vZGUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGlucHV0cztcbiAgfSwgW1xuICAgIGNhcmQsXG4gICAgQ2hvaWNlU2V0SW5wdXQsXG4gICAgRGF0ZUlucHV0LFxuICAgIE51bWJlcklucHV0LFxuICAgIE9wZW5VcmxBY3Rpb24sXG4gICAgU2hvd0NhcmRBY3Rpb24sXG4gICAgU3VibWl0QWN0aW9uLFxuICAgIFRleHRJbnB1dCxcbiAgICBUaW1lSW5wdXQsXG4gICAgVG9nZ2xlSW5wdXRcbiAgXSk7XG5cbiAgY29uc3QgY2FyZExhYmVsID0gbG9jYWxpemUoJ0FUVEFDSE1FTlRfQ0FSRCcsIGNhcmQuc3BlYWsgfHwgJycsICcnLCAnJyk7XG5cbiAgcmV0dXJuIChcbiAgICA8YXJ0aWNsZSBhcmlhLWxhYmVsbGVkYnk9e2xhYmVsSWR9PlxuICAgICAgPGRpdiBpZD17bGFiZWxJZH0+e2NhcmRMYWJlbH08L2Rpdj5cbiAgICAgIHtpbnB1dHMubWFwKChpbnB1dCwgaW5kZXgpID0+XG4gICAgICAgIGlucHV0IGluc3RhbmNlb2YgQ2hvaWNlU2V0SW5wdXQgPyAoXG4gICAgICAgICAgPEFkYXB0aXZlQ2FyZENob2ljZVNldElucHV0IGlucHV0PXtpbnB1dH0ga2V5PXtpbmRleH0gLz5cbiAgICAgICAgKSA6IGlucHV0IGluc3RhbmNlb2YgRGF0ZUlucHV0ID8gKFxuICAgICAgICAgIDxkaXYga2V5PXtpbmRleH0+XG4gICAgICAgICAgICA8aW5wdXQgcGxhY2Vob2xkZXI9e2lucHV0LnBsYWNlaG9sZGVyfSB0YWJJbmRleD17LTF9IHR5cGU9XCJkYXRlXCIgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKSA6IGlucHV0IGluc3RhbmNlb2YgTnVtYmVySW5wdXQgPyAoXG4gICAgICAgICAgPGRpdiBrZXk9e2luZGV4fT5cbiAgICAgICAgICAgIDxpbnB1dCBwbGFjZWhvbGRlcj17aW5wdXQucGxhY2Vob2xkZXJ9IHRhYkluZGV4PXstMX0gdHlwZT1cIm51bWJlclwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICkgOiBpbnB1dCBpbnN0YW5jZW9mIE9wZW5VcmxBY3Rpb24gfHwgaW5wdXQgaW5zdGFuY2VvZiBTaG93Q2FyZEFjdGlvbiB8fCBpbnB1dCBpbnN0YW5jZW9mIFN1Ym1pdEFjdGlvbiA/IChcbiAgICAgICAgICA8ZGl2IGtleT17aW5kZXh9PlxuICAgICAgICAgICAgPGJ1dHRvbiB0YWJJbmRleD17LTF9IHR5cGU9XCJidXR0b25cIj5cbiAgICAgICAgICAgICAge2lucHV0LnRpdGxlfVxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICkgOiBpbnB1dCBpbnN0YW5jZW9mIFRleHRJbnB1dCA/IChcbiAgICAgICAgICA8ZGl2IGtleT17aW5kZXh9PlxuICAgICAgICAgICAgPGlucHV0IHBsYWNlaG9sZGVyPXtpbnB1dC5wbGFjZWhvbGRlcn0gdGFiSW5kZXg9ey0xfSB0eXBlPVwidGV4dFwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICkgOiBpbnB1dCBpbnN0YW5jZW9mIFRpbWVJbnB1dCA/IChcbiAgICAgICAgICA8ZGl2IGtleT17aW5kZXh9PlxuICAgICAgICAgICAgPGlucHV0IHBsYWNlaG9sZGVyPXtpbnB1dC5wbGFjZWhvbGRlcn0gdGFiSW5kZXg9ey0xfSB0eXBlPVwidGltZVwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICkgOiBpbnB1dCBpbnN0YW5jZW9mIFRvZ2dsZUlucHV0ID8gKFxuICAgICAgICAgIDxkaXYga2V5PXtpbmRleH0+XG4gICAgICAgICAgICB7aW5wdXQudGl0bGV9XG4gICAgICAgICAgICA8aW5wdXQgZGVmYXVsdENoZWNrZWQ9e2lucHV0LnZhbHVlID09PSBpbnB1dC52YWx1ZU9ufSB0YWJJbmRleD17LTF9IHR5cGU9XCJjaGVja2JveFwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICkgOiAoXG4gICAgICAgICAgZmFsc2VcbiAgICAgICAgKVxuICAgICAgKX1cbiAgICA8L2FydGljbGU+XG4gICk7XG59O1xuXG5BZGFwdGl2ZUNhcmRBdHRhY2htZW50LnByb3BUeXBlcyA9IHtcbiAgY29udGVudDogUHJvcFR5cGVzLmFueS5pc1JlcXVpcmVkXG59O1xuXG5leHBvcnQgZGVmYXVsdCBBZGFwdGl2ZUNhcmRBdHRhY2htZW50O1xuIl19