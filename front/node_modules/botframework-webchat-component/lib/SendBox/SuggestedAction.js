"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.connectSuggestedAction = void 0;

var _botframeworkWebchatApi = require("botframework-webchat-api");

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _AccessibleButton = _interopRequireDefault(require("../Utils/AccessibleButton"));

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _useFocus = _interopRequireDefault(require("../hooks/useFocus"));

var _useFocusAccessKeyEffect = _interopRequireDefault(require("../Utils/AccessKeySink/useFocusAccessKeyEffect"));

var _useFocusVisible3 = _interopRequireDefault(require("../hooks/internal/useFocusVisible"));

var _useLocalizeAccessKey = _interopRequireDefault(require("../hooks/internal/useLocalizeAccessKey"));

var _useScrollToEnd = _interopRequireDefault(require("../hooks/useScrollToEnd"));

var _useSuggestedActionsAccessKey = _interopRequireDefault(require("../hooks/internal/useSuggestedActionsAccessKey"));

var _useStyleSet3 = _interopRequireDefault(require("../hooks/useStyleSet"));

var _useStyleToEmotionObject = _interopRequireDefault(require("../hooks/internal/useStyleToEmotionObject"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var useDirection = _botframeworkWebchatApi.hooks.useDirection,
    useDisabled = _botframeworkWebchatApi.hooks.useDisabled,
    usePerformCardAction = _botframeworkWebchatApi.hooks.usePerformCardAction,
    useStyleOptions = _botframeworkWebchatApi.hooks.useStyleOptions,
    useSuggestedActions = _botframeworkWebchatApi.hooks.useSuggestedActions;
var ROOT_STYLE = {
  '&.webchat__suggested-action': {
    display: 'flex',
    overflow: 'hidden' // Prevent image from leaking; object-fit does not work with IE11

  }
};

var connectSuggestedAction = function connectSuggestedAction() {
  for (var _len = arguments.length, selectors = new Array(_len), _key = 0; _key < _len; _key++) {
    selectors[_key] = arguments[_key];
  }

  return _connectToWebChat.default.apply(void 0, [function (_ref, _ref2) {
    var clearSuggestedActions = _ref.clearSuggestedActions,
        disabled = _ref.disabled,
        language = _ref.language,
        onCardAction = _ref.onCardAction;
    var displayText = _ref2.displayText,
        text = _ref2.text,
        type = _ref2.type,
        value = _ref2.value;
    return {
      click: function click() {
        onCardAction({
          displayText: displayText,
          text: text,
          type: type,
          value: value
        });
        type === 'openUrl' && clearSuggestedActions();
      },
      disabled: disabled,
      language: language
    };
  }].concat(selectors));
};

exports.connectSuggestedAction = connectSuggestedAction;

var SuggestedAction = function SuggestedAction(_ref3) {
  var buttonText = _ref3.buttonText,
      className = _ref3.className,
      displayText = _ref3.displayText,
      image = _ref3.image,
      imageAlt = _ref3.imageAlt,
      text = _ref3.text,
      textClassName = _ref3.textClassName,
      type = _ref3.type,
      value = _ref3.value;

  var _useSuggestedActions = useSuggestedActions(),
      _useSuggestedActions2 = _slicedToArray(_useSuggestedActions, 2),
      _ = _useSuggestedActions2[0],
      setSuggestedActions = _useSuggestedActions2[1];

  var _useStyleOptions = useStyleOptions(),
      _useStyleOptions2 = _slicedToArray(_useStyleOptions, 1),
      suggestedActionsStackedLayoutButtonTextWrap = _useStyleOptions2[0].suggestedActionsStackedLayoutButtonTextWrap;

  var _useStyleSet = (0, _useStyleSet3.default)(),
      _useStyleSet2 = _slicedToArray(_useStyleSet, 1),
      suggestedActionStyleSet = _useStyleSet2[0].suggestedAction;

  var _useSuggestedActionsA = (0, _useSuggestedActionsAccessKey.default)(),
      _useSuggestedActionsA2 = _slicedToArray(_useSuggestedActionsA, 1),
      accessKey = _useSuggestedActionsA2[0];

  var _useDirection = useDirection(),
      _useDirection2 = _slicedToArray(_useDirection, 1),
      direction = _useDirection2[0];

  var _useDisabled = useDisabled(),
      _useDisabled2 = _slicedToArray(_useDisabled, 1),
      disabled = _useDisabled2[0];

  var focus = (0, _useFocus.default)();
  var focusRef = (0, _react.useRef)();
  var localizeAccessKey = (0, _useLocalizeAccessKey.default)();
  var performCardAction = usePerformCardAction();
  var rootClassName = (0, _useStyleToEmotionObject.default)()(ROOT_STYLE) + '';
  var scrollToEnd = (0, _useScrollToEnd.default)();

  var _useFocusVisible = (0, _useFocusVisible3.default)(focusRef),
      _useFocusVisible2 = _slicedToArray(_useFocusVisible, 1),
      focusVisible = _useFocusVisible2[0];

  var handleClick = (0, _react.useCallback)(function (_ref4) {
    var target = _ref4.target;
    // TODO: [P3] #XXX We should not destruct DirectLineCardAction into React props and pass them in. It makes typings difficult.
    //       Instead, we should pass a "cardAction" props.
    performCardAction({
      displayText: displayText,
      text: text,
      type: type,
      value: value
    }, {
      target: target
    }); // Since "openUrl" action do not submit, the suggested action buttons do not hide after click.

    type === 'openUrl' && setSuggestedActions([]);
    focus('sendBoxWithoutKeyboard');
    scrollToEnd();
  }, [displayText, focus, performCardAction, scrollToEnd, setSuggestedActions, text, type, value]);
  (0, _useFocusAccessKeyEffect.default)(accessKey, focusRef);
  return /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, _extends({}, accessKey ? {
    'aria-keyshortcuts': localizeAccessKey(accessKey)
  } : {}, {
    className: (0, _classnames.default)('webchat__suggested-action', {
      'webchat__suggested-action--focus-visible': focusVisible,
      'webchat__suggested-action--rtl': direction === 'rtl',
      'webchat__suggested-action--wrapping': suggestedActionsStackedLayoutButtonTextWrap
    }, rootClassName, suggestedActionStyleSet + '', (className || '') + ''),
    disabled: disabled,
    onClick: handleClick,
    ref: focusRef,
    type: "button"
  }), image && /*#__PURE__*/_react.default.createElement("img", {
    alt: imageAlt,
    className: (0, _classnames.default)('webchat__suggested-action__image', direction === 'rtl' && 'webchat__suggested-action__image--rtl'),
    src: image
  }), /*#__PURE__*/_react.default.createElement("span", {
    className: (0, _classnames.default)('webchat__suggested-action__text', (textClassName || '') + '')
  }, buttonText), /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__suggested-action__keyboard-focus-indicator"
  }));
};

SuggestedAction.defaultProps = {
  className: '',
  displayText: '',
  image: '',
  imageAlt: undefined,
  text: '',
  textClassName: '',
  type: undefined,
  value: undefined
};
SuggestedAction.propTypes = {
  buttonText: _propTypes.default.string.isRequired,
  className: _propTypes.default.string,
  displayText: _propTypes.default.string,
  image: _propTypes.default.string,
  imageAlt: _propTypes.default.string,
  text: _propTypes.default.string,
  textClassName: _propTypes.default.string,
  // TypeScript class is not mappable to PropTypes.
  // @ts-ignore
  type: _propTypes.default.string,
  value: _propTypes.default.any
};
var _default = SuggestedAction;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TZW5kQm94L1N1Z2dlc3RlZEFjdGlvbi50c3giXSwibmFtZXMiOlsidXNlRGlyZWN0aW9uIiwiaG9va3MiLCJ1c2VEaXNhYmxlZCIsInVzZVBlcmZvcm1DYXJkQWN0aW9uIiwidXNlU3R5bGVPcHRpb25zIiwidXNlU3VnZ2VzdGVkQWN0aW9ucyIsIlJPT1RfU1RZTEUiLCJkaXNwbGF5Iiwib3ZlcmZsb3ciLCJjb25uZWN0U3VnZ2VzdGVkQWN0aW9uIiwic2VsZWN0b3JzIiwiY29ubmVjdFRvV2ViQ2hhdCIsImNsZWFyU3VnZ2VzdGVkQWN0aW9ucyIsImRpc2FibGVkIiwibGFuZ3VhZ2UiLCJvbkNhcmRBY3Rpb24iLCJkaXNwbGF5VGV4dCIsInRleHQiLCJ0eXBlIiwidmFsdWUiLCJjbGljayIsIlN1Z2dlc3RlZEFjdGlvbiIsImJ1dHRvblRleHQiLCJjbGFzc05hbWUiLCJpbWFnZSIsImltYWdlQWx0IiwidGV4dENsYXNzTmFtZSIsIl8iLCJzZXRTdWdnZXN0ZWRBY3Rpb25zIiwic3VnZ2VzdGVkQWN0aW9uc1N0YWNrZWRMYXlvdXRCdXR0b25UZXh0V3JhcCIsInN1Z2dlc3RlZEFjdGlvblN0eWxlU2V0Iiwic3VnZ2VzdGVkQWN0aW9uIiwiYWNjZXNzS2V5IiwiZGlyZWN0aW9uIiwiZm9jdXMiLCJmb2N1c1JlZiIsImxvY2FsaXplQWNjZXNzS2V5IiwicGVyZm9ybUNhcmRBY3Rpb24iLCJyb290Q2xhc3NOYW1lIiwic2Nyb2xsVG9FbmQiLCJmb2N1c1Zpc2libGUiLCJoYW5kbGVDbGljayIsInRhcmdldCIsImRlZmF1bHRQcm9wcyIsInVuZGVmaW5lZCIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsInN0cmluZyIsImlzUmVxdWlyZWQiLCJhbnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7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QSxLQUFLLEVBQUVzQixtQkFBVUMsTUFKUztBQUsxQnRCLEVBQUFBLFFBQVEsRUFBRXFCLG1CQUFVQyxNQUxNO0FBTTFCOUIsRUFBQUEsSUFBSSxFQUFFNkIsbUJBQVVDLE1BTlU7QUFPMUJyQixFQUFBQSxhQUFhLEVBQUVvQixtQkFBVUMsTUFQQztBQVExQjtBQUNBO0FBQ0E3QixFQUFBQSxJQUFJLEVBQUU0QixtQkFBVUMsTUFWVTtBQVcxQjVCLEVBQUFBLEtBQUssRUFBRTJCLG1CQUFVRztBQVhTLENBQTVCO2VBY2U1QixlIiwic291cmNlUm9vdCI6ImNvbXBvbmVudDovLy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBob29rcyB9IGZyb20gJ2JvdGZyYW1ld29yay13ZWJjaGF0LWFwaSc7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QsIHsgTW91c2VFdmVudEhhbmRsZXIsIHVzZUNhbGxiYWNrLCB1c2VSZWYsIFZGQyB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSAnLi4vVXRpbHMvQWNjZXNzaWJsZUJ1dHRvbic7XG5pbXBvcnQgY29ubmVjdFRvV2ViQ2hhdCBmcm9tICcuLi9jb25uZWN0VG9XZWJDaGF0JztcbmltcG9ydCB1c2VGb2N1cyBmcm9tICcuLi9ob29rcy91c2VGb2N1cyc7XG5pbXBvcnQgdXNlRm9jdXNBY2Nlc3NLZXlFZmZlY3QgZnJvbSAnLi4vVXRpbHMvQWNjZXNzS2V5U2luay91c2VGb2N1c0FjY2Vzc0tleUVmZmVjdCc7XG5pbXBvcnQgdXNlRm9jdXNWaXNpYmxlIGZyb20gJy4uL2hvb2tzL2ludGVybmFsL3VzZUZvY3VzVmlzaWJsZSc7XG5pbXBvcnQgdXNlTG9jYWxpemVBY2Nlc3NLZXkgZnJvbSAnLi4vaG9va3MvaW50ZXJuYWwvdXNlTG9jYWxpemVBY2Nlc3NLZXknO1xuaW1wb3J0IHVzZVNjcm9sbFRvRW5kIGZyb20gJy4uL2hvb2tzL3VzZVNjcm9sbFRvRW5kJztcbmltcG9ydCB1c2VTdWdnZXN0ZWRBY3Rpb25zQWNjZXNzS2V5IGZyb20gJy4uL2hvb2tzL2ludGVybmFsL3VzZVN1Z2dlc3RlZEFjdGlvbnNBY2Nlc3NLZXknO1xuaW1wb3J0IHVzZVN0eWxlU2V0IGZyb20gJy4uL2hvb2tzL3VzZVN0eWxlU2V0JztcbmltcG9ydCB1c2VTdHlsZVRvRW1vdGlvbk9iamVjdCBmcm9tICcuLi9ob29rcy9pbnRlcm5hbC91c2VTdHlsZVRvRW1vdGlvbk9iamVjdCc7XG5pbXBvcnQgeyBEaXJlY3RMaW5lQ2FyZEFjdGlvbiB9IGZyb20gJ2JvdGZyYW1ld29yay13ZWJjaGF0LWNvcmUnO1xuXG5jb25zdCB7IHVzZURpcmVjdGlvbiwgdXNlRGlzYWJsZWQsIHVzZVBlcmZvcm1DYXJkQWN0aW9uLCB1c2VTdHlsZU9wdGlvbnMsIHVzZVN1Z2dlc3RlZEFjdGlvbnMgfSA9IGhvb2tzO1xuXG5jb25zdCBST09UX1NUWUxFID0ge1xuICAnJi53ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uJzoge1xuICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICBvdmVyZmxvdzogJ2hpZGRlbicgLy8gUHJldmVudCBpbWFnZSBmcm9tIGxlYWtpbmc7IG9iamVjdC1maXQgZG9lcyBub3Qgd29yayB3aXRoIElFMTFcbiAgfVxufTtcblxuY29uc3QgY29ubmVjdFN1Z2dlc3RlZEFjdGlvbiA9ICguLi5zZWxlY3RvcnMpID0+XG4gIGNvbm5lY3RUb1dlYkNoYXQoXG4gICAgKHsgY2xlYXJTdWdnZXN0ZWRBY3Rpb25zLCBkaXNhYmxlZCwgbGFuZ3VhZ2UsIG9uQ2FyZEFjdGlvbiB9LCB7IGRpc3BsYXlUZXh0LCB0ZXh0LCB0eXBlLCB2YWx1ZSB9KSA9PiAoe1xuICAgICAgY2xpY2s6ICgpID0+IHtcbiAgICAgICAgb25DYXJkQWN0aW9uKHsgZGlzcGxheVRleHQsIHRleHQsIHR5cGUsIHZhbHVlIH0pO1xuICAgICAgICB0eXBlID09PSAnb3BlblVybCcgJiYgY2xlYXJTdWdnZXN0ZWRBY3Rpb25zKCk7XG4gICAgICB9LFxuICAgICAgZGlzYWJsZWQsXG4gICAgICBsYW5ndWFnZVxuICAgIH0pLFxuICAgIC4uLnNlbGVjdG9yc1xuICApO1xuXG50eXBlIFN1Z2dlc3RlZEFjdGlvblByb3BzID0ge1xuICBidXR0b25UZXh0OiBzdHJpbmc7XG4gIGNsYXNzTmFtZT86IHN0cmluZztcbiAgZGlzcGxheVRleHQ/OiBzdHJpbmc7XG4gIGltYWdlPzogc3RyaW5nO1xuICBpbWFnZUFsdD86IHN0cmluZztcbiAgdGV4dD86IHN0cmluZztcbiAgdGV4dENsYXNzTmFtZT86IHN0cmluZztcbiAgdHlwZT86XG4gICAgfCAnY2FsbCdcbiAgICB8ICdkb3dubG9hZEZpbGUnXG4gICAgfCAnaW1CYWNrJ1xuICAgIHwgJ21lc3NhZ2VCYWNrJ1xuICAgIHwgJ29wZW5VcmwnXG4gICAgfCAncGxheUF1ZGlvJ1xuICAgIHwgJ3BsYXlWaWRlbydcbiAgICB8ICdwb3N0QmFjaydcbiAgICB8ICdzaG93SW1hZ2UnXG4gICAgfCAnc2lnbmluJztcbiAgdmFsdWU/OiBhbnk7XG59O1xuXG5jb25zdCBTdWdnZXN0ZWRBY3Rpb246IFZGQzxTdWdnZXN0ZWRBY3Rpb25Qcm9wcz4gPSAoe1xuICBidXR0b25UZXh0LFxuICBjbGFzc05hbWUsXG4gIGRpc3BsYXlUZXh0LFxuICBpbWFnZSxcbiAgaW1hZ2VBbHQsXG4gIHRleHQsXG4gIHRleHRDbGFzc05hbWUsXG4gIHR5cGUsXG4gIHZhbHVlXG59KSA9PiB7XG4gIGNvbnN0IFtfLCBzZXRTdWdnZXN0ZWRBY3Rpb25zXSA9IHVzZVN1Z2dlc3RlZEFjdGlvbnMoKTtcbiAgY29uc3QgW3sgc3VnZ2VzdGVkQWN0aW9uc1N0YWNrZWRMYXlvdXRCdXR0b25UZXh0V3JhcCB9XSA9IHVzZVN0eWxlT3B0aW9ucygpO1xuICBjb25zdCBbeyBzdWdnZXN0ZWRBY3Rpb246IHN1Z2dlc3RlZEFjdGlvblN0eWxlU2V0IH1dID0gdXNlU3R5bGVTZXQoKTtcbiAgY29uc3QgW2FjY2Vzc0tleV0gPSB1c2VTdWdnZXN0ZWRBY3Rpb25zQWNjZXNzS2V5KCk7XG4gIGNvbnN0IFtkaXJlY3Rpb25dID0gdXNlRGlyZWN0aW9uKCk7XG4gIGNvbnN0IFtkaXNhYmxlZF0gPSB1c2VEaXNhYmxlZCgpO1xuICBjb25zdCBmb2N1cyA9IHVzZUZvY3VzKCk7XG4gIGNvbnN0IGZvY3VzUmVmID0gdXNlUmVmKCk7XG4gIGNvbnN0IGxvY2FsaXplQWNjZXNzS2V5ID0gdXNlTG9jYWxpemVBY2Nlc3NLZXkoKTtcbiAgY29uc3QgcGVyZm9ybUNhcmRBY3Rpb24gPSB1c2VQZXJmb3JtQ2FyZEFjdGlvbigpO1xuICBjb25zdCByb290Q2xhc3NOYW1lID0gdXNlU3R5bGVUb0Vtb3Rpb25PYmplY3QoKShST09UX1NUWUxFKSArICcnO1xuICBjb25zdCBzY3JvbGxUb0VuZCA9IHVzZVNjcm9sbFRvRW5kKCk7XG5cbiAgY29uc3QgW2ZvY3VzVmlzaWJsZV0gPSB1c2VGb2N1c1Zpc2libGUoZm9jdXNSZWYpO1xuXG4gIGNvbnN0IGhhbmRsZUNsaWNrID0gdXNlQ2FsbGJhY2s8TW91c2VFdmVudEhhbmRsZXI8SFRNTEJ1dHRvbkVsZW1lbnQ+PihcbiAgICAoeyB0YXJnZXQgfSkgPT4ge1xuICAgICAgLy8gVE9ETzogW1AzXSAjWFhYIFdlIHNob3VsZCBub3QgZGVzdHJ1Y3QgRGlyZWN0TGluZUNhcmRBY3Rpb24gaW50byBSZWFjdCBwcm9wcyBhbmQgcGFzcyB0aGVtIGluLiBJdCBtYWtlcyB0eXBpbmdzIGRpZmZpY3VsdC5cbiAgICAgIC8vICAgICAgIEluc3RlYWQsIHdlIHNob3VsZCBwYXNzIGEgXCJjYXJkQWN0aW9uXCIgcHJvcHMuXG4gICAgICBwZXJmb3JtQ2FyZEFjdGlvbih7IGRpc3BsYXlUZXh0LCB0ZXh0LCB0eXBlLCB2YWx1ZSB9IGFzIERpcmVjdExpbmVDYXJkQWN0aW9uLCB7IHRhcmdldCB9KTtcblxuICAgICAgLy8gU2luY2UgXCJvcGVuVXJsXCIgYWN0aW9uIGRvIG5vdCBzdWJtaXQsIHRoZSBzdWdnZXN0ZWQgYWN0aW9uIGJ1dHRvbnMgZG8gbm90IGhpZGUgYWZ0ZXIgY2xpY2suXG4gICAgICB0eXBlID09PSAnb3BlblVybCcgJiYgc2V0U3VnZ2VzdGVkQWN0aW9ucyhbXSk7XG5cbiAgICAgIGZvY3VzKCdzZW5kQm94V2l0aG91dEtleWJvYXJkJyk7XG4gICAgICBzY3JvbGxUb0VuZCgpO1xuICAgIH0sXG4gICAgW2Rpc3BsYXlUZXh0LCBmb2N1cywgcGVyZm9ybUNhcmRBY3Rpb24sIHNjcm9sbFRvRW5kLCBzZXRTdWdnZXN0ZWRBY3Rpb25zLCB0ZXh0LCB0eXBlLCB2YWx1ZV1cbiAgKTtcblxuICB1c2VGb2N1c0FjY2Vzc0tleUVmZmVjdChhY2Nlc3NLZXksIGZvY3VzUmVmKTtcblxuICByZXR1cm4gKFxuICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICB7Li4uKGFjY2Vzc0tleSA/IHsgJ2FyaWEta2V5c2hvcnRjdXRzJzogbG9jYWxpemVBY2Nlc3NLZXkoYWNjZXNzS2V5KSB9IDoge30pfVxuICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFxuICAgICAgICAnd2ViY2hhdF9fc3VnZ2VzdGVkLWFjdGlvbicsXG4gICAgICAgIHtcbiAgICAgICAgICAnd2ViY2hhdF9fc3VnZ2VzdGVkLWFjdGlvbi0tZm9jdXMtdmlzaWJsZSc6IGZvY3VzVmlzaWJsZSxcbiAgICAgICAgICAnd2ViY2hhdF9fc3VnZ2VzdGVkLWFjdGlvbi0tcnRsJzogZGlyZWN0aW9uID09PSAncnRsJyxcbiAgICAgICAgICAnd2ViY2hhdF9fc3VnZ2VzdGVkLWFjdGlvbi0td3JhcHBpbmcnOiBzdWdnZXN0ZWRBY3Rpb25zU3RhY2tlZExheW91dEJ1dHRvblRleHRXcmFwXG4gICAgICAgIH0sXG4gICAgICAgIHJvb3RDbGFzc05hbWUsXG4gICAgICAgIHN1Z2dlc3RlZEFjdGlvblN0eWxlU2V0ICsgJycsXG4gICAgICAgIChjbGFzc05hbWUgfHwgJycpICsgJydcbiAgICAgICl9XG4gICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICBvbkNsaWNrPXtoYW5kbGVDbGlja31cbiAgICAgIHJlZj17Zm9jdXNSZWZ9XG4gICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICA+XG4gICAgICB7aW1hZ2UgJiYgKFxuICAgICAgICA8aW1nXG4gICAgICAgICAgYWx0PXtpbWFnZUFsdH1cbiAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXG4gICAgICAgICAgICAnd2ViY2hhdF9fc3VnZ2VzdGVkLWFjdGlvbl9faW1hZ2UnLFxuICAgICAgICAgICAgZGlyZWN0aW9uID09PSAncnRsJyAmJiAnd2ViY2hhdF9fc3VnZ2VzdGVkLWFjdGlvbl9faW1hZ2UtLXJ0bCdcbiAgICAgICAgICApfVxuICAgICAgICAgIHNyYz17aW1hZ2V9XG4gICAgICAgIC8+XG4gICAgICApfVxuICAgICAgPHNwYW4gY2xhc3NOYW1lPXtjbGFzc05hbWVzKCd3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uX190ZXh0JywgKHRleHRDbGFzc05hbWUgfHwgJycpICsgJycpfT57YnV0dG9uVGV4dH08L3NwYW4+XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cIndlYmNoYXRfX3N1Z2dlc3RlZC1hY3Rpb25fX2tleWJvYXJkLWZvY3VzLWluZGljYXRvclwiIC8+XG4gICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICApO1xufTtcblxuU3VnZ2VzdGVkQWN0aW9uLmRlZmF1bHRQcm9wcyA9IHtcbiAgY2xhc3NOYW1lOiAnJyxcbiAgZGlzcGxheVRleHQ6ICcnLFxuICBpbWFnZTogJycsXG4gIGltYWdlQWx0OiB1bmRlZmluZWQsXG4gIHRleHQ6ICcnLFxuICB0ZXh0Q2xhc3NOYW1lOiAnJyxcbiAgdHlwZTogdW5kZWZpbmVkLFxuICB2YWx1ZTogdW5kZWZpbmVkXG59O1xuXG5TdWdnZXN0ZWRBY3Rpb24ucHJvcFR5cGVzID0ge1xuICBidXR0b25UZXh0OiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgZGlzcGxheVRleHQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGltYWdlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBpbWFnZUFsdDogUHJvcFR5cGVzLnN0cmluZyxcbiAgdGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgdGV4dENsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgLy8gVHlwZVNjcmlwdCBjbGFzcyBpcyBub3QgbWFwcGFibGUgdG8gUHJvcFR5cGVzLlxuICAvLyBAdHMtaWdub3JlXG4gIHR5cGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHZhbHVlOiBQcm9wVHlwZXMuYW55XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTdWdnZXN0ZWRBY3Rpb247XG5cbmV4cG9ydCB7IGNvbm5lY3RTdWdnZXN0ZWRBY3Rpb24gfTtcbiJdfQ==