"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = useActivityAccessibleName;

var _botframeworkWebchatApi = require("botframework-webchat-api");

var _react = require("react");

var _activityAltText = _interopRequireDefault(require("../Utils/activityAltText"));

var _tabbableElements = _interopRequireDefault(require("../Utils/tabbableElements"));

var _useRenderMarkdownAsHTML = _interopRequireDefault(require("../hooks/useRenderMarkdownAsHTML"));

var _useValueRef = _interopRequireDefault(require("../hooks/internal/useValueRef"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var InteractiveType;

(function (InteractiveType) {
  InteractiveType[InteractiveType["LINK"] = 0] = "LINK";
  InteractiveType[InteractiveType["WIDGET"] = 1] = "WIDGET";
})(InteractiveType || (InteractiveType = {}));

var useAvatarForBot = _botframeworkWebchatApi.hooks.useAvatarForBot,
    useLocalizer = _botframeworkWebchatApi.hooks.useLocalizer;
var ACTIVITY_NUM_ATTACHMENTS_ALT_IDS = {
  few: 'ACTIVITY_NUM_ATTACHMENTS_FEW_ALT',
  many: 'ACTIVITY_NUM_ATTACHMENTS_MANY_ALT',
  one: 'ACTIVITY_NUM_ATTACHMENTS_ONE_ALT',
  other: 'ACTIVITY_NUM_ATTACHMENTS_OTHER_ALT',
  two: 'ACTIVITY_NUM_ATTACHMENTS_TWO_ALT'
};

function useActivityAccessibleName(activity, bodyRef) {
  var _activity$from, _activity$attachments;

  var _useAvatarForBot = useAvatarForBot(),
      _useAvatarForBot2 = _slicedToArray(_useAvatarForBot, 1),
      botInitials = _useAvatarForBot2[0].initials;

  var _useState = (0, _react.useState)(false),
      _useState2 = _slicedToArray(_useState, 2),
      interactiveType = _useState2[0],
      setInteractiveType = _useState2[1];

  var fromSelf = ((_activity$from = activity.from) === null || _activity$from === void 0 ? void 0 : _activity$from.role) === 'user';
  var localize = useLocalizer();
  var localizeWithPlural = useLocalizer({
    plural: true
  });
  var numAttachments = ((_activity$attachments = activity.attachments) === null || _activity$attachments === void 0 ? void 0 : _activity$attachments.length) || 0;
  var renderMarkdownAsHTML = (0, _useRenderMarkdownAsHTML.default)();
  var activityInteractiveAlt = localize('ACTIVITY_INTERACTIVE_LABEL_ALT'); // "Click to interact."

  var activityInteractiveWithLinkAlt = localize('ACTIVITY_INTERACTIVE_WITH_LINKS_LABEL_ALT'); // "Click to interact."

  var greetingAlt = (0, _react.useMemo)(function () {
    return (fromSelf ? localize('ACTIVITY_YOU_SAID_ALT') : localize('ACTIVITY_BOT_SAID_ALT', botInitials || '')).replace(/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]{2,}/g, ' ');
  }, [botInitials, fromSelf, localize]);
  var interactiveTypeRef = (0, _useValueRef.default)(interactiveType);
  var messageTextAlt = (0, _react.useMemo)(function () {
    return (0, _activityAltText.default)(activity, renderMarkdownAsHTML);
  }, [activity, renderMarkdownAsHTML]);
  var numAttachmentsAlt = (0, _react.useMemo)(function () {
    return numAttachments ? localizeWithPlural(ACTIVITY_NUM_ATTACHMENTS_ALT_IDS, numAttachments) : '';
  }, [localizeWithPlural, numAttachments]);
  var accessibleName = (0, _react.useMemo)( // We are concatenating in a single string for Safari. If we split it up, Safari will only narrate the first section.
  function () {
    return "".concat(greetingAlt, " ").concat(messageTextAlt, " ").concat(numAttachmentsAlt, " ").concat(interactiveType === InteractiveType.LINK ? activityInteractiveWithLinkAlt : interactiveType === InteractiveType.WIDGET ? activityInteractiveAlt : '');
  }, [activityInteractiveAlt, activityInteractiveWithLinkAlt, greetingAlt, interactiveType, messageTextAlt, numAttachmentsAlt]);
  (0, _react.useEffect)(function () {
    var _bodyRef$current;

    var hasLinks = !!((_bodyRef$current = bodyRef.current) !== null && _bodyRef$current !== void 0 && _bodyRef$current.querySelector('a'));
    var hasWidgets = !!(0, _tabbableElements.default)(bodyRef.current).length;
    interactiveTypeRef.current !== hasWidgets && setInteractiveType(hasLinks ? InteractiveType.LINK : hasWidgets ? InteractiveType.WIDGET : false);
  }, [bodyRef, interactiveTypeRef, setInteractiveType]);
  return [accessibleName];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9UcmFuc2NyaXB0L3VzZUFjdGl2aXR5QWNjZXNzaWJsZU5hbWUudHMiXSwibmFtZXMiOlsiSW50ZXJhY3RpdmVUeXBlIiwidXNlQXZhdGFyRm9yQm90IiwiaG9va3MiLCJ1c2VMb2NhbGl6ZXIiLCJBQ1RJVklUWV9OVU1fQVRUQUNITUVOVFNfQUxUX0lEUyIsImZldyIsIm1hbnkiLCJvbmUiLCJvdGhlciIsInR3byIsInVzZUFjdGl2aXR5QWNjZXNzaWJsZU5hbWUiLCJhY3Rpdml0eSIsImJvZHlSZWYiLCJib3RJbml0aWFscyIsImluaXRpYWxzIiwiaW50ZXJhY3RpdmVUeXBlIiwic2V0SW50ZXJhY3RpdmVUeXBlIiwiZnJvbVNlbGYiLCJmcm9tIiwicm9sZSIsImxvY2FsaXplIiwibG9jYWxpemVXaXRoUGx1cmFsIiwicGx1cmFsIiwibnVtQXR0YWNobWVudHMiLCJhdHRhY2htZW50cyIsImxlbmd0aCIsInJlbmRlck1hcmtkb3duQXNIVE1MIiwiYWN0aXZpdHlJbnRlcmFjdGl2ZUFsdCIsImFjdGl2aXR5SW50ZXJhY3RpdmVXaXRoTGlua0FsdCIsImdyZWV0aW5nQWx0IiwicmVwbGFjZSIsImludGVyYWN0aXZlVHlwZVJlZiIsIm1lc3NhZ2VUZXh0QWx0IiwibnVtQXR0YWNobWVudHNBbHQiLCJhY2Nlc3NpYmxlTmFtZSIsIkxJTksiLCJXSURHRVQiLCJoYXNMaW5rcyIsImN1cnJlbnQiLCJxdWVyeVNlbGVjdG9yIiwiaGFzV2lkZ2V0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUtBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7O0lBRUtBLGU7O1dBQUFBLGU7QUFBQUEsRUFBQUEsZSxDQUFBQSxlO0FBQUFBLEVBQUFBLGUsQ0FBQUEsZTtHQUFBQSxlLEtBQUFBLGU7O0FBS0wsSUFBUUMsZUFBUixHQUEwQ0MsNkJBQTFDLENBQVFELGVBQVI7QUFBQSxJQUF5QkUsWUFBekIsR0FBMENELDZCQUExQyxD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dkQ7QUFFQU0sSUFBQUEsa0JBQWtCLENBQUNPLE9BQW5CLEtBQStCRSxVQUEvQixJQUNFeEIsa0JBQWtCLENBQUNxQixRQUFRLEdBQUdyQyxlQUFlLENBQUNtQyxJQUFuQixHQUEwQkssVUFBVSxHQUFHeEMsZUFBZSxDQUFDb0MsTUFBbkIsR0FBNEIsS0FBekUsQ0FEcEI7QUFFRCxHQU5ELEVBTUcsQ0FBQ3hCLE9BQUQsRUFBVW1CLGtCQUFWLEVBQThCZixrQkFBOUIsQ0FOSDtBQVFBLFNBQU8sQ0FBQ2tCLGNBQUQsQ0FBUDtBQUNEIiwic291cmNlUm9vdCI6ImNvbXBvbmVudDovLy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBob29rcyB9IGZyb20gJ2JvdGZyYW1ld29yay13ZWJjaGF0LWFwaSc7XG5pbXBvcnQgeyB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgdHlwZSB7IERpcmVjdExpbmVBY3Rpdml0eSB9IGZyb20gJ2JvdGZyYW1ld29yay13ZWJjaGF0LWNvcmUnO1xuaW1wb3J0IHR5cGUgeyBSZWZPYmplY3QgfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCBhY3Rpdml0eUFsdFRleHQgZnJvbSAnLi4vVXRpbHMvYWN0aXZpdHlBbHRUZXh0JztcbmltcG9ydCB0YWJiYWJsZUVsZW1lbnRzIGZyb20gJy4uL1V0aWxzL3RhYmJhYmxlRWxlbWVudHMnO1xuaW1wb3J0IHVzZVJlbmRlck1hcmtkb3duQXNIVE1MIGZyb20gJy4uL2hvb2tzL3VzZVJlbmRlck1hcmtkb3duQXNIVE1MJztcbmltcG9ydCB1c2VWYWx1ZVJlZiBmcm9tICcuLi9ob29rcy9pbnRlcm5hbC91c2VWYWx1ZVJlZic7XG5cbmVudW0gSW50ZXJhY3RpdmVUeXBlIHtcbiAgTElOSyxcbiAgV0lER0VUXG59XG5cbmNvbnN0IHsgdXNlQXZhdGFyRm9yQm90LCB1c2VMb2NhbGl6ZXIgfSA9IGhvb2tzO1xuXG5jb25zdCBBQ1RJVklUWV9OVU1fQVRUQUNITUVOVFNfQUxUX0lEUyA9IHtcbiAgZmV3OiAnQUNUSVZJVFlfTlVNX0FUVEFDSE1FTlRTX0ZFV19BTFQnLFxuICBtYW55OiAnQUNUSVZJVFlfTlVNX0FUVEFDSE1FTlRTX01BTllfQUxUJyxcbiAgb25lOiAnQUNUSVZJVFlfTlVNX0FUVEFDSE1FTlRTX09ORV9BTFQnLFxuICBvdGhlcjogJ0FDVElWSVRZX05VTV9BVFRBQ0hNRU5UU19PVEhFUl9BTFQnLFxuICB0d286ICdBQ1RJVklUWV9OVU1fQVRUQUNITUVOVFNfVFdPX0FMVCdcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHVzZUFjdGl2aXR5QWNjZXNzaWJsZU5hbWUoYWN0aXZpdHk6IERpcmVjdExpbmVBY3Rpdml0eSwgYm9keVJlZjogUmVmT2JqZWN0PEhUTUxFbGVtZW50Pikge1xuICBjb25zdCBbeyBpbml0aWFsczogYm90SW5pdGlhbHMgfV0gPSB1c2VBdmF0YXJGb3JCb3QoKTtcbiAgY29uc3QgW2ludGVyYWN0aXZlVHlwZSwgc2V0SW50ZXJhY3RpdmVUeXBlXSA9IHVzZVN0YXRlPEludGVyYWN0aXZlVHlwZSB8IGZhbHNlPihmYWxzZSk7XG4gIGNvbnN0IGZyb21TZWxmID0gYWN0aXZpdHkuZnJvbT8ucm9sZSA9PT0gJ3VzZXInO1xuICBjb25zdCBsb2NhbGl6ZSA9IHVzZUxvY2FsaXplcigpO1xuICBjb25zdCBsb2NhbGl6ZVdpdGhQbHVyYWwgPSB1c2VMb2NhbGl6ZXIoeyBwbHVyYWw6IHRydWUgfSk7XG4gIGNvbnN0IG51bUF0dGFjaG1lbnRzID0gYWN0aXZpdHkuYXR0YWNobWVudHM/Lmxlbmd0aCB8fCAwO1xuICBjb25zdCByZW5kZXJNYXJrZG93bkFzSFRNTCA9IHVzZVJlbmRlck1hcmtkb3duQXNIVE1MKCk7XG5cbiAgY29uc3QgYWN0aXZpdHlJbnRlcmFjdGl2ZUFsdCA9IGxvY2FsaXplKCdBQ1RJVklUWV9JTlRFUkFDVElWRV9MQUJFTF9BTFQnKTsgLy8gXCJDbGljayB0byBpbnRlcmFjdC5cIlxuICBjb25zdCBhY3Rpdml0eUludGVyYWN0aXZlV2l0aExpbmtBbHQgPSBsb2NhbGl6ZSgnQUNUSVZJVFlfSU5URVJBQ1RJVkVfV0lUSF9MSU5LU19MQUJFTF9BTFQnKTsgLy8gXCJDbGljayB0byBpbnRlcmFjdC5cIlxuICBjb25zdCBncmVldGluZ0FsdCA9IHVzZU1lbW8oXG4gICAgKCkgPT5cbiAgICAgIChmcm9tU2VsZiA/IGxvY2FsaXplKCdBQ1RJVklUWV9ZT1VfU0FJRF9BTFQnKSA6IGxvY2FsaXplKCdBQ1RJVklUWV9CT1RfU0FJRF9BTFQnLCBib3RJbml0aWFscyB8fCAnJykpLnJlcGxhY2UoXG4gICAgICAgIC9cXHN7Mix9L2d1LFxuICAgICAgICAnICdcbiAgICAgICksXG4gICAgW2JvdEluaXRpYWxzLCBmcm9tU2VsZiwgbG9jYWxpemVdXG4gICk7XG4gIGNvbnN0IGludGVyYWN0aXZlVHlwZVJlZiA9IHVzZVZhbHVlUmVmKGludGVyYWN0aXZlVHlwZSk7XG4gIGNvbnN0IG1lc3NhZ2VUZXh0QWx0ID0gdXNlTWVtbyhcbiAgICAoKSA9PiBhY3Rpdml0eUFsdFRleHQoYWN0aXZpdHksIHJlbmRlck1hcmtkb3duQXNIVE1MKSxcbiAgICBbYWN0aXZpdHksIHJlbmRlck1hcmtkb3duQXNIVE1MXVxuICApO1xuICBjb25zdCBudW1BdHRhY2htZW50c0FsdCA9IHVzZU1lbW8oXG4gICAgKCkgPT4gKG51bUF0dGFjaG1lbnRzID8gbG9jYWxpemVXaXRoUGx1cmFsKEFDVElWSVRZX05VTV9BVFRBQ0hNRU5UU19BTFRfSURTLCBudW1BdHRhY2htZW50cykgOiAnJyksXG4gICAgW2xvY2FsaXplV2l0aFBsdXJhbCwgbnVtQXR0YWNobWVudHNdXG4gICk7XG5cbiAgY29uc3QgYWNjZXNzaWJsZU5hbWUgPSB1c2VNZW1vKFxuICAgIC8vIFdlIGFyZSBjb25jYXRlbmF0aW5nIGluIGEgc2luZ2xlIHN0cmluZyBmb3IgU2FmYXJpLiBJZiB3ZSBzcGxpdCBpdCB1cCwgU2FmYXJpIHdpbGwgb25seSBuYXJyYXRlIHRoZSBmaXJzdCBzZWN0aW9uLlxuICAgICgpID0+XG4gICAgICBgJHtncmVldGluZ0FsdH0gJHttZXNzYWdlVGV4dEFsdH0gJHtudW1BdHRhY2htZW50c0FsdH0gJHtcbiAgICAgICAgaW50ZXJhY3RpdmVUeXBlID09PSBJbnRlcmFjdGl2ZVR5cGUuTElOS1xuICAgICAgICAgID8gYWN0aXZpdHlJbnRlcmFjdGl2ZVdpdGhMaW5rQWx0XG4gICAgICAgICAgOiBpbnRlcmFjdGl2ZVR5cGUgPT09IEludGVyYWN0aXZlVHlwZS5XSURHRVRcbiAgICAgICAgICA/IGFjdGl2aXR5SW50ZXJhY3RpdmVBbHRcbiAgICAgICAgICA6ICcnXG4gICAgICB9YCxcbiAgICBbXG4gICAgICBhY3Rpdml0eUludGVyYWN0aXZlQWx0LFxuICAgICAgYWN0aXZpdHlJbnRlcmFjdGl2ZVdpdGhMaW5rQWx0LFxuICAgICAgZ3JlZXRpbmdBbHQsXG4gICAgICBpbnRlcmFjdGl2ZVR5cGUsXG4gICAgICBtZXNzYWdlVGV4dEFsdCxcbiAgICAgIG51bUF0dGFjaG1lbnRzQWx0XG4gICAgXVxuICApO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaGFzTGlua3MgPSAhIWJvZHlSZWYuY3VycmVudD8ucXVlcnlTZWxlY3RvcignYScpO1xuICAgIGNvbnN0IGhhc1dpZGdldHMgPSAhIXRhYmJhYmxlRWxlbWVudHMoYm9keVJlZi5jdXJyZW50KS5sZW5ndGg7XG5cbiAgICBpbnRlcmFjdGl2ZVR5cGVSZWYuY3VycmVudCAhPT0gaGFzV2lkZ2V0cyAmJlxuICAgICAgc2V0SW50ZXJhY3RpdmVUeXBlKGhhc0xpbmtzID8gSW50ZXJhY3RpdmVUeXBlLkxJTksgOiBoYXNXaWRnZXRzID8gSW50ZXJhY3RpdmVUeXBlLldJREdFVCA6IGZhbHNlKTtcbiAgfSwgW2JvZHlSZWYsIGludGVyYWN0aXZlVHlwZVJlZiwgc2V0SW50ZXJhY3RpdmVUeXBlXSk7XG5cbiAgcmV0dXJuIFthY2Nlc3NpYmxlTmFtZV07XG59XG4iXX0=