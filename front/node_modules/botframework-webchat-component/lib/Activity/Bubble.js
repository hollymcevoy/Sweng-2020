"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _botframeworkWebchatApi = require("botframework-webchat-api");

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _isZeroOrPositive = _interopRequireDefault(require("../Utils/isZeroOrPositive"));

var _useStyleSet3 = _interopRequireDefault(require("../hooks/useStyleSet"));

var _useStyleToEmotionObject = _interopRequireDefault(require("../hooks/internal/useStyleToEmotionObject"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var useDirection = _botframeworkWebchatApi.hooks.useDirection,
    useStyleOptions = _botframeworkWebchatApi.hooks.useStyleOptions;
var ROOT_STYLE = {
  '&.webchat__bubble': {
    display: 'flex',
    position: 'relative',
    '& .webchat__bubble__nub-pad': {
      flexShrink: 0
    },
    '& .webchat__bubble__content': {
      flexGrow: 1,
      // This is for hiding content outside of the bubble, for example, content outside of border radius
      overflow: 'hidden'
    }
  }
};

function acuteNubSVG(nubSize, strokeWidth, side) {
  var upSideDown = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;

  if (typeof nubSize !== 'number') {
    return false;
  }

  var halfNubSize = nubSize / 2;
  var halfStrokeWidth = strokeWidth / 2; // Horizontally mirror the nub if it is from user

  var horizontalTransform = side === 'bot' ? '' : "translate(".concat(halfNubSize, " 0) scale(-1 1) translate(").concat(-halfNubSize, " 0)"); // Vertically mirror the nub if it is up-side-down

  var verticalTransform = upSideDown ? "translate(0 ".concat(halfNubSize, ") scale(1 -1) translate(0 ").concat(-halfNubSize, ")") : '';
  var p1 = [nubSize, halfStrokeWidth].join(' ');
  var p2 = [strokeWidth, halfStrokeWidth].join(' ');
  var p3 = [nubSize + strokeWidth, nubSize + halfStrokeWidth].join(' ');
  return /*#__PURE__*/_react.default.createElement("svg", {
    className: "webchat__bubble__nub",
    version: "1.1",
    viewBox: "0 0 ".concat(nubSize, " ").concat(nubSize),
    xmlns: "http://www.w3.org/2000/svg"
  }, /*#__PURE__*/_react.default.createElement("g", {
    transform: "".concat(horizontalTransform, " ").concat(verticalTransform)
  }, /*#__PURE__*/_react.default.createElement("path", {
    className: "webchat__bubble__nub-outline",
    d: "M".concat(p1, " L").concat(p2, " L").concat(p3)
  })));
}

var Bubble = function Bubble(_ref) {
  var ariaHidden = _ref['aria-hidden'],
      children = _ref.children,
      className = _ref.className,
      fromUser = _ref.fromUser,
      nub = _ref.nub;

  var _useStyleSet = (0, _useStyleSet3.default)(),
      _useStyleSet2 = _slicedToArray(_useStyleSet, 1),
      bubbleStyleSet = _useStyleSet2[0].bubble;

  var _useDirection = useDirection(),
      _useDirection2 = _slicedToArray(_useDirection, 1),
      direction = _useDirection2[0];

  var _useStyleOptions = useStyleOptions(),
      _useStyleOptions2 = _slicedToArray(_useStyleOptions, 1),
      _useStyleOptions2$ = _useStyleOptions2[0],
      bubbleBorderWidth = _useStyleOptions2$.bubbleBorderWidth,
      bubbleFromUserBorderWidth = _useStyleOptions2$.bubbleFromUserBorderWidth,
      bubbleFromUserNubSize = _useStyleOptions2$.bubbleFromUserNubSize,
      bubbleNubSize = _useStyleOptions2$.bubbleNubSize,
      bubbleNubOffset = _useStyleOptions2$.bubbleNubOffset,
      bubbleFromUserNubOffset = _useStyleOptions2$.bubbleFromUserNubOffset;

  var rootClassName = (0, _useStyleToEmotionObject.default)()(ROOT_STYLE) + '';

  var _ref2 = fromUser ? {
    borderWidth: bubbleFromUserBorderWidth,
    nubOffset: bubbleFromUserNubOffset,
    nubSize: bubbleFromUserNubSize,
    side: 'user'
  } : {
    borderWidth: bubbleBorderWidth,
    nubOffset: bubbleNubOffset,
    nubSize: bubbleNubSize,
    side: 'bot'
  },
      borderWidth = _ref2.borderWidth,
      nubOffset = _ref2.nubOffset,
      nubSize = _ref2.nubSize,
      side = _ref2.side;

  return /*#__PURE__*/_react.default.createElement("div", {
    "aria-hidden": ariaHidden,
    className: (0, _classnames.default)('webchat__bubble', {
      'webchat__bubble--from-user': fromUser,
      'webchat__bubble--hide-nub': nub !== true && nub !== false,
      'webchat__bubble--nub-on-top': (0, _isZeroOrPositive.default)(nubOffset),
      'webchat__bubble--rtl': direction === 'rtl',
      'webchat__bubble--show-nub': nub === true
    }, rootClassName, bubbleStyleSet + '', (className || '') + '')
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__bubble__nub-pad"
  }), /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__bubble__content"
  }, children), nub === true && acuteNubSVG(nubSize, borderWidth, side, !(0, _isZeroOrPositive.default)(nubOffset)));
};

Bubble.defaultProps = {
  'aria-hidden': undefined,
  children: undefined,
  className: '',
  fromUser: false,
  nub: false
};
Bubble.propTypes = {
  'aria-hidden': _propTypes.default.bool,
  children: _propTypes.default.any,
  className: _propTypes.default.string,
  fromUser: _propTypes.default.bool,
  nub: _propTypes.default.oneOf([true, false, 'hidden'])
};
var _default = Bubble;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BY3Rpdml0eS9CdWJibGUudHN4Il0sIm5hbWVzIjpbInVzZURpcmVjdGlvbiIsImhvb2tzIiwidXNlU3R5bGVPcHRpb25zIiwiUk9PVF9TVFlMRSIsImRpc3BsYXkiLCJwb3NpdGlvbiIsImZsZXhTaHJpbmsiLCJmbGV4R3JvdyIsIm92ZXJmbG93IiwiYWN1dGVOdWJTVkciLCJudWJTaXplIiwic3Ryb2tlV2lkdGgiLCJzaWRlIiwidXBTaWRlRG93biIsImhhbGZOdWJTaXplIiwiaGFsZlN0cm9rZVdpZHRoIiwiaG9yaXpvbnRhbFRyYW5zZm9ybSIsInZlcnRpY2FsVHJhbnNmb3JtIiwicDEiLCJqb2luIiwicDIiLCJwMyIsIkJ1YmJsZSIsImFyaWFIaWRkZW4iLCJjaGlsZHJlbiIsImNsYXNzTmFtZSIsImZyb21Vc2VyIiwibnViIiwiYnViYmxlU3R5bGVTZXQiLCJidWJibGUiLCJkaXJlY3Rpb24iLCJidWJibGVCb3JkZXJXaWR0aCIsImJ1YmJsZUZyb21Vc2VyQm9yZGVyV2lkdGgiLCJidWJibGVGcm9tVXNlck51YlNpemUiLCJidWJibGVOdWJTaXplIiwiYnViYmxlTnViT2Zmc2V0IiwiYnViYmxlRnJvbVVzZXJOdWJPZmZzZXQiLCJyb290Q2xhc3NOYW1lIiwiYm9yZGVyV2lkdGgiLCJudWJPZmZzZXQiLCJkZWZhdWx0UHJvcHMiLCJ1bmRlZmluZWQiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJib29sIiwiYW55Iiwic3RyaW5nIiwib25lT2YiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQVFBLFlBQVIsR0FBMENDLDZCQUExQyxDQUFRRCxZQUFSO0FBQUEsSUFBc0JFLGVBQXRCLEdBQTBDRCw2QkFBMUMsQ0FBc0JDLGVBQXRCO0FBRUEsSUFBTUMsVUFBVSxHQUFHO0FBQ2pCLHVCQUFxQjtBQUNuQkMsSUFBQUEsT0FBTyxF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QUFBLFNBQVMsRUFBRSxFQUhTO0FBSXBCQyxFQUFBQSxRQUFRLEVBQUUsS0FKVTtBQUtwQkMsRUFBQUEsR0FBRyxFQUFFO0FBTGUsQ0FBdEI7QUFRQUwsTUFBTSxDQUFDb0IsU0FBUCxHQUFtQjtBQUNqQixpQkFBZUMsbUJBQVVDLElBRFI7QUFFakJwQixFQUFBQSxRQUFRLEVBQUVtQixtQkFBVUUsR0FGSDtBQUdqQnBCLEVBQUFBLFNBQVMsRUFBRWtCLG1CQUFVRyxNQUhKO0FBSWpCcEIsRUFBQUEsUUFBUSxFQUFFaUIsbUJBQVVDLElBSkg7QUFLakJqQixFQUFBQSxHQUFHLEVBQUVnQixtQkFBVUksS0FBVixDQUFnQixDQUFDLElBQUQsRUFBTyxLQUFQLEVBQWMsUUFBZCxDQUFoQjtBQUxZLENBQW5CO2VBUWV6QixNIiwic291cmNlUm9vdCI6ImNvbXBvbmVudDovLy8iLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQgbm8tbWFnaWMtbnVtYmVyczogW1wiZXJyb3JcIiwgeyBcImlnbm9yZVwiOiBbLTEsIDAsIDEsIDIsIDEwXSB9XSAqL1xuXG5pbXBvcnQgeyBob29rcyB9IGZyb20gJ2JvdGZyYW1ld29yay13ZWJjaGF0LWFwaSc7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QsIHsgRkMsIFJlYWN0Tm9kZSB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IGlzWmVyb09yUG9zaXRpdmUgZnJvbSAnLi4vVXRpbHMvaXNaZXJvT3JQb3NpdGl2ZSc7XG5pbXBvcnQgdXNlU3R5bGVTZXQgZnJvbSAnLi4vaG9va3MvdXNlU3R5bGVTZXQnO1xuaW1wb3J0IHVzZVN0eWxlVG9FbW90aW9uT2JqZWN0IGZyb20gJy4uL2hvb2tzL2ludGVybmFsL3VzZVN0eWxlVG9FbW90aW9uT2JqZWN0JztcblxuY29uc3QgeyB1c2VEaXJlY3Rpb24sIHVzZVN0eWxlT3B0aW9ucyB9ID0gaG9va3M7XG5cbmNvbnN0IFJPT1RfU1RZTEUgPSB7XG4gICcmLndlYmNoYXRfX2J1YmJsZSc6IHtcbiAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG5cbiAgICAnJiAud2ViY2hhdF9fYnViYmxlX19udWItcGFkJzoge1xuICAgICAgZmxleFNocmluazogMFxuICAgIH0sXG5cbiAgICAnJiAud2ViY2hhdF9fYnViYmxlX19jb250ZW50Jzoge1xuICAgICAgZmxleEdyb3c6IDEsXG5cbiAgICAgIC8vIFRoaXMgaXMgZm9yIGhpZGluZyBjb250ZW50IG91dHNpZGUgb2YgdGhlIGJ1YmJsZSwgZm9yIGV4YW1wbGUsIGNvbnRlbnQgb3V0c2lkZSBvZiBib3JkZXIgcmFkaXVzXG4gICAgICBvdmVyZmxvdzogJ2hpZGRlbidcbiAgICB9XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGFjdXRlTnViU1ZHKG51YlNpemUsIHN0cm9rZVdpZHRoLCBzaWRlLCB1cFNpZGVEb3duID0gZmFsc2UpIHtcbiAgaWYgKHR5cGVvZiBudWJTaXplICE9PSAnbnVtYmVyJykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGNvbnN0IGhhbGZOdWJTaXplID0gbnViU2l6ZSAvIDI7XG4gIGNvbnN0IGhhbGZTdHJva2VXaWR0aCA9IHN0cm9rZVdpZHRoIC8gMjtcblxuICAvLyBIb3Jpem9udGFsbHkgbWlycm9yIHRoZSBudWIgaWYgaXQgaXMgZnJvbSB1c2VyXG4gIGNvbnN0IGhvcml6b250YWxUcmFuc2Zvcm0gPVxuICAgIHNpZGUgPT09ICdib3QnID8gJycgOiBgdHJhbnNsYXRlKCR7aGFsZk51YlNpemV9IDApIHNjYWxlKC0xIDEpIHRyYW5zbGF0ZSgkey1oYWxmTnViU2l6ZX0gMClgO1xuXG4gIC8vIFZlcnRpY2FsbHkgbWlycm9yIHRoZSBudWIgaWYgaXQgaXMgdXAtc2lkZS1kb3duXG4gIGNvbnN0IHZlcnRpY2FsVHJhbnNmb3JtID0gdXBTaWRlRG93biA/IGB0cmFuc2xhdGUoMCAke2hhbGZOdWJTaXplfSkgc2NhbGUoMSAtMSkgdHJhbnNsYXRlKDAgJHstaGFsZk51YlNpemV9KWAgOiAnJztcblxuICBjb25zdCBwMSA9IFtudWJTaXplLCBoYWxmU3Ryb2tlV2lkdGhdLmpvaW4oJyAnKTtcbiAgY29uc3QgcDIgPSBbc3Ryb2tlV2lkdGgsIGhhbGZTdHJva2VXaWR0aF0uam9pbignICcpO1xuICBjb25zdCBwMyA9IFtudWJTaXplICsgc3Ryb2tlV2lkdGgsIG51YlNpemUgKyBoYWxmU3Ryb2tlV2lkdGhdLmpvaW4oJyAnKTtcblxuICByZXR1cm4gKFxuICAgIDxzdmdcbiAgICAgIGNsYXNzTmFtZT1cIndlYmNoYXRfX2J1YmJsZV9fbnViXCJcbiAgICAgIHZlcnNpb249XCIxLjFcIlxuICAgICAgdmlld0JveD17YDAgMCAke251YlNpemV9ICR7bnViU2l6ZX1gfVxuICAgICAgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiXG4gICAgPlxuICAgICAgPGcgdHJhbnNmb3JtPXtgJHtob3Jpem9udGFsVHJhbnNmb3JtfSAke3ZlcnRpY2FsVHJhbnNmb3JtfWB9PlxuICAgICAgICA8cGF0aCBjbGFzc05hbWU9XCJ3ZWJjaGF0X19idWJibGVfX251Yi1vdXRsaW5lXCIgZD17YE0ke3AxfSBMJHtwMn0gTCR7cDN9YH0gLz5cbiAgICAgIDwvZz5cbiAgICA8L3N2Zz5cbiAgKTtcbn1cblxudHlwZSBCdWJibGVQcm9wcyA9IHtcbiAgJ2FyaWEtaGlkZGVuJz86IGJvb2xlYW47XG4gIGNoaWxkcmVuPzogUmVhY3ROb2RlO1xuICBjbGFzc05hbWU/OiBzdHJpbmc7XG4gIGZyb21Vc2VyPzogYm9vbGVhbjtcbiAgbnViPzogYm9vbGVhbiB8ICdoaWRkZW4nO1xufTtcblxuY29uc3QgQnViYmxlOiBGQzxCdWJibGVQcm9wcz4gPSAoeyAnYXJpYS1oaWRkZW4nOiBhcmlhSGlkZGVuLCBjaGlsZHJlbiwgY2xhc3NOYW1lLCBmcm9tVXNlciwgbnViIH0pID0+IHtcbiAgY29uc3QgW3sgYnViYmxlOiBidWJibGVTdHlsZVNldCB9XSA9IHVzZVN0eWxlU2V0KCk7XG4gIGNvbnN0IFtkaXJlY3Rpb25dID0gdXNlRGlyZWN0aW9uKCk7XG4gIGNvbnN0IFtcbiAgICB7XG4gICAgICBidWJibGVCb3JkZXJXaWR0aCxcbiAgICAgIGJ1YmJsZUZyb21Vc2VyQm9yZGVyV2lkdGgsXG4gICAgICBidWJibGVGcm9tVXNlck51YlNpemUsXG4gICAgICBidWJibGVOdWJTaXplLFxuICAgICAgYnViYmxlTnViT2Zmc2V0LFxuICAgICAgYnViYmxlRnJvbVVzZXJOdWJPZmZzZXRcbiAgICB9XG4gIF0gPSB1c2VTdHlsZU9wdGlvbnMoKTtcbiAgY29uc3Qgcm9vdENsYXNzTmFtZSA9IHVzZVN0eWxlVG9FbW90aW9uT2JqZWN0KCkoUk9PVF9TVFlMRSkgKyAnJztcblxuICBjb25zdCB7IGJvcmRlcldpZHRoLCBudWJPZmZzZXQsIG51YlNpemUsIHNpZGUgfSA9IGZyb21Vc2VyXG4gICAgPyB7XG4gICAgICAgIGJvcmRlcldpZHRoOiBidWJibGVGcm9tVXNlckJvcmRlcldpZHRoLFxuICAgICAgICBudWJPZmZzZXQ6IGJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0LFxuICAgICAgICBudWJTaXplOiBidWJibGVGcm9tVXNlck51YlNpemUsXG4gICAgICAgIHNpZGU6ICd1c2VyJ1xuICAgICAgfVxuICAgIDoge1xuICAgICAgICBib3JkZXJXaWR0aDogYnViYmxlQm9yZGVyV2lkdGgsXG4gICAgICAgIG51Yk9mZnNldDogYnViYmxlTnViT2Zmc2V0LFxuICAgICAgICBudWJTaXplOiBidWJibGVOdWJTaXplLFxuICAgICAgICBzaWRlOiAnYm90J1xuICAgICAgfTtcblxuICByZXR1cm4gKFxuICAgIDxkaXZcbiAgICAgIGFyaWEtaGlkZGVuPXthcmlhSGlkZGVufVxuICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFxuICAgICAgICAnd2ViY2hhdF9fYnViYmxlJyxcbiAgICAgICAge1xuICAgICAgICAgICd3ZWJjaGF0X19idWJibGUtLWZyb20tdXNlcic6IGZyb21Vc2VyLFxuICAgICAgICAgICd3ZWJjaGF0X19idWJibGUtLWhpZGUtbnViJzogbnViICE9PSB0cnVlICYmIG51YiAhPT0gZmFsc2UsXG4gICAgICAgICAgJ3dlYmNoYXRfX2J1YmJsZS0tbnViLW9uLXRvcCc6IGlzWmVyb09yUG9zaXRpdmUobnViT2Zmc2V0KSxcbiAgICAgICAgICAnd2ViY2hhdF9fYnViYmxlLS1ydGwnOiBkaXJlY3Rpb24gPT09ICdydGwnLFxuICAgICAgICAgICd3ZWJjaGF0X19idWJibGUtLXNob3ctbnViJzogbnViID09PSB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHJvb3RDbGFzc05hbWUsXG4gICAgICAgIGJ1YmJsZVN0eWxlU2V0ICsgJycsXG4gICAgICAgIChjbGFzc05hbWUgfHwgJycpICsgJydcbiAgICAgICl9XG4gICAgPlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3ZWJjaGF0X19idWJibGVfX251Yi1wYWRcIiAvPlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3ZWJjaGF0X19idWJibGVfX2NvbnRlbnRcIj57Y2hpbGRyZW59PC9kaXY+XG4gICAgICB7bnViID09PSB0cnVlICYmIGFjdXRlTnViU1ZHKG51YlNpemUsIGJvcmRlcldpZHRoLCBzaWRlLCAhaXNaZXJvT3JQb3NpdGl2ZShudWJPZmZzZXQpKX1cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cbkJ1YmJsZS5kZWZhdWx0UHJvcHMgPSB7XG4gICdhcmlhLWhpZGRlbic6IHVuZGVmaW5lZCxcbiAgY2hpbGRyZW46IHVuZGVmaW5lZCxcbiAgY2xhc3NOYW1lOiAnJyxcbiAgZnJvbVVzZXI6IGZhbHNlLFxuICBudWI6IGZhbHNlXG59O1xuXG5CdWJibGUucHJvcFR5cGVzID0ge1xuICAnYXJpYS1oaWRkZW4nOiBQcm9wVHlwZXMuYm9vbCxcbiAgY2hpbGRyZW46IFByb3BUeXBlcy5hbnksXG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgZnJvbVVzZXI6IFByb3BUeXBlcy5ib29sLFxuICBudWI6IFByb3BUeXBlcy5vbmVPZihbdHJ1ZSwgZmFsc2UsICdoaWRkZW4nXSlcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEJ1YmJsZTtcbiJdfQ==