"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _botframeworkWebchatApi = require("botframework-webchat-api");

var _reactFilm = require("react-film");

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _CarouselFilmStrip = _interopRequireDefault(require("./CarouselFilmStrip"));

var _useNonce3 = _interopRequireDefault(require("../hooks/internal/useNonce"));

var _useStyleSet3 = _interopRequireDefault(require("../hooks/useStyleSet"));

var _useStyleToEmotionObject = _interopRequireDefault(require("../hooks/internal/useStyleToEmotionObject"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var useDirection = _botframeworkWebchatApi.hooks.useDirection,
    useLocalizer = _botframeworkWebchatApi.hooks.useLocalizer;
var ROOT_STYLE = {
  '&.webchat__carousel-layout': {
    overflow: 'hidden',
    position: 'relative'
  }
};

var CarouselLayoutCore = function CarouselLayoutCore(_ref) {
  var activity = _ref.activity,
      hideTimestamp = _ref.hideTimestamp,
      renderActivityStatus = _ref.renderActivityStatus,
      renderAttachment = _ref.renderAttachment,
      renderAvatar = _ref.renderAvatar,
      showCallout = _ref.showCallout;

  var _useStyleSet = (0, _useStyleSet3.default)(),
      _useStyleSet2 = _slicedToArray(_useStyleSet, 1),
      carouselFlipperStyleSet = _useStyleSet2[0].carouselFlipper;

  var _useReactFilmStyleSet = (0, _reactFilm.useStyleSetClassNames)(),
      _useReactFilmStyleSet2 = _slicedToArray(_useReactFilmStyleSet, 1),
      filmRootClassName = _useReactFilmStyleSet2[0].root;

  var _useDirection = useDirection(),
      _useDirection2 = _slicedToArray(_useDirection, 1),
      direction = _useDirection2[0];

  var _useScrollBarWidth = (0, _reactFilm.useScrollBarWidth)(),
      _useScrollBarWidth2 = _slicedToArray(_useScrollBarWidth, 1),
      scrollBarWidth = _useScrollBarWidth2[0];

  var _useScrolling = (0, _reactFilm.useScrolling)(),
      _useScrolling2 = _slicedToArray(_useScrolling, 1),
      scrolling = _useScrolling2[0];

  var leftSideFlipper = direction === 'rtl' ? '>' : '<';
  var localize = useLocalizer();
  var rightSideFlipper = direction === 'rtl' ? '<' : '>';
  var rootClassName = (0, _useStyleToEmotionObject.default)()(ROOT_STYLE) + '';
  return /*#__PURE__*/_react.default.createElement("div", {
    className: (0, _classnames.default)('webchat__carousel-layout', rootClassName, carouselFlipperStyleSet + '', filmRootClassName)
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: (0, _classnames.default)('react-film__main', {
      'react-film__main--scrolling': scrolling
    })
  }, /*#__PURE__*/_react.default.createElement(_CarouselFilmStrip.default, {
    activity: activity,
    hideTimestamp: hideTimestamp,
    renderActivityStatus: renderActivityStatus,
    renderAttachment: renderAttachment,
    renderAvatar: renderAvatar,
    showCallout: showCallout
  }), scrollBarWidth !== '100%' && /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_reactFilm.Flipper, {
    "aria-label": localize('CAROUSEL_FLIPPER_LEFT_ALT'),
    blurFocusOnClick: true,
    mode: "left"
  }, leftSideFlipper), /*#__PURE__*/_react.default.createElement(_reactFilm.Flipper, {
    "aria-label": localize('CAROUSEL_FLIPPER_RIGHT_ALT'),
    blurFocusOnClick: true,
    mode: "right"
  }, rightSideFlipper))));
};

CarouselLayoutCore.defaultProps = {
  hideTimestamp: false,
  renderActivityStatus: false,
  renderAvatar: false,
  showCallout: true
};
CarouselLayoutCore.propTypes = {
  activity: _propTypes.default.shape({
    attachments: _propTypes.default.array
  }).isRequired,
  hideTimestamp: _propTypes.default.bool,
  renderActivityStatus: _propTypes.default.oneOfType([_propTypes.default.oneOf([false]), _propTypes.default.func]),
  renderAttachment: _propTypes.default.func.isRequired,
  renderAvatar: _propTypes.default.oneOfType([_propTypes.default.oneOf([false]), _propTypes.default.func]),
  showCallout: _propTypes.default.bool
};

var CarouselLayout = function CarouselLayout(props) {
  var _props$activity = props.activity;
  _props$activity = _props$activity === void 0 ? {} : _props$activity;
  var _props$activity$attac = _props$activity.attachments,
      attachments = _props$activity$attac === void 0 ? [] : _props$activity$attac;

  var _useDirection3 = useDirection(),
      _useDirection4 = _slicedToArray(_useDirection3, 1),
      direction = _useDirection4[0];

  var _useNonce = (0, _useNonce3.default)(),
      _useNonce2 = _slicedToArray(_useNonce, 1),
      nonce = _useNonce2[0];

  var filmStyleSet = (0, _react.useMemo)(function () {
    return (0, _reactFilm.createBasicStyleSet)({
      cursor: null
    });
  }, []);
  return /*#__PURE__*/_react.default.createElement(_reactFilm.Composer, {
    dir: direction,
    nonce: nonce,
    numItems: attachments.length,
    styleSet: filmStyleSet
  }, /*#__PURE__*/_react.default.createElement(CarouselLayoutCore, props));
};

CarouselLayout.defaultProps = _objectSpread({}, CarouselLayoutCore.defaultProps);
CarouselLayout.propTypes = _objectSpread({}, CarouselLayoutCore.propTypes);
var _default = CarouselLayout;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BY3Rpdml0eS9DYXJvdXNlbExheW91dC5qcyJdLCJuYW1lcyI6WyJ1c2VEaXJlY3Rpb24iLCJob29rcyIsInVzZUxvY2FsaXplciIsIlJPT1RfU1RZTEUiLCJvdmVyZmxvdyIsInBvc2l0aW9uIiwiQ2Fyb3VzZWxMYXlvdXRDb3JlIiwiYWN0aXZpdHkiLCJoaWRlVGltZXN0YW1wIiwicmVuZGVyQWN0aXZpdHlTdGF0dXMiLCJyZW5kZXJBdHRhY2htZW50IiwicmVuZGVyQXZhdGFyIiwic2hvd0NhbGxvdXQiLCJjYXJvdXNlbEZsaXBwZXJTdHlsZVNldCIsImNhcm91c2VsRmxpcHBlciIsImZpbG1Sb290Q2xhc3NOYW1lIiwicm9vdCIsImRpcmVjdGlvbiIsInNjcm9sbEJhcldpZHRoIiwic2Nyb2xsaW5nIiwibGVmdFNpZGVGbGlwcGVyIiwibG9jYWxpemUiLCJyaWdodFNpZGVGbGlwcGVyIiwicm9vdENsYXNzTmFtZSIsImRlZmF1bHRQcm9wcyIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsInNoYXBlIiwiYXR0YWNobWVudHMiLCJhcnJheSIsImlzUmVxdWlyZWQiLCJib29sIiwib25lT2ZUeXBlIiwib25lT2YiLCJmdW5jIiwiQ2Fyb3VzZWxMYXlvdXQiLCJwcm9wcyIsIm5vbmNlIiwiZmlsbVN0eWxlU2V0IiwiY3Vyc29yIiwibGVuZ3RoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFTQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxJQUFRQSxZQUFSLEdBQXVDQyw2QkFBdkMsQ0FBUUQsWUFBUjtBQUFBLElBQXNCRSxZQUF0QixHQUF1Q0QsNkJBQXZDLENBQXNCQyxZQUF0QjtBQUVBLElBQU1DLFVBQVUsR0FBRztBQUNqQixnQ0FBOEI7QUFDNUJDLElBQUFBLFFBQVEsRUFBRSxRQURrQjtBQUU1QkMsSUFBQUEsUUFBUSxFQUFFO0FBRmtC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b25lbnQ6Ly8vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaG9va3MgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1hcGknO1xuaW1wb3J0IHtcbiAgQ29tcG9zZXIgYXMgRmlsbUNvbXBvc2VyLFxuICBjcmVhdGVCYXNpY1N0eWxlU2V0IGFzIGNyZWF0ZUJhc2ljU3R5bGVTZXRGb3JSZWFjdEZpbG0sXG4gIEZsaXBwZXIsXG4gIHVzZVNjcm9sbEJhcldpZHRoLFxuICB1c2VTY3JvbGxpbmcsXG4gIHVzZVN0eWxlU2V0Q2xhc3NOYW1lcyBhcyB1c2VSZWFjdEZpbG1TdHlsZVNldENsYXNzTmFtZXNcbn0gZnJvbSAncmVhY3QtZmlsbSc7XG5cbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBSZWFjdCwgeyB1c2VNZW1vIH0gZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgQ2Fyb3VzZWxGaWxtU3RyaXAgZnJvbSAnLi9DYXJvdXNlbEZpbG1TdHJpcCc7XG5pbXBvcnQgdXNlTm9uY2UgZnJvbSAnLi4vaG9va3MvaW50ZXJuYWwvdXNlTm9uY2UnO1xuaW1wb3J0IHVzZVN0eWxlU2V0IGZyb20gJy4uL2hvb2tzL3VzZVN0eWxlU2V0JztcbmltcG9ydCB1c2VTdHlsZVRvRW1vdGlvbk9iamVjdCBmcm9tICcuLi9ob29rcy9pbnRlcm5hbC91c2VTdHlsZVRvRW1vdGlvbk9iamVjdCc7XG5cbmNvbnN0IHsgdXNlRGlyZWN0aW9uLCB1c2VMb2NhbGl6ZXIgfSA9IGhvb2tzO1xuXG5jb25zdCBST09UX1NUWUxFID0ge1xuICAnJi53ZWJjaGF0X19jYXJvdXNlbC1sYXlvdXQnOiB7XG4gICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnXG4gIH1cbn07XG5cbmNvbnN0IENhcm91c2VsTGF5b3V0Q29yZSA9ICh7XG4gIGFjdGl2aXR5LFxuICBoaWRlVGltZXN0YW1wLFxuICByZW5kZXJBY3Rpdml0eVN0YXR1cyxcbiAgcmVuZGVyQXR0YWNobWVudCxcbiAgcmVuZGVyQXZhdGFyLFxuICBzaG93Q2FsbG91dFxufSkgPT4ge1xuICBjb25zdCBbeyBjYXJvdXNlbEZsaXBwZXI6IGNhcm91c2VsRmxpcHBlclN0eWxlU2V0IH1dID0gdXNlU3R5bGVTZXQoKTtcbiAgY29uc3QgW3sgcm9vdDogZmlsbVJvb3RDbGFzc05hbWUgfV0gPSB1c2VSZWFjdEZpbG1TdHlsZVNldENsYXNzTmFtZXMoKTtcbiAgY29uc3QgW2RpcmVjdGlvbl0gPSB1c2VEaXJlY3Rpb24oKTtcbiAgY29uc3QgW3Njcm9sbEJhcldpZHRoXSA9IHVzZVNjcm9sbEJhcldpZHRoKCk7XG4gIGNvbnN0IFtzY3JvbGxpbmddID0gdXNlU2Nyb2xsaW5nKCk7XG4gIGNvbnN0IGxlZnRTaWRlRmxpcHBlciA9IGRpcmVjdGlvbiA9PT0gJ3J0bCcgPyAnPicgOiAnPCc7XG4gIGNvbnN0IGxvY2FsaXplID0gdXNlTG9jYWxpemVyKCk7XG4gIGNvbnN0IHJpZ2h0U2lkZUZsaXBwZXIgPSBkaXJlY3Rpb24gPT09ICdydGwnID8gJzwnIDogJz4nO1xuICBjb25zdCByb290Q2xhc3NOYW1lID0gdXNlU3R5bGVUb0Vtb3Rpb25PYmplY3QoKShST09UX1NUWUxFKSArICcnO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdlxuICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKCd3ZWJjaGF0X19jYXJvdXNlbC1sYXlvdXQnLCByb290Q2xhc3NOYW1lLCBjYXJvdXNlbEZsaXBwZXJTdHlsZVNldCArICcnLCBmaWxtUm9vdENsYXNzTmFtZSl9XG4gICAgPlxuICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzTmFtZXMoJ3JlYWN0LWZpbG1fX21haW4nLCB7ICdyZWFjdC1maWxtX19tYWluLS1zY3JvbGxpbmcnOiBzY3JvbGxpbmcgfSl9PlxuICAgICAgICA8Q2Fyb3VzZWxGaWxtU3RyaXBcbiAgICAgICAgICBhY3Rpdml0eT17YWN0aXZpdHl9XG4gICAgICAgICAgaGlkZVRpbWVzdGFtcD17aGlkZVRpbWVzdGFtcH1cbiAgICAgICAgICByZW5kZXJBY3Rpdml0eVN0YXR1cz17cmVuZGVyQWN0aXZpdHlTdGF0dXN9XG4gICAgICAgICAgcmVuZGVyQXR0YWNobWVudD17cmVuZGVyQXR0YWNobWVudH1cbiAgICAgICAgICByZW5kZXJBdmF0YXI9e3JlbmRlckF2YXRhcn1cbiAgICAgICAgICBzaG93Q2FsbG91dD17c2hvd0NhbGxvdXR9XG4gICAgICAgIC8+XG4gICAgICAgIHtzY3JvbGxCYXJXaWR0aCAhPT0gJzEwMCUnICYmIChcbiAgICAgICAgICA8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgICA8RmxpcHBlciBhcmlhLWxhYmVsPXtsb2NhbGl6ZSgnQ0FST1VTRUxfRkxJUFBFUl9MRUZUX0FMVCcpfSBibHVyRm9jdXNPbkNsaWNrPXt0cnVlfSBtb2RlPVwibGVmdFwiPlxuICAgICAgICAgICAgICB7bGVmdFNpZGVGbGlwcGVyfVxuICAgICAgICAgICAgPC9GbGlwcGVyPlxuICAgICAgICAgICAgPEZsaXBwZXIgYXJpYS1sYWJlbD17bG9jYWxpemUoJ0NBUk9VU0VMX0ZMSVBQRVJfUklHSFRfQUxUJyl9IGJsdXJGb2N1c09uQ2xpY2s9e3RydWV9IG1vZGU9XCJyaWdodFwiPlxuICAgICAgICAgICAgICB7cmlnaHRTaWRlRmxpcHBlcn1cbiAgICAgICAgICAgIDwvRmxpcHBlcj5cbiAgICAgICAgICA8L1JlYWN0LkZyYWdtZW50PlxuICAgICAgICApfVxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG5DYXJvdXNlbExheW91dENvcmUuZGVmYXVsdFByb3BzID0ge1xuICBoaWRlVGltZXN0YW1wOiBmYWxzZSxcbiAgcmVuZGVyQWN0aXZpdHlTdGF0dXM6IGZhbHNlLFxuICByZW5kZXJBdmF0YXI6IGZhbHNlLFxuICBzaG93Q2FsbG91dDogdHJ1ZVxufTtcblxuQ2Fyb3VzZWxMYXlvdXRDb3JlLnByb3BUeXBlcyA9IHtcbiAgYWN0aXZpdHk6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgYXR0YWNobWVudHM6IFByb3BUeXBlcy5hcnJheVxuICB9KS5pc1JlcXVpcmVkLFxuICBoaWRlVGltZXN0YW1wOiBQcm9wVHlwZXMuYm9vbCxcbiAgcmVuZGVyQWN0aXZpdHlTdGF0dXM6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5vbmVPZihbZmFsc2VdKSwgUHJvcFR5cGVzLmZ1bmNdKSxcbiAgcmVuZGVyQXR0YWNobWVudDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgcmVuZGVyQXZhdGFyOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMub25lT2YoW2ZhbHNlXSksIFByb3BUeXBlcy5mdW5jXSksXG4gIHNob3dDYWxsb3V0OiBQcm9wVHlwZXMuYm9vbFxufTtcblxuY29uc3QgQ2Fyb3VzZWxMYXlvdXQgPSBwcm9wcyA9PiB7XG4gIGNvbnN0IHsgYWN0aXZpdHk6IHsgYXR0YWNobWVudHMgPSBbXSB9ID0ge30gfSA9IHByb3BzO1xuICBjb25zdCBbZGlyZWN0aW9uXSA9IHVzZURpcmVjdGlvbigpO1xuICBjb25zdCBbbm9uY2VdID0gdXNlTm9uY2UoKTtcbiAgY29uc3QgZmlsbVN0eWxlU2V0ID0gdXNlTWVtbygoKSA9PiBjcmVhdGVCYXNpY1N0eWxlU2V0Rm9yUmVhY3RGaWxtKHsgY3Vyc29yOiBudWxsIH0pLCBbXSk7XG5cbiAgcmV0dXJuIChcbiAgICA8RmlsbUNvbXBvc2VyIGRpcj17ZGlyZWN0aW9ufSBub25jZT17bm9uY2V9IG51bUl0ZW1zPXthdHRhY2htZW50cy5sZW5ndGh9IHN0eWxlU2V0PXtmaWxtU3R5bGVTZXR9PlxuICAgICAgPENhcm91c2VsTGF5b3V0Q29yZSB7Li4ucHJvcHN9IC8+XG4gICAgPC9GaWxtQ29tcG9zZXI+XG4gICk7XG59O1xuXG5DYXJvdXNlbExheW91dC5kZWZhdWx0UHJvcHMgPSB7XG4gIC4uLkNhcm91c2VsTGF5b3V0Q29yZS5kZWZhdWx0UHJvcHNcbn07XG5cbkNhcm91c2VsTGF5b3V0LnByb3BUeXBlcyA9IHtcbiAgLi4uQ2Fyb3VzZWxMYXlvdXRDb3JlLnByb3BUeXBlc1xufTtcblxuZXhwb3J0IGRlZmF1bHQgQ2Fyb3VzZWxMYXlvdXQ7XG4iXX0=