"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.connectStackedLayout = void 0;

var _botframeworkWebchatApi = require("botframework-webchat-api");

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _Bubble = _interopRequireDefault(require("./Bubble"));

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _isZeroOrPositive = _interopRequireDefault(require("../Utils/isZeroOrPositive"));

var _ScreenReaderText = _interopRequireDefault(require("../ScreenReaderText"));

var _textFormatToContentType = _interopRequireDefault(require("../Utils/textFormatToContentType"));

var _useStyleSet3 = _interopRequireDefault(require("../hooks/useStyleSet"));

var _useStyleToEmotionObject = _interopRequireDefault(require("../hooks/internal/useStyleToEmotionObject"));

var _useUniqueId = _interopRequireDefault(require("../hooks/internal/useUniqueId"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var useAvatarForBot = _botframeworkWebchatApi.hooks.useAvatarForBot,
    useAvatarForUser = _botframeworkWebchatApi.hooks.useAvatarForUser,
    useLocalizer = _botframeworkWebchatApi.hooks.useLocalizer,
    useStyleOptions = _botframeworkWebchatApi.hooks.useStyleOptions;
var ROOT_STYLE = {
  '&.webchat__stacked-layout': {
    position: 'relative',
    // This is to keep screen reader text in the destinated area.
    '& .webchat__stacked-layout__attachment-row, & .webchat__stacked-layout__main, & .webchat__stacked-layout__message-row, & .webchat__stacked-layout__status': {
      display: 'flex'
    },
    '& .webchat__stacked-layout__alignment-pad': {
      flexShrink: 0
    },
    '& .webchat__stacked-layout__attachment': {
      width: '100%'
    },
    '& .webchat__stacked-layout__avatar-gutter': {
      display: 'flex',
      flexDirection: 'column',
      flexShrink: 0
    },
    '&.webchat__stacked-layout--from-user': {
      '& .webchat__stacked-layout__attachment-row, & .webchat__stacked-layout__main, & .webchat__stacked-layout__message-row, & .webchat__stacked-layout__status': {
        flexDirection: 'row-reverse'
      }
    },
    '& .webchat__stacked-layout__content': {
      flex: 1,
      // This is for bottom aligning an avatar with a message bubble shorter than the avatar.
      // Related to the test at activityGrouping.avatarMiddleware.atBottom.js.
      display: 'flex',
      flexDirection: 'column',
      // This "overflow: hidden" is to make sure text overflow will get clipped correctly.
      // Related to the test at basic.js "long URLs with keep-all".
      overflow: 'hidden'
    },
    '& .webchat__stacked-layout__nub-pad': {
      flexShrink: 0
    }
  }
};

var connectStackedLayout = function connectStackedLayout() {
  for (var _len = arguments.length, selectors = new Array(_len), _key = 0; _key < _len; _key++) {
    selectors[_key] = arguments[_key];
  }

  return _connectToWebChat.default.apply(void 0, [function (_ref, _ref2) {
    var language = _ref.language,
        _ref$styleSet$options = _ref.styleSet.options,
        botAvatarInitials = _ref$styleSet$options.botAvatarInitials,
        userAvatarInitials = _ref$styleSet$options.userAvatarInitials;
    var _ref2$activity = _ref2.activity;
    _ref2$activity = _ref2$activity === void 0 ? {} : _ref2$activity;
    var _ref2$activity$from = _ref2$activity.from;
    _ref2$activity$from = _ref2$activity$from === void 0 ? {} : _ref2$activity$from;
    var _ref2$activity$from$r = _ref2$activity$from.role,
        role = _ref2$activity$from$r === void 0 ? undefined : _ref2$activity$from$r;
    return {
      avatarInitials: role === 'user' ? userAvatarInitials : botAvatarInitials,
      language: language,
      // TODO: [P4] We want to deprecate botAvatarInitials/userAvatarInitials because they are not as helpful as avatarInitials
      botAvatarInitials: botAvatarInitials,
      userAvatarInitials: userAvatarInitials
    };
  }].concat(selectors));
};

exports.connectStackedLayout = connectStackedLayout;

var StackedLayout = function StackedLayout(_ref3) {
  var activity = _ref3.activity,
      hideTimestamp = _ref3.hideTimestamp,
      renderActivityStatus = _ref3.renderActivityStatus,
      renderAttachment = _ref3.renderAttachment,
      renderAvatar = _ref3.renderAvatar,
      showCallout = _ref3.showCallout;

  var _useStyleOptions = useStyleOptions(),
      _useStyleOptions2 = _slicedToArray(_useStyleOptions, 1),
      styleOptions = _useStyleOptions2[0];

  var _useAvatarForBot = useAvatarForBot(),
      _useAvatarForBot2 = _slicedToArray(_useAvatarForBot, 1),
      botInitials = _useAvatarForBot2[0].initials;

  var _useAvatarForUser = useAvatarForUser(),
      _useAvatarForUser2 = _slicedToArray(_useAvatarForUser, 1),
      userInitials = _useAvatarForUser2[0].initials;

  var _useStyleSet = (0, _useStyleSet3.default)(),
      _useStyleSet2 = _slicedToArray(_useStyleSet, 1),
      stackedLayoutStyleSet = _useStyleSet2[0].stackedLayout;

  var ariaLabelId = (0, _useUniqueId.default)('webchat__stacked-layout__id');
  var localize = useLocalizer();
  var rootClassName = (0, _useStyleToEmotionObject.default)()(ROOT_STYLE) + '';
  var bubbleNubOffset = styleOptions.bubbleNubOffset,
      bubbleNubSize = styleOptions.bubbleNubSize,
      bubbleFromUserNubOffset = styleOptions.bubbleFromUserNubOffset,
      bubbleFromUserNubSize = styleOptions.bubbleFromUserNubSize;
  var _activity$attachments = activity.attachments,
      attachments = _activity$attachments === void 0 ? [] : _activity$attachments,
      _activity$channelData = activity.channelData;
  _activity$channelData = _activity$channelData === void 0 ? {} : _activity$channelData;
  var _activity$channelData2 = _activity$channelData.messageBack;
  _activity$channelData2 = _activity$channelData2 === void 0 ? {} : _activity$channelData2;
  var messageBackDisplayText = _activity$channelData2.displayText,
      _activity$from = activity.from;
  _activity$from = _activity$from === void 0 ? {} : _activity$from;
  var role = _activity$from.role,
      text = activity.text,
      textFormat = activity.textFormat;
  var activityDisplayText = messageBackDisplayText || text;
  var fromUser = role === 'user';
  var attachedAlt = localize(fromUser ? 'ACTIVITY_YOU_ATTACHED_ALT' : 'ACTIVITY_BOT_ATTACHED_ALT');
  var greetingAlt = (fromUser ? localize('ACTIVITY_YOU_SAID_ALT') : localize('ACTIVITY_BOT_SAID_ALT', botInitials || '')).replace(/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]{2,}/g, ' ');
  var initials = fromUser ? userInitials : botInitials;
  var nubOffset = fromUser ? bubbleFromUserNubOffset : bubbleNubOffset;
  var nubSize = fromUser ? bubbleFromUserNubSize : bubbleNubSize;
  var otherInitials = fromUser ? botInitials : userInitials;
  var otherNubSize = fromUser ? bubbleNubSize : bubbleFromUserNubSize;
  var hasAvatar = initials || typeof initials === 'string';
  var hasOtherAvatar = otherInitials || typeof otherInitials === 'string';
  var hasNub = typeof nubSize === 'number';
  var hasOtherNub = typeof otherNubSize === 'number';
  var topAlignedCallout = (0, _isZeroOrPositive.default)(nubOffset);
  var extraTrailing = !hasOtherAvatar && hasOtherNub; // This is for bot message with user nub and no user avatar. And vice versa.

  var showAvatar = showCallout && hasAvatar && !!renderAvatar;
  var showNub = showCallout && hasNub && (topAlignedCallout || !attachments.length);
  return /*#__PURE__*/_react.default.createElement("div", {
    "aria-labelledby": activityDisplayText ? ariaLabelId : undefined,
    "aria-roledescription": "activity",
    className: (0, _classnames.default)('webchat__stacked-layout', rootClassName, stackedLayoutStyleSet + '', {
      'webchat__stacked-layout--extra-trailing': extraTrailing,
      'webchat__stacked-layout--from-user': fromUser,
      'webchat__stacked-layout--hide-avatar': hasAvatar && !showAvatar,
      'webchat__stacked-layout--hide-nub': hasNub && !showNub,
      'webchat__stacked-layout--no-message': !activityDisplayText,
      'webchat__stacked-layout--show-avatar': showAvatar,
      'webchat__stacked-layout--show-nub': showNub,
      'webchat__stacked-layout--top-callout': topAlignedCallout
    }),
    role: "group"
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__stacked-layout__main"
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__stacked-layout__avatar-gutter"
  }, showAvatar && renderAvatar && renderAvatar({
    activity: activity
  })), /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__stacked-layout__content"
  }, !!activityDisplayText && /*#__PURE__*/_react.default.createElement("div", {
    "aria-roledescription": "message",
    className: "webchat__stacked-layout__message-row" // Disable "Prop `id` is forbidden on DOM Nodes" rule because we are using the ID prop for accessibility.

    /* eslint-disable-next-line react/forbid-dom-props */
    ,
    id: ariaLabelId,
    role: "group"
  }, /*#__PURE__*/_react.default.createElement(_ScreenReaderText.default, {
    text: greetingAlt
  }), /*#__PURE__*/_react.default.createElement(_Bubble.default, {
    className: "webchat__stacked-layout__message",
    fromUser: fromUser,
    nub: showNub || (hasAvatar || hasNub ? 'hidden' : false)
  }, renderAttachment({
    activity: activity,
    attachment: {
      content: activityDisplayText,
      contentType: (0, _textFormatToContentType.default)(textFormat)
    }
  }))), attachments.map(function (attachment, index) {
    return /*#__PURE__*/_react.default.createElement("div", {
      "aria-roledescription": "attachment",
      className: (0, _classnames.default)('webchat__stacked-layout__attachment-row', {
        'webchat__stacked-layout__attachment-row--first': !index
      })
      /* attachments do not have an ID, it is always indexed by number */

      /* eslint-disable-next-line react/no-array-index-key */
      ,
      key: index,
      role: "group"
    }, /*#__PURE__*/_react.default.createElement(_ScreenReaderText.default, {
      text: attachedAlt
    }), /*#__PURE__*/_react.default.createElement(_Bubble.default, {
      className: "webchat__stacked-layout__attachment",
      fromUser: fromUser
      /* eslint-disable-next-line react/no-array-index-key */
      ,
      key: index,
      nub: hasAvatar || hasNub ? 'hidden' : false
    }, renderAttachment({
      activity: activity,
      attachment: attachment
    })));
  })), /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__stacked-layout__alignment-pad"
  })), typeof renderActivityStatus === 'function' && /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__stacked-layout__status"
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__stacked-layout__avatar-gutter"
  }), /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__stacked-layout__nub-pad"
  }), renderActivityStatus({
    hideTimestamp: hideTimestamp
  }), /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__stacked-layout__alignment-pad"
  })));
};

StackedLayout.defaultProps = {
  hideTimestamp: false,
  renderActivityStatus: false,
  renderAvatar: undefined,
  showCallout: true
};
StackedLayout.propTypes = {
  activity: _propTypes.default.shape({
    attachments: _propTypes.default.array,
    channelData: _propTypes.default.shape({
      messageBack: _propTypes.default.shape({
        displayText: _propTypes.default.string
      })
    }),
    from: _propTypes.default.shape({
      role: _propTypes.default.string.isRequired
    }).isRequired,
    text: _propTypes.default.string,
    textFormat: _propTypes.default.string,
    timestamp: _propTypes.default.string,
    type: _propTypes.default.string.isRequired
  }).isRequired,
  hideTimestamp: _propTypes.default.bool,
  // PropTypes cannot validate precisely with its TypeScript counterpart.
  // @ts-ignore
  renderActivityStatus: _propTypes.default.oneOfType([_propTypes.default.oneOf([false]), _propTypes.default.func]),
  renderAttachment: _propTypes.default.func.isRequired,
  // PropTypes cannot validate precisely with its TypeScript counterpart.
  // @ts-ignore
  renderAvatar: _propTypes.default.oneOfType([_propTypes.default.oneOf([false]), _propTypes.default.func]),
  showCallout: _propTypes.default.bool
};
var _default = StackedLayout;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BY3Rpdml0eS9TdGFja2VkTGF5b3V0LnRzeCJdLCJuYW1lcyI6WyJ1c2VBdmF0YXJGb3JCb3QiLCJob29rcyIsInVzZUF2YXRhckZvclVzZXIiLCJ1c2VMb2NhbGl6ZXIiLCJ1c2VTdHlsZU9wdGlvbnMiLCJST09UX1NUWUxFIiwicG9zaXRpb24iLCJkaXNwbGF5IiwiZmxleFNocmluayIsIndpZHRoIiwiZmxleERpcmVjdGlvbiIsImZsZXgiLCJvdmVyZmxvdyIsImNvbm5lY3RTdGFja2VkTGF5b3V0Iiwic2VsZWN0b3JzIiwiY29ubmVjdFRvV2ViQ2hhdCIsImxhbmd1YWdlIiwic3R5bGVTZXQiLCJvcHRpb25zIiwiYm90QXZhdGFySW5pdGlhbHMiLCJ1c2VyQXZhdGFySW5pdGlhbHMiLCJhY3Rpdml0eSIsImZyb20iLCJyb2xlIiwidW5kZWZpbmVkIiwiYXZhdGFySW5pdGlhbHMiLCJTdGFja2VkTGF5b3V0IiwiaGlkZVRpbWVzdGFtcCIsInJlbmRlckFjdGl2aXR5U3RhdHVzIiwicmVuZGVyQXR0YWNobWVudCIsInJlbmRlckF2YXRhciIsInNob3dDYWxsb3V0Iiwic3R5bGVPcHRpb25zIiwiYm90SW5pdGlhbHMiLCJpbml0aWFscyIsInVzZXJJbml0aWFscyIsInN0YWNrZWRMYXlvdXRTdHlsZVNldCIsInN0YWNrZWRMYXlvdXQiLCJhcmlhTGFiZWxJZCIsImxvY2FsaXplIiwicm9vdENsYXNzTmFtZSIsImJ1YmJsZU51Yk9mZnNldCIsImJ1YmJsZU51YlNpemUiLCJidWJibGVGcm9tVXNlck51Yk9mZnNldCIsImJ1YmJsZUZyb21Vc2VyTnViU2l6ZSIsImF0dGFjaG1lbnRzIiwiY2hhbm5lbERhdGEiLCJtZXNzYWdlQmFjayIsIm1lc3NhZ2VCYWNrRGlzcGxheVRleHQiLCJkaXNwbGF5VGV4dCIsInRleHQiLCJ0ZXh0Rm9ybWF0IiwiYWN0aXZpdHlEaXNwbGF5VGV4dCIsImZyb21Vc2VyIiwiYXR0YWNoZWRBbHQiLCJncmVldGluZ0FsdCIsInJlcGxhY2UiLCJudWJPZmZzZXQiLCJudWJTaXplIiwib3RoZXJJbml0aWFscyIsIm90aGVyTnViU2l6ZSIsImhhc0F2YXRhciIsImhhc090aGVyQXZhdGFyIiwiaGFzTnViIiwiaGFzT3RoZXJOdWIiLCJ0b3BBbGlnbmVkQ2FsbG91dCIsImV4dHJhVHJhaWxpbmciLCJzaG93QXZhdGFyIiwic2hvd051YiIsImxlbmd0aCIsImF0dGFjaG1lbnQiLCJjb250ZW50IiwiY29udGVudFR5cGUiLCJtYXAiLCJpbmRleCIsImRlZmF1bHRQcm9wcyIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsInNoYXBlIiwiYXJyYXkiLCJzdHJpbmciLCJpc1JlcXVpcmVkIiwidGltZXN0YW1wIiwidHlwZSIsImJvb2wiLCJvbmVPZlR5cGUiLCJvbmVPZiIsImZ1bmMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFHQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQVFBLGVBQVIsR0FBNkVDLDZCQUE3RSxDQUFRRCxlQUFSO0FBQUEsSUFBeUJFLGdCQUF6QixHQUE2RUQsNkJBQTdFLENBQXlCQyxnQkFBekI7QUFBQSxJQUEyQ0MsWUFBM0MsR0FBNkVGLDZCQUE3RSxDQUEyQ0UsWUFBM0M7QUFBQSxJQUF5REMsZUFBekQsR0FBNkVILDZCQUE3RSxDQUF5REcsZUFBekQ7QUFFQSxJQUFNQyxVQUFVLEdBQUc7QUFDakIsK0JBQTZCO0FBQzNCQyxJQUFBQSxRQUFRLEVBQUUsVUFEaUI7QUFDTDtBQUV0QixpS0FDRTtBQUNFQyxNQUFBQSxPQUFPLEVBQUU7QUFEWCxLQUp5QjtBQVEzQixpREFBNkM7QUFDM0NDLE1BQUFBLFVBQVUsRUFBRTtBQUQrQixLQVJsQjtBQVkzQiw4Q0FBMEM7QUFDeENDLE1BQUFBLEtBQUssRUFBRTtBQURpQyxLQVpmO0FBZ0IzQixpREFBNkM7QUFDM0NGLE1BQUFBLE9BQU8sRUFBRSxN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RUFBRXNELG1CQUFVRyxNQUFWLENBQWlCQztBQURILEtBQWhCLEVBRUhBLFVBVHFCO0FBVXhCL0IsSUFBQUEsSUFBSSxFQUFFMkIsbUJBQVVHLE1BVlE7QUFXeEI3QixJQUFBQSxVQUFVLEVBQUUwQixtQkFBVUcsTUFYRTtBQVl4QkUsSUFBQUEsU0FBUyxFQUFFTCxtQkFBVUcsTUFaRztBQWF4QkcsSUFBQUEsSUFBSSxFQUFFTixtQkFBVUcsTUFBVixDQUFpQkM7QUFiQyxHQUFoQixFQWNQQSxVQWZxQjtBQWdCeEJ0RCxFQUFBQSxhQUFhLEVBQUVrRCxtQkFBVU8sSUFoQkQ7QUFrQnhCO0FBQ0E7QUFDQXhELEVBQUFBLG9CQUFvQixFQUFFaUQsbUJBQVVRLFNBQVYsQ0FBb0IsQ0FBQ1IsbUJBQVVTLEtBQVYsQ0FBZ0IsQ0FBQyxLQUFELENBQWhCLENBQUQsRUFBMkJULG1CQUFVVSxJQUFyQyxDQUFwQixDQXBCRTtBQXFCeEIxRCxFQUFBQSxnQkFBZ0IsRUFBRWdELG1CQUFVVSxJQUFWLENBQWVOLFVBckJUO0FBdUJ4QjtBQUNBO0FBQ0FuRCxFQUFBQSxZQUFZLEVBQUUrQyxtQkFBVVEsU0FBVixDQUFvQixDQUFDUixtQkFBVVMsS0FBVixDQUFnQixDQUFDLEtBQUQsQ0FBaEIsQ0FBRCxFQUEyQlQsbUJBQVVVLElBQXJDLENBQXBCLENBekJVO0FBMEJ4QnhELEVBQUFBLFdBQVcsRUFBRThDLG1CQUFVTztBQTFCQyxDQUExQjtlQTZCZTFELGEiLCJzb3VyY2VSb290IjoiY29tcG9uZW50Oi8vLyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludCBjb21wbGV4aXR5OiBbXCJlcnJvclwiLCAzMF0gKi9cblxuaW1wb3J0IHsgRGlyZWN0TGluZUFjdGl2aXR5IH0gZnJvbSAnYm90ZnJhbWV3b3JrLXdlYmNoYXQtY29yZSc7XG5pbXBvcnQgeyBob29rcywgUmVuZGVyQXR0YWNobWVudCB9IGZyb20gJ2JvdGZyYW1ld29yay13ZWJjaGF0LWFwaSc7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QsIHsgRkMsIFJlYWN0Tm9kZSB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IEJ1YmJsZSBmcm9tICcuL0J1YmJsZSc7XG5pbXBvcnQgY29ubmVjdFRvV2ViQ2hhdCBmcm9tICcuLi9jb25uZWN0VG9XZWJDaGF0JztcbmltcG9ydCBpc1plcm9PclBvc2l0aXZlIGZyb20gJy4uL1V0aWxzL2lzWmVyb09yUG9zaXRpdmUnO1xuaW1wb3J0IFNjcmVlblJlYWRlclRleHQgZnJvbSAnLi4vU2NyZWVuUmVhZGVyVGV4dCc7XG5pbXBvcnQgdGV4dEZvcm1hdFRvQ29udGVudFR5cGUgZnJvbSAnLi4vVXRpbHMvdGV4dEZvcm1hdFRvQ29udGVudFR5cGUnO1xuaW1wb3J0IHVzZVN0eWxlU2V0IGZyb20gJy4uL2hvb2tzL3VzZVN0eWxlU2V0JztcbmltcG9ydCB1c2VTdHlsZVRvRW1vdGlvbk9iamVjdCBmcm9tICcuLi9ob29rcy9pbnRlcm5hbC91c2VTdHlsZVRvRW1vdGlvbk9iamVjdCc7XG5cbmltcG9ydCB1c2VVbmlxdWVJZCBmcm9tICcuLi9ob29rcy9pbnRlcm5hbC91c2VVbmlxdWVJZCc7XG5cbmNvbnN0IHsgdXNlQXZhdGFyRm9yQm90LCB1c2VBdmF0YXJGb3JVc2VyLCB1c2VMb2NhbGl6ZXIsIHVzZVN0eWxlT3B0aW9ucyB9ID0gaG9va3M7XG5cbmNvbnN0IFJPT1RfU1RZTEUgPSB7XG4gICcmLndlYmNoYXRfX3N0YWNrZWQtbGF5b3V0Jzoge1xuICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLCAvLyBUaGlzIGlzIHRvIGtlZXAgc2NyZWVuIHJlYWRlciB0ZXh0IGluIHRoZSBkZXN0aW5hdGVkIGFyZWEuXG5cbiAgICAnJiAud2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX2F0dGFjaG1lbnQtcm93LCAmIC53ZWJjaGF0X19zdGFja2VkLWxheW91dF9fbWFpbiwgJiAud2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX21lc3NhZ2Utcm93LCAmIC53ZWJjaGF0X19zdGFja2VkLWxheW91dF9fc3RhdHVzJzpcbiAgICAgIHtcbiAgICAgICAgZGlzcGxheTogJ2ZsZXgnXG4gICAgICB9LFxuXG4gICAgJyYgLndlYmNoYXRfX3N0YWNrZWQtbGF5b3V0X19hbGlnbm1lbnQtcGFkJzoge1xuICAgICAgZmxleFNocmluazogMFxuICAgIH0sXG5cbiAgICAnJiAud2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX2F0dGFjaG1lbnQnOiB7XG4gICAgICB3aWR0aDogJzEwMCUnXG4gICAgfSxcblxuICAgICcmIC53ZWJjaGF0X19zdGFja2VkLWxheW91dF9fYXZhdGFyLWd1dHRlcic6IHtcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICAgICAgZmxleFNocmluazogMFxuICAgIH0sXG5cbiAgICAnJi53ZWJjaGF0X19zdGFja2VkLWxheW91dC0tZnJvbS11c2VyJzoge1xuICAgICAgJyYgLndlYmNoYXRfX3N0YWNrZWQtbGF5b3V0X19hdHRhY2htZW50LXJvdywgJiAud2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX21haW4sICYgLndlYmNoYXRfX3N0YWNrZWQtbGF5b3V0X19tZXNzYWdlLXJvdywgJiAud2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX3N0YXR1cyc6XG4gICAgICAgIHtcbiAgICAgICAgICBmbGV4RGlyZWN0aW9uOiAncm93LXJldmVyc2UnXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgJyYgLndlYmNoYXRfX3N0YWNrZWQtbGF5b3V0X19jb250ZW50Jzoge1xuICAgICAgZmxleDogMSxcblxuICAgICAgLy8gVGhpcyBpcyBmb3IgYm90dG9tIGFsaWduaW5nIGFuIGF2YXRhciB3aXRoIGEgbWVzc2FnZSBidWJibGUgc2hvcnRlciB0aGFuIHRoZSBhdmF0YXIuXG4gICAgICAvLyBSZWxhdGVkIHRvIHRoZSB0ZXN0IGF0IGFjdGl2aXR5R3JvdXBpbmcuYXZhdGFyTWlkZGxld2FyZS5hdEJvdHRvbS5qcy5cbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuXG4gICAgICAvLyBUaGlzIFwib3ZlcmZsb3c6IGhpZGRlblwiIGlzIHRvIG1ha2Ugc3VyZSB0ZXh0IG92ZXJmbG93IHdpbGwgZ2V0IGNsaXBwZWQgY29ycmVjdGx5LlxuICAgICAgLy8gUmVsYXRlZCB0byB0aGUgdGVzdCBhdCBiYXNpYy5qcyBcImxvbmcgVVJMcyB3aXRoIGtlZXAtYWxsXCIuXG4gICAgICBvdmVyZmxvdzogJ2hpZGRlbidcbiAgICB9LFxuXG4gICAgJyYgLndlYmNoYXRfX3N0YWNrZWQtbGF5b3V0X19udWItcGFkJzoge1xuICAgICAgZmxleFNocmluazogMFxuICAgIH1cbiAgfVxufTtcblxuY29uc3QgY29ubmVjdFN0YWNrZWRMYXlvdXQgPSAoLi4uc2VsZWN0b3JzKSA9PlxuICBjb25uZWN0VG9XZWJDaGF0KFxuICAgIChcbiAgICAgIHtcbiAgICAgICAgbGFuZ3VhZ2UsXG4gICAgICAgIHN0eWxlU2V0OiB7XG4gICAgICAgICAgb3B0aW9uczogeyBib3RBdmF0YXJJbml0aWFscywgdXNlckF2YXRhckluaXRpYWxzIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHsgYWN0aXZpdHk6IHsgZnJvbTogeyByb2xlID0gdW5kZWZpbmVkIH0gPSB7fSB9ID0ge30gfVxuICAgICkgPT4gKHtcbiAgICAgIGF2YXRhckluaXRpYWxzOiByb2xlID09PSAndXNlcicgPyB1c2VyQXZhdGFySW5pdGlhbHMgOiBib3RBdmF0YXJJbml0aWFscyxcbiAgICAgIGxhbmd1YWdlLFxuXG4gICAgICAvLyBUT0RPOiBbUDRdIFdlIHdhbnQgdG8gZGVwcmVjYXRlIGJvdEF2YXRhckluaXRpYWxzL3VzZXJBdmF0YXJJbml0aWFscyBiZWNhdXNlIHRoZXkgYXJlIG5vdCBhcyBoZWxwZnVsIGFzIGF2YXRhckluaXRpYWxzXG4gICAgICBib3RBdmF0YXJJbml0aWFscyxcbiAgICAgIHVzZXJBdmF0YXJJbml0aWFsc1xuICAgIH0pLFxuICAgIC4uLnNlbGVjdG9yc1xuICApO1xuXG50eXBlIFN0YWNrZWRMYXlvdXRQcm9wcyA9IHtcbiAgYWN0aXZpdHk6IERpcmVjdExpbmVBY3Rpdml0eTtcbiAgaGlkZVRpbWVzdGFtcD86IGJvb2xlYW47XG4gIHJlbmRlckFjdGl2aXR5U3RhdHVzPzogKCh7IGhpZGVUaW1lc3RhbXA6IGJvb2xlYW4gfSkgPT4gRXhjbHVkZTxSZWFjdE5vZGUsIGJvb2xlYW4gfCBudWxsIHwgdW5kZWZpbmVkPikgfCBmYWxzZTtcbiAgcmVuZGVyQXR0YWNobWVudD86IFJlbmRlckF0dGFjaG1lbnQ7XG4gIHJlbmRlckF2YXRhcj86IChhY3Rpdml0eTogRGlyZWN0TGluZUFjdGl2aXR5KSA9PiAoKCkgPT4gRXhjbHVkZTxSZWFjdE5vZGUsIGJvb2xlYW4gfCBudWxsIHwgdW5kZWZpbmVkPikgfCBmYWxzZTtcbiAgc2hvd0NhbGxvdXQ/OiBib29sZWFuO1xufTtcblxuY29uc3QgU3RhY2tlZExheW91dDogRkM8U3RhY2tlZExheW91dFByb3BzPiA9ICh7XG4gIGFjdGl2aXR5LFxuICBoaWRlVGltZXN0YW1wLFxuICByZW5kZXJBY3Rpdml0eVN0YXR1cyxcbiAgcmVuZGVyQXR0YWNobWVudCxcbiAgcmVuZGVyQXZhdGFyLFxuICBzaG93Q2FsbG91dFxufSkgPT4ge1xuICBjb25zdCBbc3R5bGVPcHRpb25zXSA9IHVzZVN0eWxlT3B0aW9ucygpO1xuICBjb25zdCBbeyBpbml0aWFsczogYm90SW5pdGlhbHMgfV0gPSB1c2VBdmF0YXJGb3JCb3QoKTtcbiAgY29uc3QgW3sgaW5pdGlhbHM6IHVzZXJJbml0aWFscyB9XSA9IHVzZUF2YXRhckZvclVzZXIoKTtcbiAgY29uc3QgW3sgc3RhY2tlZExheW91dDogc3RhY2tlZExheW91dFN0eWxlU2V0IH1dID0gdXNlU3R5bGVTZXQoKTtcbiAgY29uc3QgYXJpYUxhYmVsSWQgPSB1c2VVbmlxdWVJZCgnd2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX2lkJyk7XG4gIGNvbnN0IGxvY2FsaXplID0gdXNlTG9jYWxpemVyKCk7XG4gIGNvbnN0IHJvb3RDbGFzc05hbWUgPSB1c2VTdHlsZVRvRW1vdGlvbk9iamVjdCgpKFJPT1RfU1RZTEUpICsgJyc7XG5cbiAgY29uc3QgeyBidWJibGVOdWJPZmZzZXQsIGJ1YmJsZU51YlNpemUsIGJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0LCBidWJibGVGcm9tVXNlck51YlNpemUgfSA9IHN0eWxlT3B0aW9ucztcblxuICBjb25zdCB7XG4gICAgYXR0YWNobWVudHMgPSBbXSxcbiAgICBjaGFubmVsRGF0YTogeyBtZXNzYWdlQmFjazogeyBkaXNwbGF5VGV4dDogbWVzc2FnZUJhY2tEaXNwbGF5VGV4dCB9ID0ge30gfSA9IHt9LFxuICAgIGZyb206IHsgcm9sZSB9ID0ge30sXG4gICAgdGV4dCxcbiAgICB0ZXh0Rm9ybWF0XG4gIH06IHtcbiAgICBhdHRhY2htZW50cz86IFtdO1xuICAgIGNoYW5uZWxEYXRhPzogeyBtZXNzYWdlQmFjaz86IHsgZGlzcGxheVRleHQ/OiBzdHJpbmcgfSB9O1xuICAgIGZyb20/OiB7IHJvbGU/OiAnYm90JyB8ICd1c2VyJyB9O1xuICAgIHRleHQ/OiBzdHJpbmc7XG4gICAgdGV4dEZvcm1hdD86IHN0cmluZztcbiAgfSA9IGFjdGl2aXR5O1xuXG4gIGNvbnN0IGFjdGl2aXR5RGlzcGxheVRleHQgPSBtZXNzYWdlQmFja0Rpc3BsYXlUZXh0IHx8IHRleHQ7XG4gIGNvbnN0IGZyb21Vc2VyID0gcm9sZSA9PT0gJ3VzZXInO1xuXG4gIGNvbnN0IGF0dGFjaGVkQWx0ID0gbG9jYWxpemUoZnJvbVVzZXIgPyAnQUNUSVZJVFlfWU9VX0FUVEFDSEVEX0FMVCcgOiAnQUNUSVZJVFlfQk9UX0FUVEFDSEVEX0FMVCcpO1xuICBjb25zdCBncmVldGluZ0FsdCA9IChcbiAgICBmcm9tVXNlciA/IGxvY2FsaXplKCdBQ1RJVklUWV9ZT1VfU0FJRF9BTFQnKSA6IGxvY2FsaXplKCdBQ1RJVklUWV9CT1RfU0FJRF9BTFQnLCBib3RJbml0aWFscyB8fCAnJylcbiAgKS5yZXBsYWNlKC9cXHN7Mix9L2d1LCAnICcpO1xuXG4gIGNvbnN0IGluaXRpYWxzID0gZnJvbVVzZXIgPyB1c2VySW5pdGlhbHMgOiBib3RJbml0aWFscztcbiAgY29uc3QgbnViT2Zmc2V0ID0gZnJvbVVzZXIgPyBidWJibGVGcm9tVXNlck51Yk9mZnNldCA6IGJ1YmJsZU51Yk9mZnNldDtcbiAgY29uc3QgbnViU2l6ZSA9IGZyb21Vc2VyID8gYnViYmxlRnJvbVVzZXJOdWJTaXplIDogYnViYmxlTnViU2l6ZTtcbiAgY29uc3Qgb3RoZXJJbml0aWFscyA9IGZyb21Vc2VyID8gYm90SW5pdGlhbHMgOiB1c2VySW5pdGlhbHM7XG4gIGNvbnN0IG90aGVyTnViU2l6ZSA9IGZyb21Vc2VyID8gYnViYmxlTnViU2l6ZSA6IGJ1YmJsZUZyb21Vc2VyTnViU2l6ZTtcblxuICBjb25zdCBoYXNBdmF0YXIgPSBpbml0aWFscyB8fCB0eXBlb2YgaW5pdGlhbHMgPT09ICdzdHJpbmcnO1xuICBjb25zdCBoYXNPdGhlckF2YXRhciA9IG90aGVySW5pdGlhbHMgfHwgdHlwZW9mIG90aGVySW5pdGlhbHMgPT09ICdzdHJpbmcnO1xuICBjb25zdCBoYXNOdWIgPSB0eXBlb2YgbnViU2l6ZSA9PT0gJ251bWJlcic7XG4gIGNvbnN0IGhhc090aGVyTnViID0gdHlwZW9mIG90aGVyTnViU2l6ZSA9PT0gJ251bWJlcic7XG4gIGNvbnN0IHRvcEFsaWduZWRDYWxsb3V0ID0gaXNaZXJvT3JQb3NpdGl2ZShudWJPZmZzZXQpO1xuXG4gIGNvbnN0IGV4dHJhVHJhaWxpbmcgPSAhaGFzT3RoZXJBdmF0YXIgJiYgaGFzT3RoZXJOdWI7IC8vIFRoaXMgaXMgZm9yIGJvdCBtZXNzYWdlIHdpdGggdXNlciBudWIgYW5kIG5vIHVzZXIgYXZhdGFyLiBBbmQgdmljZSB2ZXJzYS5cblxuICBjb25zdCBzaG93QXZhdGFyID0gc2hvd0NhbGxvdXQgJiYgaGFzQXZhdGFyICYmICEhcmVuZGVyQXZhdGFyO1xuICBjb25zdCBzaG93TnViID0gc2hvd0NhbGxvdXQgJiYgaGFzTnViICYmICh0b3BBbGlnbmVkQ2FsbG91dCB8fCAhYXR0YWNobWVudHMubGVuZ3RoKTtcblxuICByZXR1cm4gKFxuICAgIDxkaXZcbiAgICAgIGFyaWEtbGFiZWxsZWRieT17YWN0aXZpdHlEaXNwbGF5VGV4dCA/IGFyaWFMYWJlbElkIDogdW5kZWZpbmVkfVxuICAgICAgYXJpYS1yb2xlZGVzY3JpcHRpb249XCJhY3Rpdml0eVwiXG4gICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoJ3dlYmNoYXRfX3N0YWNrZWQtbGF5b3V0Jywgcm9vdENsYXNzTmFtZSwgc3RhY2tlZExheW91dFN0eWxlU2V0ICsgJycsIHtcbiAgICAgICAgJ3dlYmNoYXRfX3N0YWNrZWQtbGF5b3V0LS1leHRyYS10cmFpbGluZyc6IGV4dHJhVHJhaWxpbmcsXG4gICAgICAgICd3ZWJjaGF0X19zdGFja2VkLWxheW91dC0tZnJvbS11c2VyJzogZnJvbVVzZXIsXG4gICAgICAgICd3ZWJjaGF0X19zdGFja2VkLWxheW91dC0taGlkZS1hdmF0YXInOiBoYXNBdmF0YXIgJiYgIXNob3dBdmF0YXIsXG4gICAgICAgICd3ZWJjaGF0X19zdGFja2VkLWxheW91dC0taGlkZS1udWInOiBoYXNOdWIgJiYgIXNob3dOdWIsXG4gICAgICAgICd3ZWJjaGF0X19zdGFja2VkLWxheW91dC0tbm8tbWVzc2FnZSc6ICFhY3Rpdml0eURpc3BsYXlUZXh0LFxuICAgICAgICAnd2ViY2hhdF9fc3RhY2tlZC1sYXlvdXQtLXNob3ctYXZhdGFyJzogc2hvd0F2YXRhcixcbiAgICAgICAgJ3dlYmNoYXRfX3N0YWNrZWQtbGF5b3V0LS1zaG93LW51Yic6IHNob3dOdWIsXG4gICAgICAgICd3ZWJjaGF0X19zdGFja2VkLWxheW91dC0tdG9wLWNhbGxvdXQnOiB0b3BBbGlnbmVkQ2FsbG91dFxuICAgICAgfSl9XG4gICAgICByb2xlPVwiZ3JvdXBcIlxuICAgID5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwid2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX21haW5cIj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3ZWJjaGF0X19zdGFja2VkLWxheW91dF9fYXZhdGFyLWd1dHRlclwiPlxuICAgICAgICAgIHtzaG93QXZhdGFyICYmIHJlbmRlckF2YXRhciAmJiByZW5kZXJBdmF0YXIoeyBhY3Rpdml0eSB9KX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwid2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX2NvbnRlbnRcIj5cbiAgICAgICAgICB7ISFhY3Rpdml0eURpc3BsYXlUZXh0ICYmIChcbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgYXJpYS1yb2xlZGVzY3JpcHRpb249XCJtZXNzYWdlXCJcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPVwid2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX21lc3NhZ2Utcm93XCJcbiAgICAgICAgICAgICAgLy8gRGlzYWJsZSBcIlByb3AgYGlkYCBpcyBmb3JiaWRkZW4gb24gRE9NIE5vZGVzXCIgcnVsZSBiZWNhdXNlIHdlIGFyZSB1c2luZyB0aGUgSUQgcHJvcCBmb3IgYWNjZXNzaWJpbGl0eS5cbiAgICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2ZvcmJpZC1kb20tcHJvcHMgKi9cbiAgICAgICAgICAgICAgaWQ9e2FyaWFMYWJlbElkfVxuICAgICAgICAgICAgICByb2xlPVwiZ3JvdXBcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8U2NyZWVuUmVhZGVyVGV4dCB0ZXh0PXtncmVldGluZ0FsdH0gLz5cbiAgICAgICAgICAgICAgPEJ1YmJsZVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIndlYmNoYXRfX3N0YWNrZWQtbGF5b3V0X19tZXNzYWdlXCJcbiAgICAgICAgICAgICAgICBmcm9tVXNlcj17ZnJvbVVzZXJ9XG4gICAgICAgICAgICAgICAgbnViPXtzaG93TnViIHx8IChoYXNBdmF0YXIgfHwgaGFzTnViID8gJ2hpZGRlbicgOiBmYWxzZSl9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7cmVuZGVyQXR0YWNobWVudCh7XG4gICAgICAgICAgICAgICAgICBhY3Rpdml0eSxcbiAgICAgICAgICAgICAgICAgIGF0dGFjaG1lbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogYWN0aXZpdHlEaXNwbGF5VGV4dCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IHRleHRGb3JtYXRUb0NvbnRlbnRUeXBlKHRleHRGb3JtYXQpXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgIDwvQnViYmxlPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgKX1cbiAgICAgICAgICB7YXR0YWNobWVudHMubWFwKChhdHRhY2htZW50LCBpbmRleCkgPT4gKFxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICBhcmlhLXJvbGVkZXNjcmlwdGlvbj1cImF0dGFjaG1lbnRcIlxuICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoJ3dlYmNoYXRfX3N0YWNrZWQtbGF5b3V0X19hdHRhY2htZW50LXJvdycsIHtcbiAgICAgICAgICAgICAgICAnd2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX2F0dGFjaG1lbnQtcm93LS1maXJzdCc6ICFpbmRleFxuICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgICAgLyogYXR0YWNobWVudHMgZG8gbm90IGhhdmUgYW4gSUQsIGl0IGlzIGFsd2F5cyBpbmRleGVkIGJ5IG51bWJlciAqL1xuICAgICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvbm8tYXJyYXktaW5kZXgta2V5ICovXG4gICAgICAgICAgICAgIGtleT17aW5kZXh9XG4gICAgICAgICAgICAgIHJvbGU9XCJncm91cFwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxTY3JlZW5SZWFkZXJUZXh0IHRleHQ9e2F0dGFjaGVkQWx0fSAvPlxuICAgICAgICAgICAgICA8QnViYmxlXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwid2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX2F0dGFjaG1lbnRcIlxuICAgICAgICAgICAgICAgIGZyb21Vc2VyPXtmcm9tVXNlcn1cbiAgICAgICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvbm8tYXJyYXktaW5kZXgta2V5ICovXG4gICAgICAgICAgICAgICAga2V5PXtpbmRleH1cbiAgICAgICAgICAgICAgICBudWI9e2hhc0F2YXRhciB8fCBoYXNOdWIgPyAnaGlkZGVuJyA6IGZhbHNlfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge3JlbmRlckF0dGFjaG1lbnQoeyBhY3Rpdml0eSwgYXR0YWNobWVudCB9KX1cbiAgICAgICAgICAgICAgPC9CdWJibGU+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICApKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwid2ViY2hhdF9fc3RhY2tlZC1sYXlvdXRfX2FsaWdubWVudC1wYWRcIiAvPlxuICAgICAgPC9kaXY+XG4gICAgICB7dHlwZW9mIHJlbmRlckFjdGl2aXR5U3RhdHVzID09PSAnZnVuY3Rpb24nICYmIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3ZWJjaGF0X19zdGFja2VkLWxheW91dF9fc3RhdHVzXCI+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3ZWJjaGF0X19zdGFja2VkLWxheW91dF9fYXZhdGFyLWd1dHRlclwiIC8+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3ZWJjaGF0X19zdGFja2VkLWxheW91dF9fbnViLXBhZFwiIC8+XG4gICAgICAgICAge3JlbmRlckFjdGl2aXR5U3RhdHVzKHsgaGlkZVRpbWVzdGFtcCB9KX1cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIndlYmNoYXRfX3N0YWNrZWQtbGF5b3V0X19hbGlnbm1lbnQtcGFkXCIgLz5cbiAgICAgICAgPC9kaXY+XG4gICAgICApfVxuICAgIDwvZGl2PlxuICApO1xufTtcblxuU3RhY2tlZExheW91dC5kZWZhdWx0UHJvcHMgPSB7XG4gIGhpZGVUaW1lc3RhbXA6IGZhbHNlLFxuICByZW5kZXJBY3Rpdml0eVN0YXR1czogZmFsc2UsXG4gIHJlbmRlckF2YXRhcjogdW5kZWZpbmVkLFxuICBzaG93Q2FsbG91dDogdHJ1ZVxufTtcblxuU3RhY2tlZExheW91dC5wcm9wVHlwZXMgPSB7XG4gIGFjdGl2aXR5OiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgIGF0dGFjaG1lbnRzOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgY2hhbm5lbERhdGE6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICBtZXNzYWdlQmFjazogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgZGlzcGxheVRleHQ6IFByb3BUeXBlcy5zdHJpbmdcbiAgICAgIH0pXG4gICAgfSksXG4gICAgZnJvbTogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIHJvbGU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZFxuICAgIH0pLmlzUmVxdWlyZWQsXG4gICAgdGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICB0ZXh0Rm9ybWF0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHRpbWVzdGFtcDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICB0eXBlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWRcbiAgfSkuaXNSZXF1aXJlZCxcbiAgaGlkZVRpbWVzdGFtcDogUHJvcFR5cGVzLmJvb2wsXG5cbiAgLy8gUHJvcFR5cGVzIGNhbm5vdCB2YWxpZGF0ZSBwcmVjaXNlbHkgd2l0aCBpdHMgVHlwZVNjcmlwdCBjb3VudGVycGFydC5cbiAgLy8gQHRzLWlnbm9yZVxuICByZW5kZXJBY3Rpdml0eVN0YXR1czogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm9uZU9mKFtmYWxzZV0pLCBQcm9wVHlwZXMuZnVuY10pLFxuICByZW5kZXJBdHRhY2htZW50OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuXG4gIC8vIFByb3BUeXBlcyBjYW5ub3QgdmFsaWRhdGUgcHJlY2lzZWx5IHdpdGggaXRzIFR5cGVTY3JpcHQgY291bnRlcnBhcnQuXG4gIC8vIEB0cy1pZ25vcmVcbiAgcmVuZGVyQXZhdGFyOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMub25lT2YoW2ZhbHNlXSksIFByb3BUeXBlcy5mdW5jXSksXG4gIHNob3dDYWxsb3V0OiBQcm9wVHlwZXMuYm9vbFxufTtcblxuZXhwb3J0IGRlZmF1bHQgU3RhY2tlZExheW91dDtcblxuZXhwb3J0IHsgY29ubmVjdFN0YWNrZWRMYXlvdXQgfTtcbiJdfQ==