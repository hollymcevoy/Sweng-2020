"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createCoreMiddleware;

var _react = _interopRequireDefault(require("react"));

var _AudioAttachment = _interopRequireDefault(require("../../Attachment/AudioAttachment"));

var _FileAttachment = _interopRequireDefault(require("../../Attachment/FileAttachment"));

var _ImageAttachment = _interopRequireDefault(require("../../Attachment/ImageAttachment"));

var _TextAttachment = _interopRequireDefault(require("../../Attachment/TextAttachment"));

var _VideoAttachment = _interopRequireDefault(require("../../Attachment/VideoAttachment"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// TODO: [P4] Rename this file or the whole middleware, it looks either too simple or too comprehensive now
function createCoreMiddleware() {
  return [function () {
    return function (next) {
      return function () {
        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        var _args$ = args[0],
            _args$$activity = _args$.activity,
            activity = _args$$activity === void 0 ? {} : _args$$activity,
            _args$$activity2 = _args$.activity;
        _args$$activity2 = _args$$activity2 === void 0 ? {} : _args$$activity2;
        var _args$$activity2$from = _args$$activity2.from;
        _args$$activity2$from = _args$$activity2$from === void 0 ? {} : _args$$activity2$from;
        var _args$$activity2$from2 = _args$$activity2$from.role,
            role = _args$$activity2$from2 === void 0 ? undefined : _args$$activity2$from2,
            attachment = _args$.attachment,
            _args$$attachment = _args$.attachment;
        _args$$attachment = _args$$attachment === void 0 ? {} : _args$$attachment;
        var _args$$attachment$con = _args$$attachment.contentType,
            contentType = _args$$attachment$con === void 0 ? undefined : _args$$attachment$con,
            _args$$attachment$con2 = _args$$attachment.contentUrl,
            contentUrl = _args$$attachment$con2 === void 0 ? undefined : _args$$attachment$con2,
            _args$$attachment$thu = _args$$attachment.thumbnailUrl,
            thumbnailUrl = _args$$attachment$thu === void 0 ? undefined : _args$$attachment$thu;
        var isText = /^text\//.test(contentType);
        return (isText ? !attachment.content : role === 'user' && !thumbnailUrl) ? /*#__PURE__*/_react.default.createElement(_FileAttachment.default, {
          activity: activity,
          attachment: attachment
        }) : /^audio\//.test(contentType) ? /*#__PURE__*/_react.default.createElement(_AudioAttachment.default, {
          attachment: attachment
        }) : /^image\//.test(contentType) ? /*#__PURE__*/_react.default.createElement(_ImageAttachment.default, {
          attachment: attachment
        }) : /^video\//.test(contentType) ? /*#__PURE__*/_react.default.createElement(_VideoAttachment.default, {
          attachment: attachment
        }) : contentUrl || contentType === 'application/octet-stream' ? /*#__PURE__*/_react.default.createElement(_FileAttachment.default, {
          activity: activity,
          attachment: attachment
        }) : isText ? /*#__PURE__*/_react.default.createElement(_TextAttachment.default, {
          attachment: attachment
        }) : next.apply(void 0, args);
      };
    };
  }];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9NaWRkbGV3YXJlL0F0dGFjaG1lbnQvY3JlYXRlQ29yZU1pZGRsZXdhcmUudHN4Il0sIm5hbWVzIjpbImNyZWF0ZUNvcmVNaWRkbGV3YXJlIiwibmV4dCIsImFyZ3MiLCJhY3Rpdml0eSIsImZyb20iLCJyb2xlIiwidW5kZWZpbmVkIiwiYXR0YWNobWVudCIsImNvbnRlbnRUeXBlIiwiY29udGVudFVybCIsInRodW1ibmFpbFVybCIsImlzVGV4dCIsInRlc3QiLCJjb250ZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQTtBQUNlLFNBQVNBLG9CQUFULEdBQXdEO0FBQ3JFLFNBQU8sQ0FDTDtBQUFBLFdBQ0UsVUFBQUMsSUFBSTtBQUFBLGFBQ0osWUFBYTtBQUFBLDBDQUFUQyxJQUFTO0FBQVRBLFVBQUFBLElBQVM7QUFBQTs7QUFDWCxxQkFPSUEsSUFQSjtBQUFBLHFDQUVJQyxRQUZKO0FBQUEsWUFFSUEsUUFGSixnQ0FFZSxFQUZmO0FBQUEsc0NBR0lBLFFBSEo7QUFBQSx5REFHb0QsRUFIcEQ7QUFBQSxxREFHZ0JDLElBSGhCO0FBQUEsbUVBRzZDLEVBSDdDO0FBQUEsMkRBR3dCQyxJQUh4QjtBQUFBLFlBR3dCQSxJQUh4Qix1Q0FHK0JDLFNBSC9CO0FBQUEsWUFJSUMsVUFKSixVQUlJQSxVQUpKO0FBQUEsdUNBS0lBLFVBTEo7QUFBQSwyREFLZ0csRUFMaEc7QUFBQSxzREFLa0JDLFdBTGxCO0FBQUEsWUFLa0JBLFdBTGxCLHNDQUtnQ0YsU0FMaEM7QUFBQSx1REFLMkNHLFVBTDNDO0FBQUEsWUFLMkNBLFVBTDNDLHVDQUt3REgsU0FMeEQ7QUFBQSxzREFLbUVJLFlBTG5FO0FBQUEsWUFLbUVBLFlBTG5FLHNDQUtrRkosU0FMbEY7QUFTQSxZQUFNSyxNQUFNLEdBQUcsVUFBV0MsSUFBWCxDQUFnQkosV0FBaEIsQ0FBZjtBQUVBLGVBQU8sQ0FBQ0csTUFBTSxHQUFHLENBQUNKLFVBQVUsQ0FBQ00sT0FBZixHQUF5QlIsSUFBSSxLQUFLLE1BQVQsSUFBbUIsQ0FBQ0ssWUFBcEQsaUJBQ0wsNkJBQUMsdUJBQUQ7QUFBZ0IsVUFBQSxRQUFRLEVBQUVQLFFBQTFCO0FBQW9DLFVBQUEsVUFBVSxFQUFFSTtBQUFoRCxVQURLLEdBRUgsV0FBWUssSUFBWixDQUFpQkosV0FBakIsaUJBQ0YsNkJBQUMsd0JBQUQ7QUFBaUIsVUFBQSxVQUFVLEVBQUVEO0FBQTdCLFVBREUsR0FFQSxXQUFZSyxJQUFaLENBQWlCSixXQUFqQixpQkFDRiw2QkFBQyx3QkFBRDtBQUFpQixVQUFBLFVBQVUsRUFBRUQ7QUFBN0IsVUFERSxHQUVBLFdBQVlLLElBQVosQ0FBaUJKLFdBQWpCLGlCQUNGLDZCQUFDLHdCQUFEO0FBQWlCLFVBQUEsVUFBVSxFQUFFRDtBQUE3QixVQURFLEdBRUFFLFVBQVUsSUFBSUQsV0FBVyxLQUFLLDBCQUE5QixnQkFDRiw2QkFBQyx1QkFBRDtBQUFnQixVQUFBLFFBQVEsRUFBRUwsUUFBMUI7QUFBb0MsVUFBQSxVQUFVLEVBQUVJO0FBQWhELFVBREUsR0FFQUksTUFBTSxnQkFDUiw2QkFBQyx1QkFBRDtBQUFnQixVQUFBLFVBQVUsRUFBRUo7QUFBNUIsVUFEUSxHQUdSTixJQUFJLE1BQUosU0FBUUMsSUFBUixDQWJGO0FBZUQsT0E1Qkc7QUFBQSxLQUROO0FBQUEsR0FESyxDQUFQO0FBZ0NEIiwic291cmNlUm9vdCI6ImNvbXBvbmVudDovLy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBdHRhY2htZW50TWlkZGxld2FyZSB9IGZyb20gJ2JvdGZyYW1ld29yay13ZWJjaGF0LWFwaSc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgQXVkaW9BdHRhY2htZW50IGZyb20gJy4uLy4uL0F0dGFjaG1lbnQvQXVkaW9BdHRhY2htZW50JztcbmltcG9ydCBGaWxlQXR0YWNobWVudCBmcm9tICcuLi8uLi9BdHRhY2htZW50L0ZpbGVBdHRhY2htZW50JztcbmltcG9ydCBJbWFnZUF0dGFjaG1lbnQgZnJvbSAnLi4vLi4vQXR0YWNobWVudC9JbWFnZUF0dGFjaG1lbnQnO1xuaW1wb3J0IFRleHRBdHRhY2htZW50IGZyb20gJy4uLy4uL0F0dGFjaG1lbnQvVGV4dEF0dGFjaG1lbnQnO1xuaW1wb3J0IFZpZGVvQXR0YWNobWVudCBmcm9tICcuLi8uLi9BdHRhY2htZW50L1ZpZGVvQXR0YWNobWVudCc7XG5cbi8vIFRPRE86IFtQNF0gUmVuYW1lIHRoaXMgZmlsZSBvciB0aGUgd2hvbGUgbWlkZGxld2FyZSwgaXQgbG9va3MgZWl0aGVyIHRvbyBzaW1wbGUgb3IgdG9vIGNvbXByZWhlbnNpdmUgbm93XG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVDb3JlTWlkZGxld2FyZSgpOiBBdHRhY2htZW50TWlkZGxld2FyZVtdIHtcbiAgcmV0dXJuIFtcbiAgICAoKSA9PlxuICAgICAgbmV4dCA9PlxuICAgICAgKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgY29uc3QgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGFjdGl2aXR5ID0ge30sXG4gICAgICAgICAgICBhY3Rpdml0eTogeyBmcm9tOiB7IHJvbGUgPSB1bmRlZmluZWQgfSA9IHt9IH0gPSB7fSxcbiAgICAgICAgICAgIGF0dGFjaG1lbnQsXG4gICAgICAgICAgICBhdHRhY2htZW50OiB7IGNvbnRlbnRUeXBlID0gdW5kZWZpbmVkLCBjb250ZW50VXJsID0gdW5kZWZpbmVkLCB0aHVtYm5haWxVcmwgPSB1bmRlZmluZWQgfSA9IHt9XG4gICAgICAgICAgfVxuICAgICAgICBdID0gYXJncztcblxuICAgICAgICBjb25zdCBpc1RleHQgPSAvXnRleHRcXC8vdS50ZXN0KGNvbnRlbnRUeXBlKTtcblxuICAgICAgICByZXR1cm4gKGlzVGV4dCA/ICFhdHRhY2htZW50LmNvbnRlbnQgOiByb2xlID09PSAndXNlcicgJiYgIXRodW1ibmFpbFVybCkgPyAoXG4gICAgICAgICAgPEZpbGVBdHRhY2htZW50IGFjdGl2aXR5PXthY3Rpdml0eX0gYXR0YWNobWVudD17YXR0YWNobWVudH0gLz5cbiAgICAgICAgKSA6IC9eYXVkaW9cXC8vdS50ZXN0KGNvbnRlbnRUeXBlKSA/IChcbiAgICAgICAgICA8QXVkaW9BdHRhY2htZW50IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICAgICkgOiAvXmltYWdlXFwvL3UudGVzdChjb250ZW50VHlwZSkgPyAoXG4gICAgICAgICAgPEltYWdlQXR0YWNobWVudCBhdHRhY2htZW50PXthdHRhY2htZW50fSAvPlxuICAgICAgICApIDogL152aWRlb1xcLy91LnRlc3QoY29udGVudFR5cGUpID8gKFxuICAgICAgICAgIDxWaWRlb0F0dGFjaG1lbnQgYXR0YWNobWVudD17YXR0YWNobWVudH0gLz5cbiAgICAgICAgKSA6IGNvbnRlbnRVcmwgfHwgY29udGVudFR5cGUgPT09ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nID8gKFxuICAgICAgICAgIDxGaWxlQXR0YWNobWVudCBhY3Rpdml0eT17YWN0aXZpdHl9IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICAgICkgOiBpc1RleHQgPyAoXG4gICAgICAgICAgPFRleHRBdHRhY2htZW50IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICAgICkgOiAoXG4gICAgICAgICAgbmV4dCguLi5hcmdzKVxuICAgICAgICApO1xuICAgICAgfVxuICBdO1xufVxuIl19