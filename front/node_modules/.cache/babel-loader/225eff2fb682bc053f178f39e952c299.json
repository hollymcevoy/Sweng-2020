{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _reactRedux = require(\"react-redux\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _simpleUpdateIn = _interopRequireDefault(require(\"simple-update-in\"));\n\nvar _botframeworkWebchatCore = require(\"botframework-webchat-core\");\n\nvar _WebChatAPIContext = _interopRequireDefault(require(\"./internal/WebChatAPIContext\"));\n\nvar _ActivityAcknowledgementComposer = _interopRequireDefault(require(\"../providers/ActivityAcknowledgement/ActivityAcknowledgementComposer\"));\n\nvar _ActivityKeyerComposer = _interopRequireDefault(require(\"../providers/ActivityKeyer/ActivityKeyerComposer\"));\n\nvar _createCustomEvent = _interopRequireDefault(require(\"../utils/createCustomEvent\"));\n\nvar _createDefaultCardActionMiddleware = _interopRequireDefault(require(\"./middleware/createDefaultCardActionMiddleware\"));\n\nvar _createDefaultGroupActivitiesMiddleware = _interopRequireDefault(require(\"./middleware/createDefaultGroupActivitiesMiddleware\"));\n\nvar _defaultSelectVoice = _interopRequireDefault(require(\"./internal/defaultSelectVoice\"));\n\nvar _ErrorBoundary = _interopRequireDefault(require(\"./utils/ErrorBoundary\"));\n\nvar _getAllLocalizedStrings = _interopRequireDefault(require(\"../localization/getAllLocalizedStrings\"));\n\nvar _isObject = _interopRequireDefault(require(\"../utils/isObject\"));\n\nvar _mapMap = _interopRequireDefault(require(\"../utils/mapMap\"));\n\nvar _normalizeLanguage = _interopRequireDefault(require(\"../utils/normalizeLanguage\"));\n\nvar _normalizeStyleOptions = _interopRequireDefault(require(\"../normalizeStyleOptions\"));\n\nvar _observableToPromise = _interopRequireDefault(require(\"./utils/observableToPromise\"));\n\nvar _patchStyleOptionsFromDeprecatedProps = _interopRequireDefault(require(\"../patchStyleOptionsFromDeprecatedProps\"));\n\nvar _Tracker = _interopRequireDefault(require(\"./internal/Tracker\"));\n\nvar _useMarkAllAsAcknowledged = _interopRequireDefault(require(\"./useMarkAllAsAcknowledged\"));\n\nvar _WebChatReduxContext = _interopRequireWildcard(require(\"./internal/WebChatReduxContext\"));\n\nvar _applyMiddleware = _interopRequireWildcard(require(\"./middleware/applyMiddleware\"));\n\nvar _PrecompiledGlobalize = _interopRequireDefault(require(\"../external/PrecompiledGlobalize\"));\n\nvar _excluded = [\"internalRenderErrorBox\", \"onTelemetry\", \"store\"];\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n} // List of Redux actions factory we are hoisting as Web Chat functions\n\n\nvar DISPATCHERS = {\n  clearSuggestedActions: _botframeworkWebchatCore.clearSuggestedActions,\n  dismissNotification: _botframeworkWebchatCore.dismissNotification,\n  emitTypingIndicator: _botframeworkWebchatCore.emitTypingIndicator,\n  markActivity: _botframeworkWebchatCore.markActivity,\n  postActivity: _botframeworkWebchatCore.postActivity,\n  sendEvent: _botframeworkWebchatCore.sendEvent,\n  sendFiles: _botframeworkWebchatCore.sendFiles,\n  sendMessage: _botframeworkWebchatCore.sendMessage,\n  sendMessageBack: _botframeworkWebchatCore.sendMessageBack,\n  sendPostBack: _botframeworkWebchatCore.sendPostBack,\n  setDictateInterims: _botframeworkWebchatCore.setDictateInterims,\n  setDictateState: _botframeworkWebchatCore.setDictateState,\n  setNotification: _botframeworkWebchatCore.setNotification,\n  setSendBox: _botframeworkWebchatCore.setSendBox,\n  setSendTimeout: _botframeworkWebchatCore.setSendTimeout,\n  startDictate: _botframeworkWebchatCore.startDictate,\n  startSpeakingActivity: _botframeworkWebchatCore.startSpeakingActivity,\n  stopDictate: _botframeworkWebchatCore.stopDictate,\n  stopSpeakingActivity: _botframeworkWebchatCore.stopSpeakingActivity,\n  submitSendBox: _botframeworkWebchatCore.submitSendBox\n};\n\nfunction createCardActionContext(_ref) {\n  var cardActionMiddleware = _ref.cardActionMiddleware,\n      directLine = _ref.directLine,\n      dispatch = _ref.dispatch,\n      markAllAsAcknowledged = _ref.markAllAsAcknowledged;\n\n  var runMiddleware = _applyMiddleware.default.apply(void 0, ['card action'].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(cardActionMiddleware)), [(0, _createDefaultCardActionMiddleware.default)()]))({\n    dispatch: dispatch\n  });\n\n  return {\n    onCardAction: function onCardAction(cardAction) {\n      var _ref2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          target = _ref2.target;\n\n      markAllAsAcknowledged();\n      return runMiddleware({\n        cardAction: cardAction,\n        getSignInUrl: cardAction.type === 'signin' ? function () {\n          var value = cardAction.value;\n\n          if (directLine.getSessionId) {\n            /**\n             * @todo TODO: [P3] We should change this one to async/await.\n             *       This is the first place in this project to use async.\n             *       Thus, we need to add @babel/plugin-transform-runtime and @babel/runtime.\n             */\n            return (0, _observableToPromise.default)(directLine.getSessionId()).then(function (sessionId) {\n              return \"\".concat(value).concat(encodeURIComponent(\"&code_challenge=\".concat(sessionId)));\n            });\n          }\n\n          console.warn('botframework-webchat: OAuth is not supported on this Direct Line adapter.');\n          return value;\n        } : null,\n        target: target\n      });\n    }\n  };\n}\n\nfunction createGroupActivitiesContext(_ref3) {\n  var groupActivitiesMiddleware = _ref3.groupActivitiesMiddleware,\n      groupTimestamp = _ref3.groupTimestamp;\n\n  var runMiddleware = _applyMiddleware.default.apply(void 0, ['group activities'].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(groupActivitiesMiddleware)), [(0, _createDefaultGroupActivitiesMiddleware.default)({\n    groupTimestamp: groupTimestamp\n  })]));\n\n  return {\n    groupActivities: runMiddleware({})\n  };\n}\n\nfunction mergeStringsOverrides(localizedStrings, language, overrideLocalizedStrings) {\n  if (!overrideLocalizedStrings) {\n    return localizedStrings;\n  } else if (typeof overrideLocalizedStrings === 'function') {\n    var merged = overrideLocalizedStrings(localizedStrings, language);\n\n    if (!(0, _isObject.default)(merged)) {\n      throw new Error('botframework-webchat: overrideLocalizedStrings function must return an object.');\n    }\n\n    return merged;\n  }\n\n  if (!(0, _isObject.default)(overrideLocalizedStrings)) {\n    throw new Error('botframework-webchat: overrideLocalizedStrings must be either a function, an object, or falsy.');\n  }\n\n  return _objectSpread(_objectSpread({}, localizedStrings), overrideLocalizedStrings);\n} // It seems \"react/require-default-props\" did not pick up `ComposerCore.defaultProps`.\n// And it falsely complaint `optional?: string` must have a corresponding `ComposerCore.defaultProps.optional = undefined`, even we already set it below.\n// Since we set both TypeScript `Props` class and `ComposerCore.propTypes`, this check will be done there as well.\n// Ignoring it in TypeScript version should be safe, as we have `propTypes` version to protect us.\n\n/* eslint-disable react/require-default-props */\n\n/* eslint-enable react/require-default-props */\n\n\nvar ComposerCore = function ComposerCore(_ref4) {\n  var activityMiddleware = _ref4.activityMiddleware,\n      activityRenderer = _ref4.activityRenderer,\n      activityStatusMiddleware = _ref4.activityStatusMiddleware,\n      activityStatusRenderer = _ref4.activityStatusRenderer,\n      attachmentMiddleware = _ref4.attachmentMiddleware,\n      attachmentForScreenReaderMiddleware = _ref4.attachmentForScreenReaderMiddleware,\n      attachmentRenderer = _ref4.attachmentRenderer,\n      avatarMiddleware = _ref4.avatarMiddleware,\n      avatarRenderer = _ref4.avatarRenderer,\n      cardActionMiddleware = _ref4.cardActionMiddleware,\n      children = _ref4.children,\n      dir = _ref4.dir,\n      directLine = _ref4.directLine,\n      disabled = _ref4.disabled,\n      downscaleImageToDataURL = _ref4.downscaleImageToDataURL,\n      grammars = _ref4.grammars,\n      groupActivitiesMiddleware = _ref4.groupActivitiesMiddleware,\n      groupTimestamp = _ref4.groupTimestamp,\n      internalErrorBoxClass = _ref4.internalErrorBoxClass,\n      locale = _ref4.locale,\n      onTelemetry = _ref4.onTelemetry,\n      overrideLocalizedStrings = _ref4.overrideLocalizedStrings,\n      renderMarkdown = _ref4.renderMarkdown,\n      scrollToEndButtonMiddleware = _ref4.scrollToEndButtonMiddleware,\n      selectVoice = _ref4.selectVoice,\n      sendTimeout = _ref4.sendTimeout,\n      sendTypingIndicator = _ref4.sendTypingIndicator,\n      styleOptions = _ref4.styleOptions,\n      toastMiddleware = _ref4.toastMiddleware,\n      toastRenderer = _ref4.toastRenderer,\n      typingIndicatorMiddleware = _ref4.typingIndicatorMiddleware,\n      typingIndicatorRenderer = _ref4.typingIndicatorRenderer,\n      userID = _ref4.userID,\n      username = _ref4.username;\n  var dispatch = (0, _WebChatReduxContext.useDispatch)();\n  var telemetryDimensionsRef = (0, _react.useRef)({});\n  var patchedDir = (0, _react.useMemo)(function () {\n    return dir === 'ltr' || dir === 'rtl' ? dir : 'auto';\n  }, [dir]);\n  var patchedGrammars = (0, _react.useMemo)(function () {\n    return grammars || [];\n  }, [grammars]);\n  var patchedStyleOptions = (0, _react.useMemo)(function () {\n    return (0, _normalizeStyleOptions.default)((0, _patchStyleOptionsFromDeprecatedProps.default)(styleOptions, {\n      groupTimestamp: groupTimestamp,\n      sendTimeout: sendTimeout\n    }));\n  }, [groupTimestamp, sendTimeout, styleOptions]);\n  (0, _react.useEffect)(function () {\n    dispatch((0, _botframeworkWebchatCore.setLanguage)(locale));\n  }, [dispatch, locale]);\n  (0, _react.useEffect)(function () {\n    typeof sendTimeout === 'number' && dispatch((0, _botframeworkWebchatCore.setSendTimeout)(sendTimeout));\n  }, [dispatch, sendTimeout]);\n  (0, _react.useEffect)(function () {\n    dispatch((0, _botframeworkWebchatCore.setSendTypingIndicator)(!!sendTypingIndicator));\n  }, [dispatch, sendTypingIndicator]);\n  (0, _react.useEffect)(function () {\n    dispatch((0, _botframeworkWebchatCore.connect)({\n      directLine: directLine,\n      userID: userID,\n      username: username\n    }));\n    return function () {\n      /**\n       * @todo TODO: [P3] disconnect() is an async call (pending -> fulfilled), we need to wait, or change it to reconnect()\n       */\n      dispatch((0, _botframeworkWebchatCore.disconnect)());\n    };\n  }, [dispatch, directLine, userID, username]);\n  var markAllAsAcknowledged = (0, _useMarkAllAsAcknowledged.default)();\n  var cardActionContext = (0, _react.useMemo)(function () {\n    return createCardActionContext({\n      cardActionMiddleware: cardActionMiddleware,\n      directLine: directLine,\n      dispatch: dispatch,\n      markAllAsAcknowledged: markAllAsAcknowledged\n    });\n  }, [cardActionMiddleware, directLine, dispatch, markAllAsAcknowledged]);\n  var patchedSelectVoice = (0, _react.useMemo)(function () {\n    return selectVoice || _defaultSelectVoice.default.bind(null, {\n      language: locale\n    });\n  }, [locale, selectVoice]);\n  var groupActivitiesContext = (0, _react.useMemo)(function () {\n    return createGroupActivitiesContext({\n      groupActivitiesMiddleware: groupActivitiesMiddleware,\n      groupTimestamp: patchedStyleOptions.groupTimestamp\n    });\n  }, [groupActivitiesMiddleware, patchedStyleOptions.groupTimestamp]);\n  var hoistedDispatchers = (0, _react.useMemo)(function () {\n    return (0, _mapMap.default)(DISPATCHERS, function (dispatcher) {\n      return function () {\n        return dispatch(dispatcher.apply(void 0, arguments));\n      };\n    });\n  }, [dispatch]);\n  var patchedLocalizedStrings = (0, _react.useMemo)(function () {\n    return mergeStringsOverrides((0, _getAllLocalizedStrings.default)()[(0, _normalizeLanguage.default)(locale)], locale, overrideLocalizedStrings);\n  }, [locale, overrideLocalizedStrings]);\n  var localizedGlobalize = (0, _react.useMemo)(function () {\n    var _ref5 = patchedLocalizedStrings || {},\n        GLOBALIZE = _ref5.GLOBALIZE,\n        GLOBALIZE_LANGUAGE = _ref5.GLOBALIZE_LANGUAGE;\n\n    return GLOBALIZE || GLOBALIZE_LANGUAGE && (0, _PrecompiledGlobalize.default)(GLOBALIZE_LANGUAGE) || (0, _PrecompiledGlobalize.default)('en');\n  }, [patchedLocalizedStrings]);\n  var trackDimension = (0, _react.useCallback)(function (name, data) {\n    if (!name || typeof name !== 'string') {\n      return console.warn('botframework-webchat: Telemetry dimension name must be a string.');\n    }\n\n    var type = _typeof(data);\n\n    if (type !== 'string' && type !== 'undefined') {\n      return console.warn('botframework-webchat: Telemetry dimension data must be a string or undefined.');\n    }\n\n    telemetryDimensionsRef.current = (0, _simpleUpdateIn.default)(telemetryDimensionsRef.current, [name], type === 'undefined' ? data : function () {\n      return data;\n    });\n  }, [telemetryDimensionsRef]);\n  var patchedActivityRenderer = (0, _react.useMemo)(function () {\n    activityRenderer && console.warn('Web Chat: \"activityRenderer\" is deprecated and will be removed on 2022-06-15, please use \"activityMiddleware\" instead.');\n    return activityRenderer || _applyMiddleware.forRenderer.apply(void 0, ['activity', {\n      strict: false\n    }].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(activityMiddleware)), [function () {\n      return function () {\n        return function (_ref6) {\n          var activity = _ref6.activity;\n\n          if (activity) {\n            throw new Error(\"No renderer for activity of type \\\"\".concat(activity.type, \"\\\"\"));\n          } else {\n            throw new Error('No activity to render');\n          }\n        };\n      };\n    }]))({});\n  }, [activityMiddleware, activityRenderer]);\n  var patchedActivityStatusRenderer = (0, _react.useMemo)(function () {\n    activityStatusRenderer && console.warn('Web Chat: \"activityStatusRenderer\" is deprecated and will be removed on 2022-06-15, please use \"activityStatusMiddleware\" instead.');\n    return activityStatusRenderer || _applyMiddleware.forRenderer.apply(void 0, ['activity status', {\n      strict: false\n    }].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(activityStatusMiddleware)), [function () {\n      return function () {\n        return function () {\n          return false;\n        };\n      };\n    }]))({});\n  }, [activityStatusMiddleware, activityStatusRenderer]);\n  var patchedAttachmentForScreenReaderRenderer = (0, _react.useMemo)(function () {\n    return _applyMiddleware.forRenderer.apply(void 0, ['attachment for screen reader', {\n      strict: true\n    }].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(attachmentForScreenReaderMiddleware)), [function () {\n      return function () {\n        return function (_ref7) {\n          var attachment = _ref7.attachment;\n\n          if (attachment) {\n            console.warn(\"No renderer for attachment for screen reader of type \\\"\".concat(attachment.contentType, \"\\\"\"));\n            return false;\n          }\n\n          return function () {\n            /**\n             * @todo TODO: [P4] Might be able to throw without returning a function -- investigate and possibly fix\n             */\n            throw new Error('No attachment to render');\n          };\n        };\n      };\n    }]))({});\n  }, [attachmentForScreenReaderMiddleware]);\n  var patchedAttachmentRenderer = (0, _react.useMemo)(function () {\n    if (attachmentRenderer) {\n      console.warn('Web Chat: \"attachmentRenderer\" is deprecated and will be removed on 2022-06-15, please use \"attachmentMiddleware\" instead.');\n      return attachmentRenderer;\n    } // Attachment renderer\n\n\n    return _applyMiddleware.forLegacyRenderer.apply(void 0, ['attachment'].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(attachmentMiddleware)), [function () {\n      return function () {\n        return function (_ref8) {\n          var attachment = _ref8.attachment;\n\n          if (attachment) {\n            throw new Error(\"No renderer for attachment of type \\\"\".concat(attachment.contentType, \"\\\"\"));\n          } else {\n            throw new Error('No attachment to render');\n          }\n        };\n      };\n    }]))({});\n  }, [attachmentMiddleware, attachmentRenderer]);\n  var patchedAvatarRenderer = (0, _react.useMemo)(function () {\n    avatarRenderer && console.warn('Web Chat: \"avatarRenderer\" is deprecated and will be removed on 2022-06-15, please use \"avatarMiddleware\" instead.');\n    return avatarRenderer || _applyMiddleware.forRenderer.apply(void 0, ['avatar', {\n      strict: false\n    }].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(avatarMiddleware)), [function () {\n      return function () {\n        return function () {\n          return false;\n        };\n      };\n    }]))({});\n  }, [avatarMiddleware, avatarRenderer]);\n  var patchedToastRenderer = (0, _react.useMemo)(function () {\n    toastRenderer && console.warn('Web Chat: \"toastRenderer\" is deprecated and will be removed on 2022-06-15, please use \"toastMiddleware\" instead.');\n    return toastRenderer || _applyMiddleware.forRenderer.apply(void 0, ['toast', {\n      strict: false\n    }].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(toastMiddleware)), [function () {\n      return function () {\n        return function (_ref9) {\n          var notification = _ref9.notification;\n\n          if (notification) {\n            throw new Error(\"No renderer for notification of type \\\"\".concat(notification.contentType, \"\\\"\"));\n          } else {\n            throw new Error('No notification to render');\n          }\n        };\n      };\n    }]))({});\n  }, [toastMiddleware, toastRenderer]);\n  var patchedTypingIndicatorRenderer = (0, _react.useMemo)(function () {\n    typingIndicatorRenderer && console.warn('Web Chat: \"typingIndicatorRenderer\" is deprecated and will be removed on 2022-06-15, please use \"typingIndicatorMiddleware\" instead.');\n    return typingIndicatorRenderer || _applyMiddleware.forRenderer.apply(void 0, ['typing indicator', {\n      strict: false\n    }].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(typingIndicatorMiddleware)), [function () {\n      return function () {\n        return function () {\n          return false;\n        };\n      };\n    }]))({});\n  }, [typingIndicatorMiddleware, typingIndicatorRenderer]);\n  var scrollToEndButtonRenderer = (0, _react.useMemo)(function () {\n    return _applyMiddleware.forRenderer.apply(void 0, ['scroll to end button', {\n      strict: true\n    }].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(scrollToEndButtonMiddleware)), [function () {\n      return function () {\n        return function () {\n          return false;\n        };\n      };\n    }]))();\n  }, [scrollToEndButtonMiddleware]);\n  /**\n   * This is a heavy function, and it is expected to be only called when there is a need to recreate business logic, e.g.\n   * - User ID changed, causing all send* functions to be updated\n   * - send\n   * @todo TODO: [P3] We should think about if we allow the user to change onSendBoxValueChanged/sendBoxValue, e.g.\n   * 1. Turns text into UPPERCASE\n   * 2. Filter out profanity\n   * @todo TODO: [P4] Revisit all members of context\n   *       This context should consist of members that are not in the Redux store\n   *       i.e. members that are not interested in other types of UIs\n   */\n\n  var context = (0, _react.useMemo)(function () {\n    return _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, cardActionContext), groupActivitiesContext), hoistedDispatchers), {}, {\n      activityRenderer: patchedActivityRenderer,\n      activityStatusRenderer: patchedActivityStatusRenderer,\n      attachmentForScreenReaderRenderer: patchedAttachmentForScreenReaderRenderer,\n      attachmentRenderer: patchedAttachmentRenderer,\n      avatarRenderer: patchedAvatarRenderer,\n      dir: patchedDir,\n      directLine: directLine,\n      disabled: disabled,\n      downscaleImageToDataURL: downscaleImageToDataURL,\n      grammars: patchedGrammars,\n      internalErrorBoxClass: internalErrorBoxClass,\n      language: locale,\n      localizedGlobalizeState: [localizedGlobalize],\n      localizedStrings: patchedLocalizedStrings,\n      onTelemetry: onTelemetry,\n      renderMarkdown: renderMarkdown,\n      scrollToEndButtonRenderer: scrollToEndButtonRenderer,\n      selectVoice: patchedSelectVoice,\n      sendTypingIndicator: sendTypingIndicator,\n      styleOptions: patchedStyleOptions,\n      telemetryDimensionsRef: telemetryDimensionsRef,\n      toastRenderer: patchedToastRenderer,\n      trackDimension: trackDimension,\n      typingIndicatorRenderer: patchedTypingIndicatorRenderer,\n      userID: userID,\n      username: username\n    });\n  }, [cardActionContext, directLine, disabled, downscaleImageToDataURL, groupActivitiesContext, hoistedDispatchers, internalErrorBoxClass, locale, localizedGlobalize, onTelemetry, patchedActivityRenderer, patchedActivityStatusRenderer, patchedAttachmentForScreenReaderRenderer, patchedAttachmentRenderer, patchedAvatarRenderer, patchedDir, patchedGrammars, patchedLocalizedStrings, patchedSelectVoice, patchedStyleOptions, patchedToastRenderer, patchedTypingIndicatorRenderer, renderMarkdown, scrollToEndButtonRenderer, sendTypingIndicator, telemetryDimensionsRef, trackDimension, userID, username]);\n  return /*#__PURE__*/_react.default.createElement(_WebChatAPIContext.default.Provider, {\n    value: context\n  }, typeof children === 'function' ? children(context) : children, onTelemetry && /*#__PURE__*/_react.default.createElement(_Tracker.default, null));\n};\n/**\n * @todo TODO: [P3] We should consider moving some data from Redux store to props\n *       Although we use `connectToWebChat` to hide the details of accessor of Redux store,\n *       we should clean up the responsibility between Context and Redux store\n *       We should decide which data is needed for React but not in other environment such as CLI/VSCode\n */\n\n\nComposerCore.defaultProps = {\n  activityMiddleware: undefined,\n  activityRenderer: undefined,\n  activityStatusMiddleware: undefined,\n  activityStatusRenderer: undefined,\n  attachmentForScreenReaderMiddleware: undefined,\n  attachmentMiddleware: undefined,\n  attachmentRenderer: undefined,\n  avatarMiddleware: undefined,\n  avatarRenderer: undefined,\n  cardActionMiddleware: undefined,\n  children: undefined,\n  dir: 'auto',\n  disabled: false,\n  downscaleImageToDataURL: undefined,\n  grammars: [],\n  groupActivitiesMiddleware: undefined,\n  groupTimestamp: undefined,\n  internalErrorBoxClass: undefined,\n  locale: window.navigator.language || 'en-US',\n  onTelemetry: undefined,\n  overrideLocalizedStrings: undefined,\n  renderMarkdown: undefined,\n  scrollToEndButtonMiddleware: undefined,\n  selectVoice: undefined,\n  sendTimeout: undefined,\n  sendTypingIndicator: false,\n  styleOptions: {},\n  toastMiddleware: undefined,\n  toastRenderer: undefined,\n  typingIndicatorMiddleware: undefined,\n  typingIndicatorRenderer: undefined,\n  userID: '',\n  username: ''\n};\nComposerCore.propTypes = {\n  activityMiddleware: _propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.func), _propTypes.default.func]),\n  activityRenderer: _propTypes.default.func,\n  activityStatusMiddleware: _propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.func), _propTypes.default.func]),\n  activityStatusRenderer: _propTypes.default.func,\n  attachmentForScreenReaderMiddleware: _propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.func), _propTypes.default.func]),\n  attachmentMiddleware: _propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.func), _propTypes.default.func]),\n  attachmentRenderer: _propTypes.default.func,\n  avatarMiddleware: _propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.func), _propTypes.default.func]),\n  avatarRenderer: _propTypes.default.func,\n  cardActionMiddleware: _propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.func), _propTypes.default.func]),\n  children: _propTypes.default.any,\n  dir: _propTypes.default.oneOf(['auto', 'ltr', 'rtl']),\n  directLine: _propTypes.default.shape({\n    activity$: _propTypes.default.shape({\n      subscribe: _propTypes.default.func.isRequired\n    }).isRequired,\n    connectionStatus$: _propTypes.default.shape({\n      subscribe: _propTypes.default.func.isRequired\n    }).isRequired,\n    end: _propTypes.default.func,\n    getSessionId: _propTypes.default.func,\n    postActivity: _propTypes.default.func.isRequired,\n    referenceGrammarID: _propTypes.default.string,\n    token: _propTypes.default.string\n  }).isRequired,\n  disabled: _propTypes.default.bool,\n  downscaleImageToDataURL: _propTypes.default.func,\n  grammars: _propTypes.default.arrayOf(_propTypes.default.string),\n  groupActivitiesMiddleware: _propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.func), _propTypes.default.func]),\n  groupTimestamp: _propTypes.default.oneOfType([_propTypes.default.bool, _propTypes.default.number]),\n  internalErrorBoxClass: _propTypes.default.func,\n  // This is for internal use only. We don't allow customization of error box.\n  locale: _propTypes.default.string,\n  onTelemetry: _propTypes.default.func,\n  overrideLocalizedStrings: _propTypes.default.oneOfType([_propTypes.default.any, _propTypes.default.func]),\n  renderMarkdown: _propTypes.default.func,\n  scrollToEndButtonMiddleware: _propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.func), _propTypes.default.func]),\n  selectVoice: _propTypes.default.func,\n  sendTimeout: _propTypes.default.number,\n  sendTypingIndicator: _propTypes.default.bool,\n  styleOptions: _propTypes.default.any,\n  toastMiddleware: _propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.func), _propTypes.default.func]),\n  toastRenderer: _propTypes.default.func,\n  typingIndicatorMiddleware: _propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.func), _propTypes.default.func]),\n  typingIndicatorRenderer: _propTypes.default.func,\n  userID: _propTypes.default.string,\n  username: _propTypes.default.string\n}; // We will create a Redux store if it was not passed in\n\nvar Composer = function Composer(_ref10) {\n  var internalRenderErrorBox = _ref10.internalRenderErrorBox,\n      onTelemetry = _ref10.onTelemetry,\n      store = _ref10.store,\n      props = _objectWithoutProperties(_ref10, _excluded);\n\n  var _useState = (0, _react.useState)(),\n      _useState2 = _slicedToArray(_useState, 2),\n      error = _useState2[0],\n      setError = _useState2[1];\n\n  var handleError = (0, _react.useCallback)(function (error) {\n    console.error('botframework-webchat: Uncaught exception', {\n      error: error\n    });\n    onTelemetry && onTelemetry((0, _createCustomEvent.default)('exception', {\n      error: error,\n      fatal: true\n    }));\n    setError(error);\n  }, [onTelemetry, setError]);\n  var memoizedStore = (0, _react.useMemo)(function () {\n    return store || (0, _botframeworkWebchatCore.createStore)();\n  }, [store]);\n  return error ? !!internalRenderErrorBox && internalRenderErrorBox({\n    error: error,\n    type: 'uncaught exception'\n  }) : /*#__PURE__*/_react.default.createElement(_ErrorBoundary.default, {\n    onError: handleError\n  }, /*#__PURE__*/_react.default.createElement(_reactRedux.Provider, {\n    context: _WebChatReduxContext.default,\n    store: memoizedStore\n  }, /*#__PURE__*/_react.default.createElement(_ActivityKeyerComposer.default, null, /*#__PURE__*/_react.default.createElement(_ActivityAcknowledgementComposer.default, null, /*#__PURE__*/_react.default.createElement(ComposerCore, _extends({\n    onTelemetry: onTelemetry\n  }, props))))));\n};\n\nComposer.defaultProps = {\n  internalRenderErrorBox: undefined,\n  onTelemetry: undefined,\n  store: undefined\n};\nComposer.propTypes = {\n  internalRenderErrorBox: _propTypes.default.any,\n  onTelemetry: _propTypes.default.func,\n  store: _propTypes.default.any\n};\nvar _default = Composer;\nexports.default = _default;","map":{"version":3,"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA;;AAgCA;;AACA;;AACA;;AAOA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AAMA;;AAEA;;AACA;;AAEA;;AAOA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAEA;;;AACA,IAAMA,WAAW,GAAG;AAClBC,uBAAqB,EAArBA,8CADkB;AAElBC,qBAAmB,EAAnBA,4CAFkB;AAGlBC,qBAAmB,EAAnBA,4CAHkB;AAIlBC,cAAY,EAAZA,qCAJkB;AAKlBC,cAAY,EAAZA,qCALkB;AAMlBC,WAAS,EAATA,kCANkB;AAOlBC,WAAS,EAATA,kCAPkB;AAQlBC,aAAW,EAAXA,oCARkB;AASlBC,iBAAe,EAAfA,wCATkB;AAUlBC,cAAY,EAAZA,qCAVkB;AAWlBC,oBAAkB,EAAlBA,2CAXkB;AAYlBC,iBAAe,EAAfA,wCAZkB;AAalBC,iBAAe,EAAfA,wCAbkB;AAclBC,YAAU,EAAVA,mCAdkB;AAelBC,gBAAc,EAAdA,uCAfkB;AAgBlBC,cAAY,EAAZA,qCAhBkB;AAiBlBC,uBAAqB,EAArBA,8CAjBkB;AAkBlBC,aAAW,EAAXA,oCAlBkB;AAmBlBC,sBAAoB,EAApBA,6CAnBkB;AAoBlBC,eAAa,EAAbA;AApBkB,CAApB;;AAuBA,SAASC,uBAAT,OAAwG;AAAA,MAArEC,oBAAqE,QAArEA,oBAAqE;AAAA,MAA/CC,UAA+C,QAA/CA,UAA+C;AAAA,MAAnCC,QAAmC,QAAnCA,QAAmC;AAAA,MAAzBC,qBAAyB,QAAzBA,qBAAyB;;AACtG,MAAMC,aAAa,GAAGC,wCACpB,aADoBA,4BAEjB,4CAAcL,oBAAd,CAFiB,IAGpB,iDAHoB,IAIpB;AAAEE,YAAQ,EAARA;AAAF,GAJoBG,CAAtB;;AAMA,SAAO;AACLC,gBAAY,EAAE,sBAACC,UAAD,EAAmD;AAAA,sFAAP,EAAO;AAAA,UAApCC,MAAoC,SAApCA,MAAoC;;AAC/DL,2BAAqB;AAErB,aAAOC,aAAa,CAAC;AACnBG,kBAAU,EAAVA,UADmB;AAEnBE,oBAAY,EACVF,UAAU,CAACG,IAAXH,KAAoB,QAApBA,GACI,YAAM;AACJ,cAAQI,KAAR,GAAkBJ,UAAlB,CAAQI,KAAR;;AAEA,cAAIV,UAAU,CAACW,YAAf,EAA6B;AAC3B;AAClB;AACA;AACA;AACA;AACkB,mBAAO,kCAAoBX,UAAU,CAACW,YAAXX,EAApB,EAA+CY,IAA/C,CACL,qBAAS;AAAA,+BAAOF,KAAP,SAAeG,kBAAkB,2BAAoBC,SAApB,EAAjC;AADJ,cAAP;AAGD;;AAEDC,iBAAO,CAACC,IAARD,CAAa,2EAAbA;AAEA,iBAAOL,KAAP;AAjBN,YAmBI,IAtBa;AAuBnBH,cAAM,EAANA;AAvBmB,OAAD,CAApB;AAyBD;AA7BI,GAAP;AA+BD;;AAED,SAASU,4BAAT,QAAqF;AAAA,MAA7CC,yBAA6C,SAA7CA,yBAA6C;AAAA,MAAlBC,cAAkB,SAAlBA,cAAkB;;AACnF,MAAMhB,aAAa,GAAGC,wCACpB,kBADoBA,4BAEjB,4CAAcc,yBAAd,CAFiB,IAGpB,qDAAuC;AAAEC,kBAAc,EAAdA;AAAF,GAAvC,CAHoB,GAAtB;;AAMA,SAAO;AACLC,mBAAe,EAAEjB,aAAa,CAAC,EAAD;AADzB,GAAP;AAGD;;AAED,SAASkB,qBAAT,CAA+BC,gBAA/B,EAAiDC,QAAjD,EAA2DC,wBAA3D,EAAqF;AACnF,MAAI,CAACA,wBAAL,EAA+B;AAC7B,WAAOF,gBAAP;AADF,SAEO,IAAI,OAAOE,wBAAP,KAAoC,UAAxC,EAAoD;AACzD,QAAMC,MAAM,GAAGD,wBAAwB,CAACF,gBAAD,EAAmBC,QAAnB,CAAvC;;AAEA,QAAI,CAAC,uBAASE,MAAT,CAAL,EAAuB;AACrB,YAAM,IAAIC,KAAJ,CAAU,gFAAV,CAAN;AACD;;AAED,WAAOD,MAAP;AACD;;AAED,MAAI,CAAC,uBAASD,wBAAT,CAAL,EAAyC;AACvC,UAAM,IAAIE,KAAJ,CAAU,gGAAV,CAAN;AACD;;AAED,yCAAYJ,gBAAZ,GAAiCE,wBAAjC;EAGF;AACA;AACA;AACA;;AAEA;;AA8CA;;;AAEA,IAAMG,YAAmC,GAAG,SAAtCA,YAAsC,QAmCtC;AAAA,MAlCJC,kBAkCI,SAlCJA,kBAkCI;AAAA,MAjCJC,gBAiCI,SAjCJA,gBAiCI;AAAA,MAhCJC,wBAgCI,SAhCJA,wBAgCI;AAAA,MA/BJC,sBA+BI,SA/BJA,sBA+BI;AAAA,MA9BJC,oBA8BI,SA9BJA,oBA8BI;AAAA,MA7BJC,mCA6BI,SA7BJA,mCA6BI;AAAA,MA5BJC,kBA4BI,SA5BJA,kBA4BI;AAAA,MA3BJC,gBA2BI,SA3BJA,gBA2BI;AAAA,MA1BJC,cA0BI,SA1BJA,cA0BI;AAAA,MAzBJrC,oBAyBI,SAzBJA,oBAyBI;AAAA,MAxBJsC,QAwBI,SAxBJA,QAwBI;AAAA,MAvBJC,GAuBI,SAvBJA,GAuBI;AAAA,MAtBJtC,UAsBI,SAtBJA,UAsBI;AAAA,MArBJuC,QAqBI,SArBJA,QAqBI;AAAA,MApBJC,uBAoBI,SApBJA,uBAoBI;AAAA,MAnBJC,QAmBI,SAnBJA,QAmBI;AAAA,MAlBJvB,yBAkBI,SAlBJA,yBAkBI;AAAA,MAjBJC,cAiBI,SAjBJA,cAiBI;AAAA,MAhBJuB,qBAgBI,SAhBJA,qBAgBI;AAAA,MAfJC,MAeI,SAfJA,MAeI;AAAA,MAdJC,WAcI,SAdJA,WAcI;AAAA,MAbJpB,wBAaI,SAbJA,wBAaI;AAAA,MAZJqB,cAYI,SAZJA,cAYI;AAAA,MAXJC,2BAWI,SAXJA,2BAWI;AAAA,MAVJC,WAUI,SAVJA,WAUI;AAAA,MATJC,WASI,SATJA,WASI;AAAA,MARJC,mBAQI,SARJA,mBAQI;AAAA,MAPJC,YAOI,SAPJA,YAOI;AAAA,MANJC,eAMI,SANJA,eAMI;AAAA,MALJC,aAKI,SALJA,aAKI;AAAA,MAJJC,yBAII,SAJJA,yBAII;AAAA,MAHJC,uBAGI,SAHJA,uBAGI;AAAA,MAFJC,MAEI,SAFJA,MAEI;AAAA,MADJC,QACI,SADJA,QACI;AACJ,MAAMvD,QAAQ,GAAG,uCAAjB;AACA,MAAMwD,sBAAsB,GAAG,mBAAO,EAAP,CAA/B;AAEA,MAAMC,UAAU,GAAG,oBAAQ;AAAA,WAAOpB,GAAG,KAAK,KAARA,IAAiBA,GAAG,KAAK,KAAzBA,GAAiCA,GAAjCA,GAAuC,MAA9C;AAAR,KAA+D,CAACA,GAAD,CAA/D,CAAnB;AACA,MAAMqB,eAAe,GAAG,oBAAQ;AAAA,WAAMlB,QAAQ,IAAI,EAAlB;AAAR,KAA8B,CAACA,QAAD,CAA9B,CAAxB;AACA,MAAMmB,mBAAmB,GAAG,oBAC1B;AAAA,WAAM,oCAAsB,mDAAqCV,YAArC,EAAmD;AAAE/B,oBAAc,EAAdA,cAAF;AAAkB6B,iBAAW,EAAXA;AAAlB,KAAnD,CAAtB,CAAN;AAD0B,KAE1B,CAAC7B,cAAD,EAAiB6B,WAAjB,EAA8BE,YAA9B,CAF0B,CAA5B;AAKA,wBAAU,YAAM;AACdjD,YAAQ,CAAC,0CAAY0C,MAAZ,CAAD,CAAR1C;AADF,KAEG,CAACA,QAAD,EAAW0C,MAAX,CAFH;AAIA,wBAAU,YAAM;AACd,WAAOK,WAAP,KAAuB,QAAvB,IAAmC/C,QAAQ,CAAC,6CAAe+C,WAAf,CAAD,CAA3C;AADF,KAEG,CAAC/C,QAAD,EAAW+C,WAAX,CAFH;AAIA,wBAAU,YAAM;AACd/C,YAAQ,CAAC,qDAAuB,CAAC,CAACgD,mBAAzB,CAAD,CAARhD;AADF,KAEG,CAACA,QAAD,EAAWgD,mBAAX,CAFH;AAIA,wBAAU,YAAM;AACdhD,YAAQ,CACN,sCAAoB;AAClBD,gBAAU,EAAVA,UADkB;AAElBuD,YAAM,EAANA,MAFkB;AAGlBC,cAAQ,EAARA;AAHkB,KAApB,CADM,CAARvD;AAQA,WAAO,YAAM;AACX;AACN;AACA;AACMA,cAAQ,CAAC,0CAAD,CAARA;AAJF;AATF,KAeG,CAACA,QAAD,EAAWD,UAAX,EAAuBuD,MAAvB,EAA+BC,QAA/B,CAfH;AAiBA,MAAMtD,qBAAqB,GAAG,wCAA9B;AAEA,MAAM2D,iBAAiB,GAAG,oBACxB;AAAA,WAAM/D,uBAAuB,CAAC;AAAEC,0BAAoB,EAApBA,oBAAF;AAAwBC,gBAAU,EAAVA,UAAxB;AAAoCC,cAAQ,EAARA,QAApC;AAA8CC,2BAAqB,EAArBA;AAA9C,KAAD,CAA7B;AADwB,KAExB,CAACH,oBAAD,EAAuBC,UAAvB,EAAmCC,QAAnC,EAA6CC,qBAA7C,CAFwB,CAA1B;AAKA,MAAM4D,kBAAkB,GAAG,oBACzB;AAAA,WAAMf,WAAW,IAAIgB,4BAAmBC,IAAnBD,CAAwB,IAAxBA,EAA8B;AAAExC,cAAQ,EAAEoB;AAAZ,KAA9BoB,CAArB;AADyB,KAEzB,CAACpB,MAAD,EAASI,WAAT,CAFyB,CAA3B;AAKA,MAAMkB,sBAAsB,GAAG,oBAC7B;AAAA,WACEhD,4BAA4B,CAAC;AAC3BC,+BAAyB,EAAzBA,yBAD2B;AAE3BC,oBAAc,EAAEyC,mBAAmB,CAACzC;AAFT,KAAD,CAD9B;AAD6B,KAM7B,CAACD,yBAAD,EAA4B0C,mBAAmB,CAACzC,cAAhD,CAN6B,CAA/B;AASA,MAAM+C,kBAAkB,GAAG,oBACzB;AAAA,WACE,qBACEzF,WADF,EAEE,sBAAU;AAAA,aACR;AAAA,eACEwB,QAAQ,CAACkE,UAAU,MAAVA,mBAAD,CADV;AADQ;AAFZ,MADF;AADyB,KAQzB,CAAClE,QAAD,CARyB,CAA3B;AAWA,MAAMmE,uBAAuB,GAAG,oBAC9B;AAAA,WAAM/C,qBAAqB,CAAC,uCAAyB,gCAAkBsB,MAAlB,CAAzB,CAAD,EAAsDA,MAAtD,EAA8DnB,wBAA9D,CAA3B;AAD8B,KAE9B,CAACmB,MAAD,EAASnB,wBAAT,CAF8B,CAAhC;AAKA,MAAM6C,kBAAkB,GAAG,oBAAkC,YAAM;AACjE,gBAA0CD,uBAAuB,IAAI,EAArE;AAAA,QAAQE,SAAR,SAAQA,SAAR;AAAA,QAAmBC,kBAAnB,SAAmBA,kBAAnB;;AAEA,WAAOD,SAAS,IAAKC,kBAAkB,IAAI,mCAAqBA,kBAArB,CAApCD,IAAiF,mCAAqB,IAArB,CAAxF;AAHyB,KAIxB,CAACF,uBAAD,CAJwB,CAA3B;AAMA,MAAMI,cAAc,GAAG,wBACrB,UAACC,IAAD,EAAeC,IAAf,EAA6B;AAC3B,QAAI,CAACD,IAAD,IAAS,OAAOA,IAAP,KAAgB,QAA7B,EAAuC;AACrC,aAAO1D,OAAO,CAACC,IAARD,CAAa,kEAAbA,CAAP;AACD;;AAED,QAAMN,IAAI,WAAUiE,IAAV,CAAV;;AAEA,QAAIjE,IAAI,KAAK,QAATA,IAAqBA,IAAI,KAAK,WAAlC,EAA+C;AAC7C,aAAOM,OAAO,CAACC,IAARD,CAAa,+EAAbA,CAAP;AACD;;AAED0C,0BAAsB,CAACkB,OAAvBlB,GAAiC,6BAC/BA,sBAAsB,CAACkB,OADQ,EAE/B,CAACF,IAAD,CAF+B,EAG/BhE,IAAI,KAAK,WAATA,GAAuBiE,IAAvBjE,GAA8B;AAAA,aAAMiE,IAAN;AAHC,MAAjCjB;AAZmB,KAkBrB,CAACA,sBAAD,CAlBqB,CAAvB;AAqBA,MAAMmB,uBAAuB,GAAG,oBAAQ,YAAM;AAC5C/C,oBAAgB,IACdd,OAAO,CAACC,IAARD,CACE,wHADFA,CADFc;AAKA,WACEA,gBAAgB,IAChBgD,4CACE,UADFA,EAEE;AAAEC,YAAM,EAAE;AAAV,KAFFD,4BAGK,4CAAcjD,kBAAd,CAHL,IAIE;AAAA,aACE;AAAA,eACA,iBAAkB;AAAA,cAAfmD,QAAe,SAAfA,QAAe;;AAChB,cAAIA,QAAJ,EAAc;AACZ,kBAAM,IAAIrD,KAAJ,8CAA+CqD,QAAQ,CAACtE,IAAxD,QAAN;AADF,iBAEO;AACL,kBAAM,IAAIiB,KAAJ,CAAU,uBAAV,CAAN;AACD;AANH;AADF;AAJF,SAaE,EAbFmD,CAFF;AAN8B,KAuB7B,CAACjD,kBAAD,EAAqBC,gBAArB,CAvB6B,CAAhC;AAyBA,MAAMmD,6BAA6B,GAAG,oBAAQ,YAAM;AAClDjD,0BAAsB,IACpBhB,OAAO,CAACC,IAARD,CACE,oIADFA,CADFgB;AAKA,WACEA,sBAAsB,IACtB8C,4CACE,iBADFA,EAEE;AAAEC,YAAM,EAAE;AAAV,KAFFD,4BAGK,4CAAc/C,wBAAd,CAHL,IAIE;AAAA,aAAM;AAAA,eAAM;AAAA,iBAAM,KAAN;AAAN;AAAN;AAJF,SAKE,EALF+C,CAFF;AANoC,KAenC,CAAC/C,wBAAD,EAA2BC,sBAA3B,CAfmC,CAAtC;AAiBA,MAAMkD,wCAAwC,GAAG,oBAC/C;AAAA,WACEJ,4CACE,8BADFA,EAEE;AAAEC,YAAM,EAAE;AAAV,KAFFD,4BAGK,4CAAc5C,mCAAd,CAHL,IAIE;AAAA,aACE;AAAA,eACA,iBAAoB;AAAA,cAAjBiD,UAAiB,SAAjBA,UAAiB;;AAClB,cAAIA,UAAJ,EAAgB;AACdnE,mBAAO,CAACC,IAARD,kEAAsEmE,UAAU,CAACC,WAAjF;AACA,mBAAO,KAAP;AACD;;AAED,iBAAO,YAAM;AACX;AACd;AACA;AACc,kBAAM,IAAIzD,KAAJ,CAAU,yBAAV,CAAN;AAJF;AAPF;AADF;AAJF,SAmBE,EAnBFmD,CADF;AAD+C,KAsB/C,CAAC5C,mCAAD,CAtB+C,CAAjD;AAyBA,MAAMmD,yBAAyB,GAAG,oBAAQ,YAAM;AAC9C,QAAIlD,kBAAJ,EAAwB;AACtBnB,aAAO,CAACC,IAARD,CACE,4HADFA;AAIA,aAAOmB,kBAAP;AAN4C,MAS9C;;;AACA,WAAOmD,kDACL,YADKA,4BAEF,4CAAcrD,oBAAd,CAFE,IAGL;AAAA,aACE;AAAA,eACA,iBAAoB;AAAA,cAAjBkD,UAAiB,SAAjBA,UAAiB;;AAClB,cAAIA,UAAJ,EAAgB;AACd,kBAAM,IAAIxD,KAAJ,gDAAiDwD,UAAU,CAACC,WAA5D,QAAN;AADF,iBAEO;AACL,kBAAM,IAAIzD,KAAJ,CAAU,yBAAV,CAAN;AACD;AANH;AADF;AAHK,SAYL,EAZK2D,CAAP;AAVgC,KAuB/B,CAACrD,oBAAD,EAAuBE,kBAAvB,CAvB+B,CAAlC;AAyBA,MAAMoD,qBAAqB,GAAG,oBAAQ,YAAM;AAC1ClD,kBAAc,IACZrB,OAAO,CAACC,IAARD,CACE,oHADFA,CADFqB;AAKA,WACEA,cAAc,IACdyC,4CACE,QADFA,EAEE;AAAEC,YAAM,EAAE;AAAV,KAFFD,4BAGK,4CAAc1C,gBAAd,CAHL,IAIE;AAAA,aAAM;AAAA,eAAM;AAAA,iBAAM,KAAN;AAAN;AAAN;AAJF,SAKE,EALF0C,CAFF;AAN4B,KAe3B,CAAC1C,gBAAD,EAAmBC,cAAnB,CAf2B,CAA9B;AAiBA,MAAMmD,oBAAoB,GAAG,oBAAQ,YAAM;AACzCnC,iBAAa,IACXrC,OAAO,CAACC,IAARD,CACE,kHADFA,CADFqC;AAKA,WACEA,aAAa,IACbyB,4CACE,OADFA,EAEE;AAAEC,YAAM,EAAE;AAAV,KAFFD,4BAGK,4CAAc1B,eAAd,CAHL,IAIE;AAAA,aACE;AAAA,eACA,iBAAsB;AAAA,cAAnBqC,YAAmB,SAAnBA,YAAmB;;AACpB,cAAIA,YAAJ,EAAkB;AAChB,kBAAM,IAAI9D,KAAJ,kDAAmD8D,YAAY,CAACL,WAAhE,QAAN;AADF,iBAEO;AACL,kBAAM,IAAIzD,KAAJ,CAAU,2BAAV,CAAN;AACD;AANH;AADF;AAJF,SAaE,EAbFmD,CAFF;AAN2B,KAuB1B,CAAC1B,eAAD,EAAkBC,aAAlB,CAvB0B,CAA7B;AAyBA,MAAMqC,8BAA8B,GAAG,oBAAQ,YAAM;AACnDnC,2BAAuB,IACrBvC,OAAO,CAACC,IAARD,CACE,sIADFA,CADFuC;AAKA,WACEA,uBAAuB,IACvBuB,4CACE,kBADFA,EAEE;AAAEC,YAAM,EAAE;AAAV,KAFFD,4BAGK,4CAAcxB,yBAAd,CAHL,IAIE;AAAA,aAAM;AAAA,eAAM;AAAA,iBAAM,KAAN;AAAN;AAAN;AAJF,SAKE,EALFwB,CAFF;AANqC,KAepC,CAACxB,yBAAD,EAA4BC,uBAA5B,CAfoC,CAAvC;AAiBA,MAAMoC,yBAA4D,GAAG,oBACnE;AAAA,WACEb,4CACE,sBADFA,EAEE;AAAEC,YAAM,EAAE;AAAV,KAFFD,4BAGK,4CAAc/B,2BAAd,CAHL,IAIE;AAAA,aAAM;AAAA,eAAM;AAAA,iBAAM,KAAN;AAAN;AAAN;AAJF,UADF;AADmE,KAQnE,CAACA,2BAAD,CARmE,CAArE;AAWA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACE,MAAM6C,OAAO,GAAG,oBACd;AAAA,uEACK9B,iBADL,GAEKI,sBAFL,GAGKC,kBAHL;AAIErC,sBAAgB,EAAE+C,uBAJpB;AAKE7C,4BAAsB,EAAEiD,6BAL1B;AAMEY,uCAAiC,EAAEX,wCANrC;AAOE/C,wBAAkB,EAAEkD,yBAPtB;AAQEhD,oBAAc,EAAEkD,qBARlB;AASEhD,SAAG,EAAEoB,UATP;AAUE1D,gBAAU,EAAVA,UAVF;AAWEuC,cAAQ,EAARA,QAXF;AAYEC,6BAAuB,EAAvBA,uBAZF;AAaEC,cAAQ,EAAEkB,eAbZ;AAcEjB,2BAAqB,EAArBA,qBAdF;AAeEnB,cAAQ,EAAEoB,MAfZ;AAgBEkD,6BAAuB,EAAE,CAACxB,kBAAD,CAhB3B;AAiBE/C,sBAAgB,EAAE8C,uBAjBpB;AAkBExB,iBAAW,EAAXA,WAlBF;AAmBEC,oBAAc,EAAdA,cAnBF;AAoBE6C,+BAAyB,EAAzBA,yBApBF;AAqBE3C,iBAAW,EAAEe,kBArBf;AAsBEb,yBAAmB,EAAnBA,mBAtBF;AAuBEC,kBAAY,EAAEU,mBAvBhB;AAwBEH,4BAAsB,EAAtBA,sBAxBF;AAyBEL,mBAAa,EAAEmC,oBAzBjB;AA0BEf,oBAAc,EAAdA,cA1BF;AA2BElB,6BAAuB,EAAEmC,8BA3B3B;AA4BElC,YAAM,EAANA,MA5BF;AA6BEC,cAAQ,EAARA;AA7BF;AADc,KAgCd,CACEK,iBADF,EAEE7D,UAFF,EAGEuC,QAHF,EAIEC,uBAJF,EAKEyB,sBALF,EAMEC,kBANF,EAOExB,qBAPF,EAQEC,MARF,EASE0B,kBATF,EAUEzB,WAVF,EAWEgC,uBAXF,EAYEI,6BAZF,EAaEC,wCAbF,EAcEG,yBAdF,EAeEE,qBAfF,EAgBE5B,UAhBF,EAiBEC,eAjBF,EAkBES,uBAlBF,EAmBEN,kBAnBF,EAoBEF,mBApBF,EAqBE2B,oBArBF,EAsBEE,8BAtBF,EAuBE5C,cAvBF,EAwBE6C,yBAxBF,EAyBEzC,mBAzBF,EA0BEQ,sBA1BF,EA2BEe,cA3BF,EA4BEjB,MA5BF,EA6BEC,QA7BF,CAhCc,CAAhB;AAiEA,sBACEsC,6BAACC,2BAAkBC,QAAnB;AAA4BtF,SAAK,EAAEiF;AAAnC,KACG,OAAOtD,QAAP,KAAoB,UAApB,GAAiCA,QAAQ,CAACsD,OAAD,CAAzC,GAAqDtD,QADxD,EAEGO,WAAW,iBAAIkD,6BAACG,gBAAD,OAFlB,CADF;AAzXF;AAiYA;AACA;AACA;AACA;AACA;AACA;;;AACAtE,YAAY,CAACuE,YAAbvE,GAA4B;AAC1BC,oBAAkB,EAAEuE,SADM;AAE1BtE,kBAAgB,EAAEsE,SAFQ;AAG1BrE,0BAAwB,EAAEqE,SAHA;AAI1BpE,wBAAsB,EAAEoE,SAJE;AAK1BlE,qCAAmC,EAAEkE,SALX;AAM1BnE,sBAAoB,EAAEmE,SANI;AAO1BjE,oBAAkB,EAAEiE,SAPM;AAQ1BhE,kBAAgB,EAAEgE,SARQ;AAS1B/D,gBAAc,EAAE+D,SATU;AAU1BpG,sBAAoB,EAAEoG,SAVI;AAW1B9D,UAAQ,EAAE8D,SAXgB;AAY1B7D,KAAG,EAAE,MAZqB;AAa1BC,UAAQ,EAAE,KAbgB;AAc1BC,yBAAuB,EAAE2D,SAdC;AAe1B1D,UAAQ,EAAE,EAfgB;AAgB1BvB,2BAAyB,EAAEiF,SAhBD;AAiB1BhF,gBAAc,EAAEgF,SAjBU;AAkB1BzD,uBAAqB,EAAEyD,SAlBG;AAmB1BxD,QAAM,EAAEyD,MAAM,CAACC,SAAPD,CAAiB7E,QAAjB6E,IAA6B,OAnBX;AAoB1BxD,aAAW,EAAEuD,SApBa;AAqB1B3E,0BAAwB,EAAE2E,SArBA;AAsB1BtD,gBAAc,EAAEsD,SAtBU;AAuB1BrD,6BAA2B,EAAEqD,SAvBH;AAwB1BpD,aAAW,EAAEoD,SAxBa;AAyB1BnD,aAAW,EAAEmD,SAzBa;AA0B1BlD,qBAAmB,EAAE,KA1BK;AA2B1BC,cAAY,EAAE,EA3BY;AA4B1BC,iBAAe,EAAEgD,SA5BS;AA6B1B/C,eAAa,EAAE+C,SA7BW;AA8B1B9C,2BAAyB,EAAE8C,SA9BD;AA+B1B7C,yBAAuB,EAAE6C,SA/BC;AAgC1B5C,QAAM,EAAE,EAhCkB;AAiC1BC,UAAQ,EAAE;AAjCgB,CAA5B7B;AAoCAA,YAAY,CAAC2E,SAAb3E,GAAyB;AACvBC,oBAAkB,EAAE2E,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUE,OAAVF,CAAkBA,mBAAUG,IAA5BH,CAAD,EAAoCA,mBAAUG,IAA9C,CAApBH,CADG;AAEvB1E,kBAAgB,EAAE0E,mBAAUG,IAFL;AAGvB5E,0BAAwB,EAAEyE,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUE,OAAVF,CAAkBA,mBAAUG,IAA5BH,CAAD,EAAoCA,mBAAUG,IAA9C,CAApBH,CAHH;AAIvBxE,wBAAsB,EAAEwE,mBAAUG,IAJX;AAKvBzE,qCAAmC,EAAEsE,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUE,OAAVF,CAAkBA,mBAAUG,IAA5BH,CAAD,EAAoCA,mBAAUG,IAA9C,CAApBH,CALd;AAMvBvE,sBAAoB,EAAEuE,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUE,OAAVF,CAAkBA,mBAAUG,IAA5BH,CAAD,EAAoCA,mBAAUG,IAA9C,CAApBH,CANC;AAOvBrE,oBAAkB,EAAEqE,mBAAUG,IAPP;AAQvBvE,kBAAgB,EAAEoE,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUE,OAAVF,CAAkBA,mBAAUG,IAA5BH,CAAD,EAAoCA,mBAAUG,IAA9C,CAApBH,CARK;AASvBnE,gBAAc,EAAEmE,mBAAUG,IATH;AAUvB3G,sBAAoB,EAAEwG,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUE,OAAVF,CAAkBA,mBAAUG,IAA5BH,CAAD,EAAoCA,mBAAUG,IAA9C,CAApBH,CAVC;AAWvBlE,UAAQ,EAAEkE,mBAAUI,GAXG;AAYvBrE,KAAG,EAAEiE,mBAAUK,KAAVL,CAAgB,CAAC,MAAD,EAAS,KAAT,EAAgB,KAAhB,CAAhBA,CAZkB;AAavBvG,YAAU,EAAEuG,mBAAUM,KAAVN,CAAgB;AAC1BO,aAAS,EAAEP,mBAAUM,KAAVN,CAAgB;AACzBQ,eAAS,EAAER,mBAAUG,IAAVH,CAAeS;AADD,KAAhBT,EAERS,UAHuB;AAI1BC,qBAAiB,EAAEV,mBAAUM,KAAVN,CAAgB;AACjCQ,eAAS,EAAER,mBAAUG,IAAVH,CAAeS;AADO,KAAhBT,EAEhBS,UANuB;AAO1BE,OAAG,EAAEX,mBAAUG,IAPW;AAQ1B/F,gBAAY,EAAE4F,mBAAUG,IARE;AAS1B5H,gBAAY,EAAEyH,mBAAUG,IAAVH,CAAeS,UATH;AAU1BG,sBAAkB,EAAEZ,mBAAUa,MAVJ;AAW1BC,SAAK,EAAEd,mBAAUa;AAXS,GAAhBb,EAYTS,UAzBoB;AA0BvBzE,UAAQ,EAAEgE,mBAAUe,IA1BG;AA2BvB9E,yBAAuB,EAAE+D,mBAAUG,IA3BZ;AA4BvBjE,UAAQ,EAAE8D,mBAAUE,OAAVF,CAAkBA,mBAAUa,MAA5Bb,CA5Ba;AA6BvBrF,2BAAyB,EAAEqF,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUE,OAAVF,CAAkBA,mBAAUG,IAA5BH,CAAD,EAAoCA,mBAAUG,IAA9C,CAApBH,CA7BJ;AA8BvBpF,gBAAc,EAAEoF,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUe,IAAX,EAAiBf,mBAAUgB,MAA3B,CAApBhB,CA9BO;AA+BvB7D,uBAAqB,EAAE6D,mBAAUG,IA/BV;AA+BgB;AACvC/D,QAAM,EAAE4D,mBAAUa,MAhCK;AAiCvBxE,aAAW,EAAE2D,mBAAUG,IAjCA;AAkCvBlF,0BAAwB,EAAE+E,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUI,GAAX,EAAgBJ,mBAAUG,IAA1B,CAApBH,CAlCH;AAmCvB1D,gBAAc,EAAE0D,mBAAUG,IAnCH;AAoCvB5D,6BAA2B,EAAEyD,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUE,OAAVF,CAAkBA,mBAAUG,IAA5BH,CAAD,EAAoCA,mBAAUG,IAA9C,CAApBH,CApCN;AAqCvBxD,aAAW,EAAEwD,mBAAUG,IArCA;AAsCvB1D,aAAW,EAAEuD,mBAAUgB,MAtCA;AAuCvBtE,qBAAmB,EAAEsD,mBAAUe,IAvCR;AAwCvBpE,cAAY,EAAEqD,mBAAUI,GAxCD;AAyCvBxD,iBAAe,EAAEoD,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUE,OAAVF,CAAkBA,mBAAUG,IAA5BH,CAAD,EAAoCA,mBAAUG,IAA9C,CAApBH,CAzCM;AA0CvBnD,eAAa,EAAEmD,mBAAUG,IA1CF;AA2CvBrD,2BAAyB,EAAEkD,mBAAUC,SAAVD,CAAoB,CAACA,mBAAUE,OAAVF,CAAkBA,mBAAUG,IAA5BH,CAAD,EAAoCA,mBAAUG,IAA9C,CAApBH,CA3CJ;AA4CvBjD,yBAAuB,EAAEiD,mBAAUG,IA5CZ;AA6CvBnD,QAAM,EAAEgD,mBAAUa,MA7CK;AA8CvB5D,UAAQ,EAAE+C,mBAAUa;AA9CG,CAAzBzF,C,CAsDA;;AACA,IAAM6F,QAA2B,GAAG,SAA9BA,QAA8B,SAA8D;AAAA,MAA3DC,sBAA2D,UAA3DA,sBAA2D;AAAA,MAAnC7E,WAAmC,UAAnCA,WAAmC;AAAA,MAAtB8E,KAAsB,UAAtBA,KAAsB;AAAA,MAAZC,KAAY;;AAChG,kBAA0B,sBAA1B;AAAA;AAAA,MAAOC,KAAP;AAAA,MAAcC,QAAd;;AAEA,MAAMC,WAAW,GAAG,wBAClB,iBAAS;AACP/G,WAAO,CAAC6G,KAAR7G,CAAc,0CAAdA,EAA0D;AAAE6G,WAAK,EAALA;AAAF,KAA1D7G;AAEA6B,eAAW,IACTA,WAAW,CAAC,gCAAkB,WAAlB,EAA+B;AAAEgF,WAAK,EAALA,KAAF;AAASG,WAAK,EAAE;AAAhB,KAA/B,CAAD,CADbnF;AAEAiF,YAAQ,CAACD,KAAD,CAARC;AANgB,KAQlB,CAACjF,WAAD,EAAciF,QAAd,CARkB,CAApB;AAWA,MAAMG,aAAa,GAAG,oBAAQ;AAAA,WAAMN,KAAK,IAAI,2CAAf;AAAR,KAAsC,CAACA,KAAD,CAAtC,CAAtB;AAEA,SAAOE,KAAK,GACV,CAAC,CAACH,sBAAF,IAA4BA,sBAAsB,CAAC;AAAEG,SAAK,EAALA,KAAF;AAASnH,QAAI,EAAE;AAAf,GAAD,CADxC,gBAGVqF,6BAACmC,sBAAD;AAAeC,WAAO,EAAEJ;AAAxB,kBACEhC,6BAACqC,oBAAD;AAAUxC,WAAO,EAAEyC,4BAAnB;AAAwCV,SAAK,EAAEM;AAA/C,kBACElC,6BAACuC,8BAAD,qBACEvC,6BAACwC,wCAAD,qBACExC,6BAACnE,YAAD;AAAciB,eAAW,EAAEA;AAA3B,KAA4C+E,KAA5C,EADF,CADF,CADF,CADF,CAHF;AAhBF;;AA+BAH,QAAQ,CAACtB,YAATsB,GAAwB;AACtBC,wBAAsB,EAAEtB,SADF;AAEtBvD,aAAW,EAAEuD,SAFS;AAGtBuB,OAAK,EAAEvB;AAHe,CAAxBqB;AAMAA,QAAQ,CAAClB,SAATkB,GAAqB;AACnBC,wBAAsB,EAAElB,mBAAUI,GADf;AAEnB/D,aAAW,EAAE2D,mBAAUG,IAFJ;AAGnBgB,OAAK,EAAEnB,mBAAUI;AAHE,CAArBa;eAMeA","names":["DISPATCHERS","clearSuggestedActions","dismissNotification","emitTypingIndicator","markActivity","postActivity","sendEvent","sendFiles","sendMessage","sendMessageBack","sendPostBack","setDictateInterims","setDictateState","setNotification","setSendBox","setSendTimeout","startDictate","startSpeakingActivity","stopDictate","stopSpeakingActivity","submitSendBox","createCardActionContext","cardActionMiddleware","directLine","dispatch","markAllAsAcknowledged","runMiddleware","applyMiddleware","onCardAction","cardAction","target","getSignInUrl","type","value","getSessionId","then","encodeURIComponent","sessionId","console","warn","createGroupActivitiesContext","groupActivitiesMiddleware","groupTimestamp","groupActivities","mergeStringsOverrides","localizedStrings","language","overrideLocalizedStrings","merged","Error","ComposerCore","activityMiddleware","activityRenderer","activityStatusMiddleware","activityStatusRenderer","attachmentMiddleware","attachmentForScreenReaderMiddleware","attachmentRenderer","avatarMiddleware","avatarRenderer","children","dir","disabled","downscaleImageToDataURL","grammars","internalErrorBoxClass","locale","onTelemetry","renderMarkdown","scrollToEndButtonMiddleware","selectVoice","sendTimeout","sendTypingIndicator","styleOptions","toastMiddleware","toastRenderer","typingIndicatorMiddleware","typingIndicatorRenderer","userID","username","telemetryDimensionsRef","patchedDir","patchedGrammars","patchedStyleOptions","cardActionContext","patchedSelectVoice","defaultSelectVoice","bind","groupActivitiesContext","hoistedDispatchers","dispatcher","patchedLocalizedStrings","localizedGlobalize","GLOBALIZE","GLOBALIZE_LANGUAGE","trackDimension","name","data","current","patchedActivityRenderer","applyMiddlewareForRenderer","strict","activity","patchedActivityStatusRenderer","patchedAttachmentForScreenReaderRenderer","attachment","contentType","patchedAttachmentRenderer","applyMiddlewareForLegacyRenderer","patchedAvatarRenderer","patchedToastRenderer","notification","patchedTypingIndicatorRenderer","scrollToEndButtonRenderer","context","attachmentForScreenReaderRenderer","localizedGlobalizeState","_react","_WebChatAPIContext","Provider","_Tracker","defaultProps","undefined","window","navigator","propTypes","PropTypes","oneOfType","arrayOf","func","any","oneOf","shape","activity$","subscribe","isRequired","connectionStatus$","end","referenceGrammarID","string","token","bool","number","Composer","internalRenderErrorBox","store","props","error","setError","handleError","fatal","memoizedStore","_ErrorBoundary","onError","_reactRedux","WebChatReduxContext","_ActivityKeyerComposer","_ActivityAcknowledgementComposer"],"sources":["/Users/dylanmurray/Sweng-2022/front/node_modules/botframework-webchat-api/lib/src/hooks/Composer.tsx"],"sourcesContent":["import { Provider } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport React, { FC, ReactNode, useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport updateIn from 'simple-update-in';\n\nimport {\n  clearSuggestedActions,\n  connect as createConnectAction,\n  createStore,\n  DirectLineActivity,\n  DirectLineJSBotConnection,\n  disconnect,\n  dismissNotification,\n  emitTypingIndicator,\n  markActivity,\n  OneOrMany,\n  postActivity,\n  sendEvent,\n  sendFiles,\n  sendMessage,\n  sendMessageBack,\n  sendPostBack,\n  setDictateInterims,\n  setDictateState,\n  setLanguage,\n  setNotification,\n  setSendBox,\n  setSendTimeout,\n  setSendTypingIndicator,\n  singleToArray,\n  startDictate,\n  startSpeakingActivity,\n  stopDictate,\n  stopSpeakingActivity,\n  submitSendBox\n} from 'botframework-webchat-core';\n\nimport { default as WebChatAPIContext } from './internal/WebChatAPIContext';\nimport ActivityAcknowledgementComposer from '../providers/ActivityAcknowledgement/ActivityAcknowledgementComposer';\nimport ActivityKeyerComposer from '../providers/ActivityKeyer/ActivityKeyerComposer';\nimport ActivityMiddleware from '../types/ActivityMiddleware';\nimport ActivityStatusMiddleware from '../types/ActivityStatusMiddleware';\nimport AttachmentForScreenReaderMiddleware from '../types/AttachmentForScreenReaderMiddleware';\nimport AttachmentMiddleware from '../types/AttachmentMiddleware';\nimport AvatarMiddleware from '../types/AvatarMiddleware';\nimport CardActionMiddleware from '../types/CardActionMiddleware';\nimport createCustomEvent from '../utils/createCustomEvent';\nimport createDefaultCardActionMiddleware from './middleware/createDefaultCardActionMiddleware';\nimport createDefaultGroupActivitiesMiddleware from './middleware/createDefaultGroupActivitiesMiddleware';\nimport defaultSelectVoice from './internal/defaultSelectVoice';\nimport ErrorBoundary from './utils/ErrorBoundary';\nimport getAllLocalizedStrings from '../localization/getAllLocalizedStrings';\nimport GroupActivitiesMiddleware from '../types/GroupActivitiesMiddleware';\nimport isObject from '../utils/isObject';\nimport LocalizedStrings from '../types/LocalizedStrings';\nimport mapMap from '../utils/mapMap';\nimport normalizeLanguage from '../utils/normalizeLanguage';\nimport normalizeStyleOptions from '../normalizeStyleOptions';\nimport observableToPromise from './utils/observableToPromise';\nimport patchStyleOptionsFromDeprecatedProps from '../patchStyleOptionsFromDeprecatedProps';\nimport PrecompiledGlobalizeType from '../types/PrecompiledGlobalize';\nimport ScrollToEndButtonMiddleware, { ScrollToEndButtonComponentFactory } from '../types/ScrollToEndButtonMiddleware';\nimport StyleOptions from '../StyleOptions';\nimport TelemetryMeasurementEvent, { TelemetryExceptionMeasurementEvent } from '../types/TelemetryMeasurementEvent';\nimport ToastMiddleware from '../types/ToastMiddleware';\nimport Tracker from './internal/Tracker';\nimport TypingIndicatorMiddleware from '../types/TypingIndicatorMiddleware';\nimport useMarkAllAsAcknowledged from './useMarkAllAsAcknowledged';\nimport WebChatReduxContext, { useDispatch } from './internal/WebChatReduxContext';\n\nimport applyMiddleware, {\n  forLegacyRenderer as applyMiddlewareForLegacyRenderer,\n  forRenderer as applyMiddlewareForRenderer\n} from './middleware/applyMiddleware';\n\n// PrecompileGlobalize is a generated file and is not ES module. TypeScript don't work with UMD.\n// @ts-ignore\nimport PrecompiledGlobalize from '../external/PrecompiledGlobalize';\n\n// List of Redux actions factory we are hoisting as Web Chat functions\nconst DISPATCHERS = {\n  clearSuggestedActions,\n  dismissNotification,\n  emitTypingIndicator,\n  markActivity,\n  postActivity,\n  sendEvent,\n  sendFiles,\n  sendMessage,\n  sendMessageBack,\n  sendPostBack,\n  setDictateInterims,\n  setDictateState,\n  setNotification,\n  setSendBox,\n  setSendTimeout,\n  startDictate,\n  startSpeakingActivity,\n  stopDictate,\n  stopSpeakingActivity,\n  submitSendBox\n};\n\nfunction createCardActionContext({ cardActionMiddleware, directLine, dispatch, markAllAsAcknowledged }) {\n  const runMiddleware = applyMiddleware(\n    'card action',\n    ...singleToArray(cardActionMiddleware),\n    createDefaultCardActionMiddleware()\n  )({ dispatch });\n\n  return {\n    onCardAction: (cardAction, { target }: { target?: any } = {}) => {\n      markAllAsAcknowledged();\n\n      return runMiddleware({\n        cardAction,\n        getSignInUrl:\n          cardAction.type === 'signin'\n            ? () => {\n                const { value } = cardAction;\n\n                if (directLine.getSessionId) {\n                  /**\n                   * @todo TODO: [P3] We should change this one to async/await.\n                   *       This is the first place in this project to use async.\n                   *       Thus, we need to add @babel/plugin-transform-runtime and @babel/runtime.\n                   */\n                  return observableToPromise(directLine.getSessionId()).then(\n                    sessionId => `${value}${encodeURIComponent(`&code_challenge=${sessionId}`)}`\n                  );\n                }\n\n                console.warn('botframework-webchat: OAuth is not supported on this Direct Line adapter.');\n\n                return value;\n              }\n            : null,\n        target\n      });\n    }\n  };\n}\n\nfunction createGroupActivitiesContext({ groupActivitiesMiddleware, groupTimestamp }) {\n  const runMiddleware = applyMiddleware(\n    'group activities',\n    ...singleToArray(groupActivitiesMiddleware),\n    createDefaultGroupActivitiesMiddleware({ groupTimestamp })\n  );\n\n  return {\n    groupActivities: runMiddleware({})\n  };\n}\n\nfunction mergeStringsOverrides(localizedStrings, language, overrideLocalizedStrings) {\n  if (!overrideLocalizedStrings) {\n    return localizedStrings;\n  } else if (typeof overrideLocalizedStrings === 'function') {\n    const merged = overrideLocalizedStrings(localizedStrings, language);\n\n    if (!isObject(merged)) {\n      throw new Error('botframework-webchat: overrideLocalizedStrings function must return an object.');\n    }\n\n    return merged;\n  }\n\n  if (!isObject(overrideLocalizedStrings)) {\n    throw new Error('botframework-webchat: overrideLocalizedStrings must be either a function, an object, or falsy.');\n  }\n\n  return { ...localizedStrings, ...overrideLocalizedStrings };\n}\n\n// It seems \"react/require-default-props\" did not pick up `ComposerCore.defaultProps`.\n// And it falsely complaint `optional?: string` must have a corresponding `ComposerCore.defaultProps.optional = undefined`, even we already set it below.\n// Since we set both TypeScript `Props` class and `ComposerCore.propTypes`, this check will be done there as well.\n// Ignoring it in TypeScript version should be safe, as we have `propTypes` version to protect us.\n\n/* eslint-disable react/require-default-props */\ntype ComposerCoreProps = {\n  activityMiddleware?: OneOrMany<ActivityMiddleware>;\n  activityStatusMiddleware?: OneOrMany<ActivityStatusMiddleware>;\n  attachmentForScreenReaderMiddleware?: OneOrMany<AttachmentForScreenReaderMiddleware>;\n  attachmentMiddleware?: OneOrMany<AttachmentMiddleware>;\n  avatarMiddleware?: OneOrMany<AvatarMiddleware>;\n  cardActionMiddleware?: OneOrMany<CardActionMiddleware>;\n  children?: ReactNode;\n  dir?: string;\n  directLine: DirectLineJSBotConnection;\n  disabled?: boolean;\n  downscaleImageToDataURL?: (blob: Blob, maxWidth: number, maxHeight: number, type: string, quality: number) => string;\n  grammars?: any;\n  groupActivitiesMiddleware?: OneOrMany<GroupActivitiesMiddleware>;\n  internalErrorBoxClass?: React.Component | Function;\n  locale?: string;\n  onTelemetry?: (event: TelemetryMeasurementEvent) => void;\n  overrideLocalizedStrings?: LocalizedStrings | ((strings: LocalizedStrings, language: string) => LocalizedStrings);\n  renderMarkdown?: (markdown: string, { markdownRespectCRLF: boolean }, { externalLinkAlt: string }) => string;\n  scrollToEndButtonMiddleware?: OneOrMany<ScrollToEndButtonMiddleware>;\n  selectVoice?: (voices: typeof window.SpeechSynthesisVoice[], activity: DirectLineActivity) => void;\n  sendTypingIndicator?: boolean;\n  styleOptions?: StyleOptions;\n  toastMiddleware?: OneOrMany<ToastMiddleware>;\n  typingIndicatorMiddleware?: OneOrMany<TypingIndicatorMiddleware>;\n  userID?: string;\n  username?: string;\n\n  /** @deprecated Please use \"activityMiddleware\" instead. */\n  activityRenderer?: any; // TODO: [P4] Remove on or after 2022-06-15.\n  /** @deprecated Please use \"activityStatusMiddleware\" instead. */\n  activityStatusRenderer?: any; // TODO: [P4] Remove on or after 2022-06-15.\n  /** @deprecated Please use \"attachmentMiddleware\" instead. */\n  attachmentRenderer?: any; // TODO: [P4] Remove on or after 2022-06-15.\n  /** @deprecated Please use \"avatarMiddleware\" instead. */\n  avatarRenderer?: any; // TODO: [P4] Remove on or after 2022-06-15.\n  /** @deprecated Please use \"styleOptions.groupTimestamp\" instead. */\n  groupTimestamp?: boolean | number; // TODO: [P4] Remove on or after 2022-01-01\n  /** @deprecated Please use \"styleOptions.sendTimeout\" instead. */\n  sendTimeout?: number; // TODO: [P4] Remove on or after 2022-01-01.\n  /** @deprecated Please use \"toastMiddleware\" instead. */\n  toastRenderer?: any; // TODO: [P4] Remove on or after 2022-06-15.\n  /** @deprecated Please use \"typingIndicatorRenderer\" instead. */\n  typingIndicatorRenderer?: any; // TODO: [P4] Remove on or after 2022-06-15.\n};\n/* eslint-enable react/require-default-props */\n\nconst ComposerCore: FC<ComposerCoreProps> = ({\n  activityMiddleware,\n  activityRenderer,\n  activityStatusMiddleware,\n  activityStatusRenderer,\n  attachmentMiddleware,\n  attachmentForScreenReaderMiddleware,\n  attachmentRenderer,\n  avatarMiddleware,\n  avatarRenderer,\n  cardActionMiddleware,\n  children,\n  dir,\n  directLine,\n  disabled,\n  downscaleImageToDataURL,\n  grammars,\n  groupActivitiesMiddleware,\n  groupTimestamp,\n  internalErrorBoxClass,\n  locale,\n  onTelemetry,\n  overrideLocalizedStrings,\n  renderMarkdown,\n  scrollToEndButtonMiddleware,\n  selectVoice,\n  sendTimeout,\n  sendTypingIndicator,\n  styleOptions,\n  toastMiddleware,\n  toastRenderer,\n  typingIndicatorMiddleware,\n  typingIndicatorRenderer,\n  userID,\n  username\n}) => {\n  const dispatch = useDispatch();\n  const telemetryDimensionsRef = useRef({});\n\n  const patchedDir = useMemo(() => (dir === 'ltr' || dir === 'rtl' ? dir : 'auto'), [dir]);\n  const patchedGrammars = useMemo(() => grammars || [], [grammars]);\n  const patchedStyleOptions = useMemo(\n    () => normalizeStyleOptions(patchStyleOptionsFromDeprecatedProps(styleOptions, { groupTimestamp, sendTimeout })),\n    [groupTimestamp, sendTimeout, styleOptions]\n  );\n\n  useEffect(() => {\n    dispatch(setLanguage(locale));\n  }, [dispatch, locale]);\n\n  useEffect(() => {\n    typeof sendTimeout === 'number' && dispatch(setSendTimeout(sendTimeout));\n  }, [dispatch, sendTimeout]);\n\n  useEffect(() => {\n    dispatch(setSendTypingIndicator(!!sendTypingIndicator));\n  }, [dispatch, sendTypingIndicator]);\n\n  useEffect(() => {\n    dispatch(\n      createConnectAction({\n        directLine,\n        userID,\n        username\n      })\n    );\n\n    return () => {\n      /**\n       * @todo TODO: [P3] disconnect() is an async call (pending -> fulfilled), we need to wait, or change it to reconnect()\n       */\n      dispatch(disconnect());\n    };\n  }, [dispatch, directLine, userID, username]);\n\n  const markAllAsAcknowledged = useMarkAllAsAcknowledged();\n\n  const cardActionContext = useMemo(\n    () => createCardActionContext({ cardActionMiddleware, directLine, dispatch, markAllAsAcknowledged }),\n    [cardActionMiddleware, directLine, dispatch, markAllAsAcknowledged]\n  );\n\n  const patchedSelectVoice = useMemo(\n    () => selectVoice || defaultSelectVoice.bind(null, { language: locale }),\n    [locale, selectVoice]\n  );\n\n  const groupActivitiesContext = useMemo(\n    () =>\n      createGroupActivitiesContext({\n        groupActivitiesMiddleware,\n        groupTimestamp: patchedStyleOptions.groupTimestamp\n      }),\n    [groupActivitiesMiddleware, patchedStyleOptions.groupTimestamp]\n  );\n\n  const hoistedDispatchers = useMemo(\n    () =>\n      mapMap(\n        DISPATCHERS,\n        dispatcher =>\n          (...args) =>\n            dispatch(dispatcher(...args))\n      ),\n    [dispatch]\n  );\n\n  const patchedLocalizedStrings = useMemo(\n    () => mergeStringsOverrides(getAllLocalizedStrings()[normalizeLanguage(locale)], locale, overrideLocalizedStrings),\n    [locale, overrideLocalizedStrings]\n  );\n\n  const localizedGlobalize = useMemo<PrecompiledGlobalizeType>(() => {\n    const { GLOBALIZE, GLOBALIZE_LANGUAGE } = patchedLocalizedStrings || {};\n\n    return GLOBALIZE || (GLOBALIZE_LANGUAGE && PrecompiledGlobalize(GLOBALIZE_LANGUAGE)) || PrecompiledGlobalize('en');\n  }, [patchedLocalizedStrings]);\n\n  const trackDimension = useCallback(\n    (name: string, data: any) => {\n      if (!name || typeof name !== 'string') {\n        return console.warn('botframework-webchat: Telemetry dimension name must be a string.');\n      }\n\n      const type = typeof data;\n\n      if (type !== 'string' && type !== 'undefined') {\n        return console.warn('botframework-webchat: Telemetry dimension data must be a string or undefined.');\n      }\n\n      telemetryDimensionsRef.current = updateIn(\n        telemetryDimensionsRef.current,\n        [name],\n        type === 'undefined' ? data : () => data\n      );\n    },\n    [telemetryDimensionsRef]\n  );\n\n  const patchedActivityRenderer = useMemo(() => {\n    activityRenderer &&\n      console.warn(\n        'Web Chat: \"activityRenderer\" is deprecated and will be removed on 2022-06-15, please use \"activityMiddleware\" instead.'\n      );\n\n    return (\n      activityRenderer ||\n      applyMiddlewareForRenderer(\n        'activity',\n        { strict: false },\n        ...singleToArray(activityMiddleware),\n        () =>\n          () =>\n          ({ activity }) => {\n            if (activity) {\n              throw new Error(`No renderer for activity of type \"${activity.type}\"`);\n            } else {\n              throw new Error('No activity to render');\n            }\n          }\n      )({})\n    );\n  }, [activityMiddleware, activityRenderer]);\n\n  const patchedActivityStatusRenderer = useMemo(() => {\n    activityStatusRenderer &&\n      console.warn(\n        'Web Chat: \"activityStatusRenderer\" is deprecated and will be removed on 2022-06-15, please use \"activityStatusMiddleware\" instead.'\n      );\n\n    return (\n      activityStatusRenderer ||\n      applyMiddlewareForRenderer(\n        'activity status',\n        { strict: false },\n        ...singleToArray(activityStatusMiddleware),\n        () => () => () => false\n      )({})\n    );\n  }, [activityStatusMiddleware, activityStatusRenderer]);\n\n  const patchedAttachmentForScreenReaderRenderer = useMemo(\n    () =>\n      applyMiddlewareForRenderer(\n        'attachment for screen reader',\n        { strict: true },\n        ...singleToArray(attachmentForScreenReaderMiddleware),\n        () =>\n          () =>\n          ({ attachment }) => {\n            if (attachment) {\n              console.warn(`No renderer for attachment for screen reader of type \"${attachment.contentType}\"`);\n              return false;\n            }\n\n            return () => {\n              /**\n               * @todo TODO: [P4] Might be able to throw without returning a function -- investigate and possibly fix\n               */\n              throw new Error('No attachment to render');\n            };\n          }\n      )({}),\n    [attachmentForScreenReaderMiddleware]\n  );\n\n  const patchedAttachmentRenderer = useMemo(() => {\n    if (attachmentRenderer) {\n      console.warn(\n        'Web Chat: \"attachmentRenderer\" is deprecated and will be removed on 2022-06-15, please use \"attachmentMiddleware\" instead.'\n      );\n\n      return attachmentRenderer;\n    }\n\n    // Attachment renderer\n    return applyMiddlewareForLegacyRenderer(\n      'attachment',\n      ...singleToArray(attachmentMiddleware),\n      () =>\n        () =>\n        ({ attachment }) => {\n          if (attachment) {\n            throw new Error(`No renderer for attachment of type \"${attachment.contentType}\"`);\n          } else {\n            throw new Error('No attachment to render');\n          }\n        }\n    )({});\n  }, [attachmentMiddleware, attachmentRenderer]);\n\n  const patchedAvatarRenderer = useMemo(() => {\n    avatarRenderer &&\n      console.warn(\n        'Web Chat: \"avatarRenderer\" is deprecated and will be removed on 2022-06-15, please use \"avatarMiddleware\" instead.'\n      );\n\n    return (\n      avatarRenderer ||\n      applyMiddlewareForRenderer(\n        'avatar',\n        { strict: false },\n        ...singleToArray(avatarMiddleware),\n        () => () => () => false\n      )({})\n    );\n  }, [avatarMiddleware, avatarRenderer]);\n\n  const patchedToastRenderer = useMemo(() => {\n    toastRenderer &&\n      console.warn(\n        'Web Chat: \"toastRenderer\" is deprecated and will be removed on 2022-06-15, please use \"toastMiddleware\" instead.'\n      );\n\n    return (\n      toastRenderer ||\n      applyMiddlewareForRenderer(\n        'toast',\n        { strict: false },\n        ...singleToArray(toastMiddleware),\n        () =>\n          () =>\n          ({ notification }) => {\n            if (notification) {\n              throw new Error(`No renderer for notification of type \"${notification.contentType}\"`);\n            } else {\n              throw new Error('No notification to render');\n            }\n          }\n      )({})\n    );\n  }, [toastMiddleware, toastRenderer]);\n\n  const patchedTypingIndicatorRenderer = useMemo(() => {\n    typingIndicatorRenderer &&\n      console.warn(\n        'Web Chat: \"typingIndicatorRenderer\" is deprecated and will be removed on 2022-06-15, please use \"typingIndicatorMiddleware\" instead.'\n      );\n\n    return (\n      typingIndicatorRenderer ||\n      applyMiddlewareForRenderer(\n        'typing indicator',\n        { strict: false },\n        ...singleToArray(typingIndicatorMiddleware),\n        () => () => () => false\n      )({})\n    );\n  }, [typingIndicatorMiddleware, typingIndicatorRenderer]);\n\n  const scrollToEndButtonRenderer: ScrollToEndButtonComponentFactory = useMemo(\n    () =>\n      applyMiddlewareForRenderer(\n        'scroll to end button',\n        { strict: true },\n        ...singleToArray(scrollToEndButtonMiddleware),\n        () => () => () => false\n      )() as any,\n    [scrollToEndButtonMiddleware]\n  );\n\n  /**\n   * This is a heavy function, and it is expected to be only called when there is a need to recreate business logic, e.g.\n   * - User ID changed, causing all send* functions to be updated\n   * - send\n   * @todo TODO: [P3] We should think about if we allow the user to change onSendBoxValueChanged/sendBoxValue, e.g.\n   * 1. Turns text into UPPERCASE\n   * 2. Filter out profanity\n   * @todo TODO: [P4] Revisit all members of context\n   *       This context should consist of members that are not in the Redux store\n   *       i.e. members that are not interested in other types of UIs\n   */\n  const context = useMemo(\n    () => ({\n      ...cardActionContext,\n      ...groupActivitiesContext,\n      ...hoistedDispatchers,\n      activityRenderer: patchedActivityRenderer,\n      activityStatusRenderer: patchedActivityStatusRenderer,\n      attachmentForScreenReaderRenderer: patchedAttachmentForScreenReaderRenderer,\n      attachmentRenderer: patchedAttachmentRenderer,\n      avatarRenderer: patchedAvatarRenderer,\n      dir: patchedDir,\n      directLine,\n      disabled,\n      downscaleImageToDataURL,\n      grammars: patchedGrammars,\n      internalErrorBoxClass,\n      language: locale,\n      localizedGlobalizeState: [localizedGlobalize],\n      localizedStrings: patchedLocalizedStrings,\n      onTelemetry,\n      renderMarkdown,\n      scrollToEndButtonRenderer,\n      selectVoice: patchedSelectVoice,\n      sendTypingIndicator,\n      styleOptions: patchedStyleOptions,\n      telemetryDimensionsRef,\n      toastRenderer: patchedToastRenderer,\n      trackDimension,\n      typingIndicatorRenderer: patchedTypingIndicatorRenderer,\n      userID,\n      username\n    }),\n    [\n      cardActionContext,\n      directLine,\n      disabled,\n      downscaleImageToDataURL,\n      groupActivitiesContext,\n      hoistedDispatchers,\n      internalErrorBoxClass,\n      locale,\n      localizedGlobalize,\n      onTelemetry,\n      patchedActivityRenderer,\n      patchedActivityStatusRenderer,\n      patchedAttachmentForScreenReaderRenderer,\n      patchedAttachmentRenderer,\n      patchedAvatarRenderer,\n      patchedDir,\n      patchedGrammars,\n      patchedLocalizedStrings,\n      patchedSelectVoice,\n      patchedStyleOptions,\n      patchedToastRenderer,\n      patchedTypingIndicatorRenderer,\n      renderMarkdown,\n      scrollToEndButtonRenderer,\n      sendTypingIndicator,\n      telemetryDimensionsRef,\n      trackDimension,\n      userID,\n      username\n    ]\n  );\n\n  return (\n    <WebChatAPIContext.Provider value={context}>\n      {typeof children === 'function' ? children(context) : children}\n      {onTelemetry && <Tracker />}\n    </WebChatAPIContext.Provider>\n  );\n};\n\n/**\n * @todo TODO: [P3] We should consider moving some data from Redux store to props\n *       Although we use `connectToWebChat` to hide the details of accessor of Redux store,\n *       we should clean up the responsibility between Context and Redux store\n *       We should decide which data is needed for React but not in other environment such as CLI/VSCode\n */\nComposerCore.defaultProps = {\n  activityMiddleware: undefined,\n  activityRenderer: undefined,\n  activityStatusMiddleware: undefined,\n  activityStatusRenderer: undefined,\n  attachmentForScreenReaderMiddleware: undefined,\n  attachmentMiddleware: undefined,\n  attachmentRenderer: undefined,\n  avatarMiddleware: undefined,\n  avatarRenderer: undefined,\n  cardActionMiddleware: undefined,\n  children: undefined,\n  dir: 'auto',\n  disabled: false,\n  downscaleImageToDataURL: undefined,\n  grammars: [],\n  groupActivitiesMiddleware: undefined,\n  groupTimestamp: undefined,\n  internalErrorBoxClass: undefined,\n  locale: window.navigator.language || 'en-US',\n  onTelemetry: undefined,\n  overrideLocalizedStrings: undefined,\n  renderMarkdown: undefined,\n  scrollToEndButtonMiddleware: undefined,\n  selectVoice: undefined,\n  sendTimeout: undefined,\n  sendTypingIndicator: false,\n  styleOptions: {},\n  toastMiddleware: undefined,\n  toastRenderer: undefined,\n  typingIndicatorMiddleware: undefined,\n  typingIndicatorRenderer: undefined,\n  userID: '',\n  username: ''\n};\n\nComposerCore.propTypes = {\n  activityMiddleware: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.func), PropTypes.func]),\n  activityRenderer: PropTypes.func,\n  activityStatusMiddleware: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.func), PropTypes.func]),\n  activityStatusRenderer: PropTypes.func,\n  attachmentForScreenReaderMiddleware: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.func), PropTypes.func]),\n  attachmentMiddleware: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.func), PropTypes.func]),\n  attachmentRenderer: PropTypes.func,\n  avatarMiddleware: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.func), PropTypes.func]),\n  avatarRenderer: PropTypes.func,\n  cardActionMiddleware: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.func), PropTypes.func]),\n  children: PropTypes.any,\n  dir: PropTypes.oneOf(['auto', 'ltr', 'rtl']),\n  directLine: PropTypes.shape({\n    activity$: PropTypes.shape({\n      subscribe: PropTypes.func.isRequired\n    }).isRequired,\n    connectionStatus$: PropTypes.shape({\n      subscribe: PropTypes.func.isRequired\n    }).isRequired,\n    end: PropTypes.func,\n    getSessionId: PropTypes.func,\n    postActivity: PropTypes.func.isRequired,\n    referenceGrammarID: PropTypes.string,\n    token: PropTypes.string\n  }).isRequired,\n  disabled: PropTypes.bool,\n  downscaleImageToDataURL: PropTypes.func,\n  grammars: PropTypes.arrayOf(PropTypes.string),\n  groupActivitiesMiddleware: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.func), PropTypes.func]),\n  groupTimestamp: PropTypes.oneOfType([PropTypes.bool, PropTypes.number]),\n  internalErrorBoxClass: PropTypes.func, // This is for internal use only. We don't allow customization of error box.\n  locale: PropTypes.string,\n  onTelemetry: PropTypes.func,\n  overrideLocalizedStrings: PropTypes.oneOfType([PropTypes.any, PropTypes.func]),\n  renderMarkdown: PropTypes.func,\n  scrollToEndButtonMiddleware: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.func), PropTypes.func]),\n  selectVoice: PropTypes.func,\n  sendTimeout: PropTypes.number,\n  sendTypingIndicator: PropTypes.bool,\n  styleOptions: PropTypes.any,\n  toastMiddleware: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.func), PropTypes.func]),\n  toastRenderer: PropTypes.func,\n  typingIndicatorMiddleware: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.func), PropTypes.func]),\n  typingIndicatorRenderer: PropTypes.func,\n  userID: PropTypes.string,\n  username: PropTypes.string\n};\n\ntype ComposerProps = ComposerCoreProps & {\n  internalRenderErrorBox?: any;\n  store?: any;\n};\n\n// We will create a Redux store if it was not passed in\nconst Composer: FC<ComposerProps> = ({ internalRenderErrorBox, onTelemetry, store, ...props }) => {\n  const [error, setError] = useState();\n\n  const handleError = useCallback(\n    error => {\n      console.error('botframework-webchat: Uncaught exception', { error });\n\n      onTelemetry &&\n        onTelemetry(createCustomEvent('exception', { error, fatal: true }) as TelemetryExceptionMeasurementEvent);\n      setError(error);\n    },\n    [onTelemetry, setError]\n  );\n\n  const memoizedStore = useMemo(() => store || createStore(), [store]);\n\n  return error ? (\n    !!internalRenderErrorBox && internalRenderErrorBox({ error, type: 'uncaught exception' })\n  ) : (\n    <ErrorBoundary onError={handleError}>\n      <Provider context={WebChatReduxContext} store={memoizedStore}>\n        <ActivityKeyerComposer>\n          <ActivityAcknowledgementComposer>\n            <ComposerCore onTelemetry={onTelemetry} {...props} />\n          </ActivityAcknowledgementComposer>\n        </ActivityKeyerComposer>\n      </Provider>\n    </ErrorBoundary>\n  );\n};\n\nComposer.defaultProps = {\n  internalRenderErrorBox: undefined,\n  onTelemetry: undefined,\n  store: undefined\n};\n\nComposer.propTypes = {\n  internalRenderErrorBox: PropTypes.any,\n  onTelemetry: PropTypes.func,\n  store: PropTypes.any\n};\n\nexport default Composer;\n\nexport type { ComposerProps };\n"]},"metadata":{},"sourceType":"script"}