{"ast":null,"code":"\"use strict\"; // Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT license.\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DialogServiceTurnState = void 0;\n\nvar AudioOutputFormat_1 = require(\"../sdk/Audio/AudioOutputFormat\");\n\nvar AudioOutputStream_1 = require(\"../sdk/Audio/AudioOutputStream\");\n\nvar ActivityResponsePayload_1 = require(\"./ServiceMessages/ActivityResponsePayload\");\n\nvar DialogServiceTurnState =\n/** @class */\nfunction () {\n  function DialogServiceTurnState(manager, requestId) {\n    this.privRequestId = requestId;\n    this.privIsCompleted = false;\n    this.privAudioStream = null;\n    this.privTurnManager = manager;\n    this.resetTurnEndTimeout(); // tslint:disable-next-line:no-console\n    // console.info(\"DialogServiceTurnState debugturn start:\" + this.privRequestId);\n  }\n\n  Object.defineProperty(DialogServiceTurnState.prototype, \"audioStream\", {\n    get: function () {\n      // Called when is needed to stream.\n      this.resetTurnEndTimeout();\n      return this.privAudioStream;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  DialogServiceTurnState.prototype.processActivityPayload = function (payload, audioFormat) {\n    if (payload.messageDataStreamType === ActivityResponsePayload_1.MessageDataStreamType.TextToSpeechAudio) {\n      this.privAudioStream = AudioOutputStream_1.AudioOutputStream.createPullStream();\n      this.privAudioStream.format = audioFormat !== undefined ? audioFormat : AudioOutputFormat_1.AudioOutputFormatImpl.getDefaultOutputFormat(); // tslint:disable-next-line:no-console\n      // console.info(\"Audio start debugturn:\" + this.privRequestId);\n    }\n\n    return this.privAudioStream;\n  };\n\n  DialogServiceTurnState.prototype.endAudioStream = function () {\n    if (this.privAudioStream !== null && !this.privAudioStream.isClosed) {\n      this.privAudioStream.close();\n    }\n  };\n\n  DialogServiceTurnState.prototype.complete = function () {\n    if (this.privTimeoutToken !== undefined) {\n      clearTimeout(this.privTimeoutToken);\n    }\n\n    this.endAudioStream();\n  };\n\n  DialogServiceTurnState.prototype.resetTurnEndTimeout = function () {\n    var _this = this;\n\n    if (this.privTimeoutToken !== undefined) {\n      clearTimeout(this.privTimeoutToken);\n    } // tslint:disable-next-line:no-console\n    // console.info(\"Timeout reset debugturn:\" + this.privRequestId);\n\n\n    this.privTimeoutToken = setTimeout(function () {\n      // tslint:disable-next-line:no-console\n      // console.info(\"Timeout complete debugturn:\" + this.privRequestId);\n      _this.privTurnManager.CompleteTurn(_this.privRequestId);\n\n      return;\n    }, 2000);\n  };\n\n  return DialogServiceTurnState;\n}();\n\nexports.DialogServiceTurnState = DialogServiceTurnState;","map":{"version":3,"mappings":"cAAA;AACA;;;;;;;AAEA;;AACA;;AAEA;;AAEA;AAAA;AAAA;AAOI,kCAAYA,OAAZ,EAAoDC,SAApD,EAAqE;AACjE,SAAKC,aAAL,GAAqBD,SAArB;AACA,SAAKE,eAAL,GAAuB,KAAvB;AACA,SAAKC,eAAL,GAAuB,IAAvB;AACA,SAAKC,eAAL,GAAuBL,OAAvB;AACA,SAAKM,mBAAL,GALiE,CAMjE;AACA;AACH;;AAEDC,wBAAWC,gCAAX,EAAW,aAAX,EAAsB;SAAtB;AACI;AACA,WAAKF,mBAAL;AACA,aAAO,KAAKF,eAAZ;AACH,KAJqB;qBAAA;;AAAA,GAAtB;;AAMOI,4DAAP,UAA8BC,OAA9B,EAAgEC,WAAhE,EAAmG;AAC/F,QAAID,OAAO,CAACE,qBAAR,KAAkCC,gDAAsBC,iBAA5D,EAA+E;AAC3E,WAAKT,eAAL,GAAuBU,sCAAkBC,gBAAlB,EAAvB;AACA,WAAKX,eAAL,CAAqBY,MAArB,GAA+BN,WAAW,KAAKO,SAAjB,GAA8BP,WAA9B,GAA4CQ,0CAAsBC,sBAAtB,EAA1E,CAF2E,CAG3E;AACA;AACH;;AACD,WAAO,KAAKf,eAAZ;AACH,GARM;;AAUAI,oDAAP;AACI,QAAI,KAAKJ,eAAL,KAAyB,IAAzB,IAAiC,CAAC,KAAKA,eAAL,CAAqBgB,QAA3D,EAAqE;AACjE,WAAKhB,eAAL,CAAqBiB,KAArB;AACH;AACJ,GAJM;;AAMAb,8CAAP;AACI,QAAI,KAAKc,gBAAL,KAA0BL,SAA9B,EAAyC;AACrCM,kBAAY,CAAC,KAAKD,gBAAN,CAAZ;AACH;;AACD,SAAKE,cAAL;AACH,GALM;;AAOChB,yDAAR;AAAA;;AACI,QAAI,KAAKc,gBAAL,KAA0BL,SAA9B,EAAyC;AACrCM,kBAAY,CAAC,KAAKD,gBAAN,CAAZ;AACH,KAHL,CAII;AACA;;;AAEA,SAAKA,gBAAL,GAAwBG,UAAU,CAAC;AAC/B;AACA;AAEAC,WAAI,CAACrB,eAAL,CAAqBsB,YAArB,CAAkCD,KAAI,CAACxB,aAAvC;;AACA;AACH,KANiC,EAM/B,IAN+B,CAAlC;AAOH,GAdO;;AAeZ;AA7DA;;AAAa0B","names":["manager","requestId","privRequestId","privIsCompleted","privAudioStream","privTurnManager","resetTurnEndTimeout","Object","DialogServiceTurnState","payload","audioFormat","messageDataStreamType","ActivityResponsePayload_1","TextToSpeechAudio","AudioOutputStream_1","createPullStream","format","undefined","AudioOutputFormat_1","getDefaultOutputFormat","isClosed","close","privTimeoutToken","clearTimeout","endAudioStream","setTimeout","_this","CompleteTurn","exports"],"sources":["/Users/dylanmurray/Sweng-2022/front/node_modules/microsoft-cognitiveservices-speech-sdk/distrib/lib/src/common.speech/src/common.speech/DialogServiceTurnState.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { AudioOutputFormatImpl } from \"../sdk/Audio/AudioOutputFormat\";\r\nimport { AudioOutputStream, PullAudioOutputStreamImpl } from \"../sdk/Audio/AudioOutputStream\";\r\nimport { DialogServiceTurnStateManager } from \"./DialogServiceTurnStateManager\";\r\nimport { ActivityPayloadResponse, MessageDataStreamType } from \"./ServiceMessages/ActivityResponsePayload\";\r\n\r\nexport class DialogServiceTurnState {\r\n    private privRequestId: string;\r\n    private privIsCompleted: boolean;\r\n    private privAudioStream: PullAudioOutputStreamImpl;\r\n    private privTimeoutToken: any;\r\n    private privTurnManager: DialogServiceTurnStateManager;\r\n\r\n    constructor(manager: DialogServiceTurnStateManager, requestId: string) {\r\n        this.privRequestId = requestId;\r\n        this.privIsCompleted = false;\r\n        this.privAudioStream = null;\r\n        this.privTurnManager = manager;\r\n        this.resetTurnEndTimeout();\r\n        // tslint:disable-next-line:no-console\r\n        // console.info(\"DialogServiceTurnState debugturn start:\" + this.privRequestId);\r\n    }\r\n\r\n    public get audioStream(): PullAudioOutputStreamImpl {\r\n        // Called when is needed to stream.\r\n        this.resetTurnEndTimeout();\r\n        return this.privAudioStream;\r\n    }\r\n\r\n    public processActivityPayload(payload: ActivityPayloadResponse, audioFormat?: AudioOutputFormatImpl): PullAudioOutputStreamImpl {\r\n        if (payload.messageDataStreamType === MessageDataStreamType.TextToSpeechAudio) {\r\n            this.privAudioStream = AudioOutputStream.createPullStream() as PullAudioOutputStreamImpl;\r\n            this.privAudioStream.format = (audioFormat !== undefined) ? audioFormat : AudioOutputFormatImpl.getDefaultOutputFormat();\r\n            // tslint:disable-next-line:no-console\r\n            // console.info(\"Audio start debugturn:\" + this.privRequestId);\r\n        }\r\n        return this.privAudioStream;\r\n    }\r\n\r\n    public endAudioStream(): void {\r\n        if (this.privAudioStream !== null && !this.privAudioStream.isClosed) {\r\n            this.privAudioStream.close();\r\n        }\r\n    }\r\n\r\n    public complete(): void {\r\n        if (this.privTimeoutToken !== undefined) {\r\n            clearTimeout(this.privTimeoutToken);\r\n        }\r\n        this.endAudioStream();\r\n    }\r\n\r\n    private resetTurnEndTimeout(): void {\r\n        if (this.privTimeoutToken !== undefined) {\r\n            clearTimeout(this.privTimeoutToken);\r\n        }\r\n        // tslint:disable-next-line:no-console\r\n        // console.info(\"Timeout reset debugturn:\" + this.privRequestId);\r\n\r\n        this.privTimeoutToken = setTimeout((): void => {\r\n            // tslint:disable-next-line:no-console\r\n            // console.info(\"Timeout complete debugturn:\" + this.privRequestId);\r\n\r\n            this.privTurnManager.CompleteTurn(this.privRequestId);\r\n            return;\r\n        }, 2000);\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"script"}