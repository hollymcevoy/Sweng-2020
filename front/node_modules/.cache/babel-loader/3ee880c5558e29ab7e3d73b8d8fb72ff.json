{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = render;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _markdownItForInline = _interopRequireDefault(require(\"markdown-it-for-inline\"));\n\nvar _markdownIt = _interopRequireDefault(require(\"markdown-it\"));\n\nvar _markdownItAttrsEs = _interopRequireDefault(require(\"markdown-it-attrs-es5\"));\n\nvar _sanitizeHtml = _interopRequireDefault(require(\"sanitize-html\"));\n/* eslint no-magic-numbers: [\"error\", { \"ignore\": [0, 1, 2] }] */\n\n\nvar SANITIZE_HTML_OPTIONS = {\n  allowedAttributes: {\n    a: ['aria-label', 'href', 'name', 'rel', 'target', 'title'],\n    img: ['alt', 'class', 'src']\n  },\n  allowedSchemes: ['data', 'http', 'https', 'ftp', 'mailto', 'sip', 'tel'],\n  allowedTags: ['a', 'b', 'blockquote', 'br', 'caption', 'code', 'del', 'div', 'em', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'hr', 'i', 'img', 'ins', 'li', 'nl', 'ol', 'p', 'pre', 's', 'span', 'strike', 'strong', 'table', 'tbody', 'td', 'tfoot', 'th', 'thead', 'tr', 'ul']\n}; // Put a transparent pixel instead of the \"open in new window\" icon, so developers can easily modify the icon in CSS.\n\nvar TRANSPARENT_GIF = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'; // This is used for parsing Markdown for external links.\n\nvar internalMarkdownIt = new _markdownIt.default();\nvar MARKDOWN_ATTRS_LEFT_DELIMITER = '⟬'; // Make sure the delimiter is free from any RegExp characters, such as *, ?, etc.\n// IE11 does not support \"u\" flag and Babel could not remove it. We intentionally omitting the \"u\" flag here.\n// eslint-disable-next-line security/detect-non-literal-regexp, require-unicode-regexp\n\nvar MARKDOWN_ATTRS_LEFT_DELIMITER_PATTERN = new RegExp(MARKDOWN_ATTRS_LEFT_DELIMITER, 'g');\nvar MARKDOWN_ATTRS_RIGHT_DELIMITER = '⟭'; // Make sure the delimiter is free from any RegExp characters, such as *, ?, etc.\n// IE11 does not support \"u\" flag and Babel could not remove it. We intentionally omitting the \"u\" flag here.\n// eslint-disable-next-line security/detect-non-literal-regexp, require-unicode-regexp\n\nvar MARKDOWN_ATTRS_RIGHT_DELIMITER_PATTERN = new RegExp(MARKDOWN_ATTRS_RIGHT_DELIMITER, 'g');\n\nfunction render(markdown, _ref) {\n  var markdownRespectCRLF = _ref.markdownRespectCRLF;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$externalLinkAlt = _ref2.externalLinkAlt,\n      externalLinkAlt = _ref2$externalLinkAlt === void 0 ? '' : _ref2$externalLinkAlt;\n\n  if (markdownRespectCRLF) {\n    markdown = markdown.replace(/\\n\\r|\\r\\n/g, function (carriageReturn) {\n      return carriageReturn === '\\n\\r' ? '\\r\\n' : '\\n\\r';\n    });\n  } // Related to #3165.\n  // We only support attributes \"aria-label\" and should leave other attributes as-is.\n  // However, `markdown-it-attrs` remove unrecognized attributes, such as {hello}.\n  // Before passing to `markdown-it-attrs`, we will convert known attributes from {aria-label=\"...\"} into ⟬aria-label=\"...\"⟭ (using white tortoise shell brackets).\n  // Then, we ask `markdown-it-attrs` to only process the new brackets, so it should only try to process things that we allowlisted.\n  // Lastly, we revert tortoise shell brackets back to curly brackets, for unprocessed attributes.\n\n\n  markdown = markdown.replace(/\\{[\\t-\\r \\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000\\uFEFF]*aria\\x2Dlabel()[\\t-\\r \\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000\\uFEFF]*\\}/gi, \"\".concat(MARKDOWN_ATTRS_LEFT_DELIMITER, \"aria-label\").concat(MARKDOWN_ATTRS_RIGHT_DELIMITER)).replace(/\\{[\\t-\\r \\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000\\uFEFF]*aria\\x2Dlabel=(\"(?:(?!\")[\\s\\S])*\"|(?:(?![\\t-\\r \\}\\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000\\uFEFF])[\\s\\S])*)[\\t-\\r \\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000\\uFEFF]*\\}/gi, function (_, valueInsideQuotes) {\n    return \"\".concat(MARKDOWN_ATTRS_LEFT_DELIMITER, \"aria-label=\").concat(valueInsideQuotes).concat(MARKDOWN_ATTRS_RIGHT_DELIMITER);\n  });\n  var html = new _markdownIt.default({\n    breaks: false,\n    html: false,\n    linkify: true,\n    typographer: true,\n    xhtmlOut: true\n  }).use(_markdownItAttrsEs.default, {\n    // `markdown-it-attrs` is added for accessibility and allow bot developers to specify `aria-label`.\n    // We are allowlisting `aria-label` only as it is allowlisted in `sanitize-html`.\n    // Other `aria-*` will be sanitized even we allowlisted here.\n    allowedAttributes: ['aria-label'],\n    leftDelimiter: MARKDOWN_ATTRS_LEFT_DELIMITER,\n    rightDelimiter: MARKDOWN_ATTRS_RIGHT_DELIMITER\n  }).use(_markdownItForInline.default, 'url_new_win', 'link_open', function (tokens, index) {\n    var token = tokens[+index];\n    token.attrSet('rel', 'noopener noreferrer');\n    token.attrSet('target', '_blank');\n    var linkOpenToken = tokens.find(function (_ref3) {\n      var type = _ref3.type;\n      return type === 'link_open';\n    });\n\n    var _linkOpenToken$attrs$ = linkOpenToken.attrs.find(function (_ref4) {\n      var _ref5 = (0, _slicedToArray2.default)(_ref4, 1),\n          name = _ref5[0];\n\n      return name === 'href';\n    }),\n        _linkOpenToken$attrs$2 = (0, _slicedToArray2.default)(_linkOpenToken$attrs$, 2),\n        href = _linkOpenToken$attrs$2[1]; // Adds a new icon if the link is http: or https:.\n    // Don't add if it's a phone number, etc.\n\n\n    if (/^http[s\\u017F]?:/i.test(href)) {\n      externalLinkAlt && token.attrSet('title', externalLinkAlt);\n      var iconTokens = internalMarkdownIt.parseInline(\"![\".concat(externalLinkAlt, \"](\").concat(TRANSPARENT_GIF, \")\"))[0].children;\n      iconTokens[0].attrJoin('class', 'webchat__markdown__external-link-icon');\n      tokens.splice.apply(tokens, [index + 2, 0].concat((0, _toConsumableArray2.default)(iconTokens)));\n    }\n  }).render(markdown); // Restore attributes not processed by `markdown-it-attrs`.\n  // TODO: [P2] #2511 After we fixed our polyfill story, we should use \"String.prototype.replaceAll\" instead of RegExp for replace all occurrences.\n\n  html = html.replace(MARKDOWN_ATTRS_LEFT_DELIMITER_PATTERN, '{').replace(MARKDOWN_ATTRS_RIGHT_DELIMITER_PATTERN, '}'); // The signature from \"sanitize-html\" module is not correct.\n  // @ts-ignore\n\n  return (0, _sanitizeHtml.default)(html, SANITIZE_HTML_OPTIONS);\n}","map":{"version":3,"mappings":"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","names":["SANITIZE_HTML_OPTIONS","allowedAttributes","a","img","allowedSchemes","allowedTags","TRANSPARENT_GIF","internalMarkdownIt","MarkdownIt","MARKDOWN_ATTRS_LEFT_DELIMITER","MARKDOWN_ATTRS_LEFT_DELIMITER_PATTERN","RegExp","MARKDOWN_ATTRS_RIGHT_DELIMITER","MARKDOWN_ATTRS_RIGHT_DELIMITER_PATTERN","render","markdown","markdownRespectCRLF","externalLinkAlt","replace","carriageReturn","_","valueInsideQuotes","html","breaks","linkify","typographer","xhtmlOut","use","markdownItAttrs","leftDelimiter","rightDelimiter","iterator","tokens","index","token","attrSet","linkOpenToken","find","type","attrs","name","href","test","iconTokens","parseInline","children","attrJoin","splice"],"sources":["/Users/dylanmurray/Sweng-2022/front/node_modules/botframework-webchat/lib/src/renderMarkdown.ts"],"sourcesContent":["/* eslint no-magic-numbers: [\"error\", { \"ignore\": [0, 1, 2] }] */\n\nimport iterator from 'markdown-it-for-inline';\nimport MarkdownIt from 'markdown-it';\nimport markdownItAttrs from 'markdown-it-attrs-es5';\nimport sanitizeHTML from 'sanitize-html';\n\nconst SANITIZE_HTML_OPTIONS = {\n  allowedAttributes: {\n    a: ['aria-label', 'href', 'name', 'rel', 'target', 'title'],\n    img: ['alt', 'class', 'src']\n  },\n  allowedSchemes: ['data', 'http', 'https', 'ftp', 'mailto', 'sip', 'tel'],\n  allowedTags: [\n    'a',\n    'b',\n    'blockquote',\n    'br',\n    'caption',\n    'code',\n    'del',\n    'div',\n    'em',\n    'h1',\n    'h2',\n    'h3',\n    'h4',\n    'h5',\n    'h6',\n    'hr',\n    'i',\n    'img',\n    'ins',\n    'li',\n    'nl',\n    'ol',\n    'p',\n    'pre',\n    's',\n    'span',\n    'strike',\n    'strong',\n    'table',\n    'tbody',\n    'td',\n    'tfoot',\n    'th',\n    'thead',\n    'tr',\n    'ul'\n  ]\n};\n\n// Put a transparent pixel instead of the \"open in new window\" icon, so developers can easily modify the icon in CSS.\nconst TRANSPARENT_GIF = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\n// This is used for parsing Markdown for external links.\nconst internalMarkdownIt = new MarkdownIt();\n\nconst MARKDOWN_ATTRS_LEFT_DELIMITER = '⟬';\n// Make sure the delimiter is free from any RegExp characters, such as *, ?, etc.\n// IE11 does not support \"u\" flag and Babel could not remove it. We intentionally omitting the \"u\" flag here.\n// eslint-disable-next-line security/detect-non-literal-regexp, require-unicode-regexp\nconst MARKDOWN_ATTRS_LEFT_DELIMITER_PATTERN = new RegExp(MARKDOWN_ATTRS_LEFT_DELIMITER, 'g');\n\nconst MARKDOWN_ATTRS_RIGHT_DELIMITER = '⟭';\n// Make sure the delimiter is free from any RegExp characters, such as *, ?, etc.\n// IE11 does not support \"u\" flag and Babel could not remove it. We intentionally omitting the \"u\" flag here.\n// eslint-disable-next-line security/detect-non-literal-regexp, require-unicode-regexp\nconst MARKDOWN_ATTRS_RIGHT_DELIMITER_PATTERN = new RegExp(MARKDOWN_ATTRS_RIGHT_DELIMITER, 'g');\n\nexport default function render(\n  markdown: string,\n  { markdownRespectCRLF }: { markdownRespectCRLF: boolean },\n  { externalLinkAlt = '' }: { externalLinkAlt?: string } = {}\n): string {\n  if (markdownRespectCRLF) {\n    markdown = markdown.replace(/\\n\\r|\\r\\n/gu, carriageReturn => (carriageReturn === '\\n\\r' ? '\\r\\n' : '\\n\\r'));\n  }\n\n  // Related to #3165.\n  // We only support attributes \"aria-label\" and should leave other attributes as-is.\n  // However, `markdown-it-attrs` remove unrecognized attributes, such as {hello}.\n  // Before passing to `markdown-it-attrs`, we will convert known attributes from {aria-label=\"...\"} into ⟬aria-label=\"...\"⟭ (using white tortoise shell brackets).\n  // Then, we ask `markdown-it-attrs` to only process the new brackets, so it should only try to process things that we allowlisted.\n  // Lastly, we revert tortoise shell brackets back to curly brackets, for unprocessed attributes.\n  markdown = markdown\n    .replace(/\\{\\s*aria-label()\\s*\\}/giu, `${MARKDOWN_ATTRS_LEFT_DELIMITER}aria-label${MARKDOWN_ATTRS_RIGHT_DELIMITER}`)\n    .replace(\n      /\\{\\s*aria-label=(\"[^\"]*\"|[^\\s}]*)\\s*\\}/giu,\n      (_, valueInsideQuotes) =>\n        `${MARKDOWN_ATTRS_LEFT_DELIMITER}aria-label=${valueInsideQuotes}${MARKDOWN_ATTRS_RIGHT_DELIMITER}`\n    );\n\n  let html = new MarkdownIt({\n    breaks: false,\n    html: false,\n    linkify: true,\n    typographer: true,\n    xhtmlOut: true\n  })\n    .use(markdownItAttrs, {\n      // `markdown-it-attrs` is added for accessibility and allow bot developers to specify `aria-label`.\n      // We are allowlisting `aria-label` only as it is allowlisted in `sanitize-html`.\n      // Other `aria-*` will be sanitized even we allowlisted here.\n      allowedAttributes: ['aria-label'],\n      leftDelimiter: MARKDOWN_ATTRS_LEFT_DELIMITER,\n      rightDelimiter: MARKDOWN_ATTRS_RIGHT_DELIMITER\n    })\n    .use(iterator, 'url_new_win', 'link_open', (tokens, index) => {\n      const token = tokens[+index];\n\n      token.attrSet('rel', 'noopener noreferrer');\n      token.attrSet('target', '_blank');\n\n      const linkOpenToken = tokens.find(({ type }) => type === 'link_open');\n      const [, href] = linkOpenToken.attrs.find(([name]) => name === 'href');\n\n      // Adds a new icon if the link is http: or https:.\n      // Don't add if it's a phone number, etc.\n      if (/^https?:/iu.test(href)) {\n        externalLinkAlt && token.attrSet('title', externalLinkAlt);\n\n        const iconTokens = internalMarkdownIt.parseInline(`![${externalLinkAlt}](${TRANSPARENT_GIF})`)[0].children;\n\n        iconTokens[0].attrJoin('class', 'webchat__markdown__external-link-icon');\n\n        tokens.splice(index + 2, 0, ...iconTokens);\n      }\n    })\n    .render(markdown);\n\n  // Restore attributes not processed by `markdown-it-attrs`.\n  // TODO: [P2] #2511 After we fixed our polyfill story, we should use \"String.prototype.replaceAll\" instead of RegExp for replace all occurrences.\n  html = html.replace(MARKDOWN_ATTRS_LEFT_DELIMITER_PATTERN, '{').replace(MARKDOWN_ATTRS_RIGHT_DELIMITER_PATTERN, '}');\n\n  // The signature from \"sanitize-html\" module is not correct.\n  // @ts-ignore\n  return sanitizeHTML(html, SANITIZE_HTML_OPTIONS);\n}\n"]},"metadata":{},"sourceType":"script"}