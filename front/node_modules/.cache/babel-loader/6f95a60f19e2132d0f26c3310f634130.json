{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _botframeworkWebchatApi = require(\"botframework-webchat-api\");\n\nvar _reactSay = require(\"react-say\");\n\nvar _botframeworkWebchatCore = require(\"botframework-webchat-core\");\n\nvar _createInstance = _interopRequireDefault(require(\"@emotion/css/create-instance\"));\n\nvar _createStyleSet = _interopRequireDefault(require(\"./Styles/createStyleSet\"));\n\nvar _markdownIt = _interopRequireDefault(require(\"markdown-it\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _BypassSpeechSynthesisPonyfill = require(\"./hooks/internal/BypassSpeechSynthesisPonyfill\");\n\nvar _ActivityTreeComposer = _interopRequireDefault(require(\"./providers/ActivityTree/ActivityTreeComposer\"));\n\nvar _addTargetBlankToHyperlinksMarkdown = _interopRequireDefault(require(\"./Utils/addTargetBlankToHyperlinksMarkdown\"));\n\nvar _createCSSKey = _interopRequireDefault(require(\"./Utils/createCSSKey\"));\n\nvar _createCoreMiddleware = _interopRequireDefault(require(\"./Middleware/Activity/createCoreMiddleware\"));\n\nvar _createCoreMiddleware2 = _interopRequireDefault(require(\"./Middleware/ActivityStatus/createCoreMiddleware\"));\n\nvar _createCoreMiddleware3 = _interopRequireDefault(require(\"./Middleware/AttachmentForScreenReader/createCoreMiddleware\"));\n\nvar _createCoreMiddleware4 = _interopRequireDefault(require(\"./Middleware/Attachment/createCoreMiddleware\"));\n\nvar _createCoreMiddleware5 = _interopRequireDefault(require(\"./Middleware/Avatar/createCoreMiddleware\"));\n\nvar _createCoreMiddleware6 = _interopRequireDefault(require(\"./Middleware/CardAction/createCoreMiddleware\"));\n\nvar _createScrollToEndButtonMiddleware = _interopRequireDefault(require(\"./Middleware/ScrollToEndButton/createScrollToEndButtonMiddleware\"));\n\nvar _createCoreMiddleware7 = _interopRequireDefault(require(\"./Middleware/Toast/createCoreMiddleware\"));\n\nvar _createCoreMiddleware8 = _interopRequireDefault(require(\"./Middleware/TypingIndicator/createCoreMiddleware\"));\n\nvar _Dictation = _interopRequireDefault(require(\"./Dictation\"));\n\nvar _downscaleImageToDataURL = _interopRequireDefault(require(\"./Utils/downscaleImageToDataURL\"));\n\nvar _ErrorBox = _interopRequireDefault(require(\"./ErrorBox\"));\n\nvar _mapMap = _interopRequireDefault(require(\"./Utils/mapMap\"));\n\nvar _UITracker = _interopRequireDefault(require(\"./hooks/internal/UITracker\"));\n\nvar _WebChatUIContext = _interopRequireDefault(require(\"./hooks/internal/WebChatUIContext\"));\n\nvar _excluded = [\"activityMiddleware\", \"activityStatusMiddleware\", \"attachmentForScreenReaderMiddleware\", \"attachmentMiddleware\", \"avatarMiddleware\", \"cardActionMiddleware\", \"children\", \"extraStyleSet\", \"renderMarkdown\", \"scrollToEndButtonMiddleware\", \"styleSet\", \"suggestedActionsAccessKey\", \"toastMiddleware\", \"typingIndicatorMiddleware\", \"webSpeechPonyfillFactory\"];\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nvar useGetActivityByKey = _botframeworkWebchatApi.hooks.useGetActivityByKey,\n    useReferenceGrammarID = _botframeworkWebchatApi.hooks.useReferenceGrammarID,\n    useStyleOptions = _botframeworkWebchatApi.hooks.useStyleOptions;\nvar node_env = undefined || \"production\";\nvar emotionPool = {};\n\nfunction styleSetToEmotionObjects(styleToEmotionObject, styleSet) {\n  return (0, _mapMap.default)(styleSet, function (style, key) {\n    return key === 'options' ? style : styleToEmotionObject(style);\n  });\n}\n\nvar ComposerCore = function ComposerCore(_ref) {\n  var children = _ref.children,\n      extraStyleSet = _ref.extraStyleSet,\n      nonce = _ref.nonce,\n      renderMarkdown = _ref.renderMarkdown,\n      styleSet = _ref.styleSet,\n      suggestedActionsAccessKey = _ref.suggestedActionsAccessKey,\n      webSpeechPonyfillFactory = _ref.webSpeechPonyfillFactory;\n\n  var _useState = (0, _react.useState)(),\n      _useState2 = _slicedToArray(_useState, 2),\n      dictateAbortable = _useState2[0],\n      setDictateAbortable = _useState2[1];\n\n  var _useReferenceGrammarI = useReferenceGrammarID(),\n      _useReferenceGrammarI2 = _slicedToArray(_useReferenceGrammarI, 1),\n      referenceGrammarID = _useReferenceGrammarI2[0];\n\n  var _useStyleOptions = useStyleOptions(),\n      _useStyleOptions2 = _slicedToArray(_useStyleOptions, 1),\n      styleOptions = _useStyleOptions2[0];\n\n  var focusSendBoxCallbacksRef = (0, _react.useRef)([]);\n  var focusTranscriptCallbacksRef = (0, _react.useRef)([]);\n  var internalMarkdownIt = (0, _react.useMemo)(function () {\n    return new _markdownIt.default();\n  }, []);\n  var scrollToCallbacksRef = (0, _react.useRef)([]);\n  var scrollToEndCallbacksRef = (0, _react.useRef)([]); // Instead of having a `scrollUpCallbacksRef` and `scrollDownCallbacksRef`, they are combined into a single `scrollRelativeCallbacksRef`.\n  // The first argument tells whether it should go \"up\" or \"down\".\n\n  var scrollRelativeCallbacksRef = (0, _react.useRef)([]);\n  var dictationOnError = (0, _react.useCallback)(function (err) {\n    console.error(err);\n  }, []);\n  var internalRenderMarkdownInline = (0, _react.useMemo)(function () {\n    return function (markdown) {\n      var tree = internalMarkdownIt.parseInline(markdown); // We should add rel=\"noopener noreferrer\" and target=\"_blank\"\n\n      var patchedTree = (0, _addTargetBlankToHyperlinksMarkdown.default)(tree);\n      return internalMarkdownIt.renderer.render(patchedTree);\n    };\n  }, [internalMarkdownIt]);\n  var styleToEmotionObject = (0, _react.useMemo)(function () {\n    // Emotion doesn't hash with nonce. We need to provide the pooling mechanism.\n    // 1. If 2 instances use different nonce, they should result in different hash;\n    // 2. If 2 instances are being mounted, pooling will make sure we render only 1 set of <style> tags, instead of 2.\n    var emotion = // Prefix \"id-\" to prevent object injection attack.\n    emotionPool[\"id-\".concat(nonce)] || (emotionPool[\"id-\".concat(nonce)] = (0, _createInstance.default)({\n      key: \"webchat--css-\".concat((0, _createCSSKey.default)()),\n      nonce: nonce\n    }));\n    return function (style) {\n      return emotion.css(style);\n    };\n  }, [nonce]);\n  var patchedStyleSet = (0, _react.useMemo)(function () {\n    return styleSetToEmotionObjects(styleToEmotionObject, _objectSpread(_objectSpread({}, styleSet || (0, _createStyleSet.default)(styleOptions)), extraStyleSet));\n  }, [extraStyleSet, styleOptions, styleSet, styleToEmotionObject]);\n  var webSpeechPonyfill = (0, _react.useMemo)(function () {\n    var ponyfill = webSpeechPonyfillFactory && webSpeechPonyfillFactory({\n      referenceGrammarID: referenceGrammarID\n    });\n\n    var _ref2 = ponyfill || {},\n        speechSynthesis = _ref2.speechSynthesis,\n        SpeechSynthesisUtterance = _ref2.SpeechSynthesisUtterance;\n\n    return _objectSpread(_objectSpread({}, ponyfill), {}, {\n      speechSynthesis: speechSynthesis || _BypassSpeechSynthesisPonyfill.speechSynthesis,\n      SpeechSynthesisUtterance: SpeechSynthesisUtterance || _BypassSpeechSynthesisPonyfill.SpeechSynthesisUtterance\n    });\n  }, [referenceGrammarID, webSpeechPonyfillFactory]);\n  var scrollPositionObserversRef = (0, _react.useRef)([]);\n  var dispatchScrollPosition = (0, _react.useCallback)(function (event) {\n    return scrollPositionObserversRef.current.forEach(function (observer) {\n      return observer(event);\n    });\n  }, [scrollPositionObserversRef]);\n  var observeScrollPosition = (0, _react.useCallback)(function (observer) {\n    scrollPositionObserversRef.current = [].concat(_toConsumableArray(scrollPositionObserversRef.current), [observer]);\n    return function () {\n      scrollPositionObserversRef.current = scrollPositionObserversRef.current.filter(function (target) {\n        return target !== observer;\n      });\n    };\n  }, [scrollPositionObserversRef]);\n  var transcriptFocusObserversRef = (0, _react.useRef)([]);\n\n  var _useState3 = (0, _react.useState)(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      numTranscriptFocusObservers = _useState4[0],\n      setNumTranscriptFocusObservers = _useState4[1];\n\n  var getActivityByKey = useGetActivityByKey();\n  var dispatchTranscriptFocusByActivityKey = (0, _react.useMemo)(function () {\n    var prevActivityKey = Symbol();\n    return function (activityKey) {\n      if (activityKey !== prevActivityKey) {\n        prevActivityKey = activityKey;\n        var event = {\n          activity: getActivityByKey(activityKey)\n        };\n        transcriptFocusObserversRef.current.forEach(function (observer) {\n          return observer(event);\n        });\n      }\n    };\n  }, [getActivityByKey, transcriptFocusObserversRef]);\n  var observeTranscriptFocus = (0, _react.useCallback)(function (observer) {\n    transcriptFocusObserversRef.current = [].concat(_toConsumableArray(transcriptFocusObserversRef.current), [observer]);\n    setNumTranscriptFocusObservers(transcriptFocusObserversRef.current.length);\n    return function () {\n      transcriptFocusObserversRef.current = transcriptFocusObserversRef.current.filter(function (target) {\n        return target !== observer;\n      });\n      setNumTranscriptFocusObservers(transcriptFocusObserversRef.current.length);\n    };\n  }, [transcriptFocusObserversRef, setNumTranscriptFocusObservers]);\n  var context = (0, _react.useMemo)(function () {\n    return {\n      dictateAbortable: dictateAbortable,\n      dispatchScrollPosition: dispatchScrollPosition,\n      dispatchTranscriptFocusByActivityKey: dispatchTranscriptFocusByActivityKey,\n      focusSendBoxCallbacksRef: focusSendBoxCallbacksRef,\n      focusTranscriptCallbacksRef: focusTranscriptCallbacksRef,\n      internalMarkdownItState: [internalMarkdownIt],\n      internalRenderMarkdownInline: internalRenderMarkdownInline,\n      nonce: nonce,\n      numTranscriptFocusObservers: numTranscriptFocusObservers,\n      observeScrollPosition: observeScrollPosition,\n      observeTranscriptFocus: observeTranscriptFocus,\n      renderMarkdown: renderMarkdown,\n      scrollRelativeCallbacksRef: scrollRelativeCallbacksRef,\n      scrollToCallbacksRef: scrollToCallbacksRef,\n      scrollToEndCallbacksRef: scrollToEndCallbacksRef,\n      setDictateAbortable: setDictateAbortable,\n      styleSet: patchedStyleSet,\n      styleToEmotionObject: styleToEmotionObject,\n      suggestedActionsAccessKey: suggestedActionsAccessKey,\n      webSpeechPonyfill: webSpeechPonyfill\n    };\n  }, [dictateAbortable, dispatchScrollPosition, dispatchTranscriptFocusByActivityKey, focusSendBoxCallbacksRef, focusTranscriptCallbacksRef, internalMarkdownIt, internalRenderMarkdownInline, nonce, numTranscriptFocusObservers, observeScrollPosition, observeTranscriptFocus, patchedStyleSet, renderMarkdown, scrollRelativeCallbacksRef, scrollToCallbacksRef, scrollToEndCallbacksRef, setDictateAbortable, styleToEmotionObject, suggestedActionsAccessKey, webSpeechPonyfill]);\n  return /*#__PURE__*/_react.default.createElement(_reactSay.Composer, {\n    ponyfill: webSpeechPonyfill\n  }, /*#__PURE__*/_react.default.createElement(_WebChatUIContext.default.Provider, {\n    value: context\n  }, children, /*#__PURE__*/_react.default.createElement(_Dictation.default, {\n    onError: dictationOnError\n  })));\n};\n\nComposerCore.defaultProps = {\n  children: undefined,\n  extraStyleSet: undefined,\n  nonce: undefined,\n  renderMarkdown: undefined,\n  styleSet: undefined,\n  suggestedActionsAccessKey: 'A a Å å',\n  webSpeechPonyfillFactory: undefined\n};\nComposerCore.propTypes = {\n  extraStyleSet: _propTypes.default.any,\n  nonce: _propTypes.default.string,\n  renderMarkdown: _propTypes.default.func,\n  styleSet: _propTypes.default.any,\n  suggestedActionsAccessKey: _propTypes.default.oneOfType([_propTypes.default.oneOf([false]), _propTypes.default.string]),\n  webSpeechPonyfillFactory: _propTypes.default.func\n};\n\nvar Composer = function Composer(_ref3) {\n  var activityMiddleware = _ref3.activityMiddleware,\n      activityStatusMiddleware = _ref3.activityStatusMiddleware,\n      attachmentForScreenReaderMiddleware = _ref3.attachmentForScreenReaderMiddleware,\n      attachmentMiddleware = _ref3.attachmentMiddleware,\n      avatarMiddleware = _ref3.avatarMiddleware,\n      cardActionMiddleware = _ref3.cardActionMiddleware,\n      children = _ref3.children,\n      extraStyleSet = _ref3.extraStyleSet,\n      renderMarkdown = _ref3.renderMarkdown,\n      scrollToEndButtonMiddleware = _ref3.scrollToEndButtonMiddleware,\n      styleSet = _ref3.styleSet,\n      suggestedActionsAccessKey = _ref3.suggestedActionsAccessKey,\n      toastMiddleware = _ref3.toastMiddleware,\n      typingIndicatorMiddleware = _ref3.typingIndicatorMiddleware,\n      webSpeechPonyfillFactory = _ref3.webSpeechPonyfillFactory,\n      composerProps = _objectWithoutProperties(_ref3, _excluded);\n\n  var nonce = composerProps.nonce,\n      onTelemetry = composerProps.onTelemetry;\n  var patchedActivityMiddleware = (0, _react.useMemo)(function () {\n    return [].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(activityMiddleware)), _toConsumableArray((0, _createCoreMiddleware.default)()));\n  }, [activityMiddleware]);\n  var patchedActivityStatusMiddleware = (0, _react.useMemo)(function () {\n    return [].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(activityStatusMiddleware)), _toConsumableArray((0, _createCoreMiddleware2.default)()));\n  }, [activityStatusMiddleware]);\n  var patchedAttachmentForScreenReaderMiddleware = (0, _react.useMemo)(function () {\n    return [].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(attachmentForScreenReaderMiddleware)), _toConsumableArray((0, _createCoreMiddleware3.default)()));\n  }, [attachmentForScreenReaderMiddleware]);\n  var patchedAttachmentMiddleware = (0, _react.useMemo)(function () {\n    return [].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(attachmentMiddleware)), _toConsumableArray((0, _createCoreMiddleware4.default)()));\n  }, [attachmentMiddleware]);\n  var patchedAvatarMiddleware = (0, _react.useMemo)(function () {\n    return [].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(avatarMiddleware)), _toConsumableArray((0, _createCoreMiddleware5.default)()));\n  }, [avatarMiddleware]);\n  var patchedCardActionMiddleware = (0, _react.useMemo)(function () {\n    return [].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(cardActionMiddleware)), _toConsumableArray((0, _createCoreMiddleware6.default)()));\n  }, [cardActionMiddleware]);\n  var patchedToastMiddleware = (0, _react.useMemo)(function () {\n    return [].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(toastMiddleware)), _toConsumableArray((0, _createCoreMiddleware7.default)()));\n  }, [toastMiddleware]);\n  var patchedTypingIndicatorMiddleware = (0, _react.useMemo)(function () {\n    return [].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(typingIndicatorMiddleware)), _toConsumableArray((0, _createCoreMiddleware8.default)()));\n  }, [typingIndicatorMiddleware]);\n  var defaultScrollToEndButtonMiddleware = (0, _react.useMemo)(function () {\n    return (0, _createScrollToEndButtonMiddleware.default)();\n  }, []);\n  var patchedScrollToEndButtonMiddleware = (0, _react.useMemo)(function () {\n    return [].concat(_toConsumableArray((0, _botframeworkWebchatCore.singleToArray)(scrollToEndButtonMiddleware)), _toConsumableArray(defaultScrollToEndButtonMiddleware));\n  }, [defaultScrollToEndButtonMiddleware, scrollToEndButtonMiddleware]);\n  return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_botframeworkWebchatApi.Composer, _extends({\n    activityMiddleware: patchedActivityMiddleware,\n    activityStatusMiddleware: patchedActivityStatusMiddleware,\n    attachmentForScreenReaderMiddleware: patchedAttachmentForScreenReaderMiddleware,\n    attachmentMiddleware: patchedAttachmentMiddleware,\n    avatarMiddleware: patchedAvatarMiddleware,\n    cardActionMiddleware: patchedCardActionMiddleware,\n    downscaleImageToDataURL: _downscaleImageToDataURL.default // Under dev server of create-react-app, \"NODE_ENV\" will be set to \"development\".\n    ,\n    internalErrorBoxClass: node_env === 'development' ? _ErrorBox.default : undefined,\n    nonce: nonce,\n    scrollToEndButtonMiddleware: patchedScrollToEndButtonMiddleware,\n    toastMiddleware: patchedToastMiddleware,\n    typingIndicatorMiddleware: patchedTypingIndicatorMiddleware\n  }, composerProps), /*#__PURE__*/_react.default.createElement(_ActivityTreeComposer.default, null, /*#__PURE__*/_react.default.createElement(ComposerCore, {\n    extraStyleSet: extraStyleSet,\n    nonce: nonce,\n    renderMarkdown: renderMarkdown,\n    styleSet: styleSet,\n    suggestedActionsAccessKey: suggestedActionsAccessKey,\n    webSpeechPonyfillFactory: webSpeechPonyfillFactory\n  }, children, onTelemetry && /*#__PURE__*/_react.default.createElement(_UITracker.default, null)))));\n};\n\nComposer.defaultProps = _objectSpread(_objectSpread(_objectSpread({}, _botframeworkWebchatApi.Composer.defaultProps), ComposerCore.defaultProps), {}, {\n  children: undefined\n});\nComposer.propTypes = _objectSpread(_objectSpread(_objectSpread({}, _botframeworkWebchatApi.Composer.propTypes), ComposerCore.propTypes), {}, {\n  children: _propTypes.default.any\n});\nvar _default = Composer;\nexports.default = _default;","map":{"version":3,"mappings":"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","names":["useGetActivityByKey","hooks","useReferenceGrammarID","useStyleOptions","node_env","undefined","emotionPool","styleSetToEmotionObjects","styleToEmotionObject","styleSet","style","key","ComposerCore","children","extraStyleSet","nonce","renderMarkdown","suggestedActionsAccessKey","webSpeechPonyfillFactory","dictateAbortable","setDictateAbortable","referenceGrammarID","styleOptions","focusSendBoxCallbacksRef","focusTranscriptCallbacksRef","internalMarkdownIt","MarkdownIt","scrollToCallbacksRef","scrollToEndCallbacksRef","scrollRelativeCallbacksRef","dictationOnError","console","error","err","internalRenderMarkdownInline","tree","parseInline","markdown","patchedTree","renderer","render","emotion","css","patchedStyleSet","webSpeechPonyfill","ponyfill","speechSynthesis","SpeechSynthesisUtterance","bypassSpeechSynthesis","BypassSpeechSynthesisUtterance","scrollPositionObserversRef","dispatchScrollPosition","current","forEach","observer","event","observeScrollPosition","filter","target","transcriptFocusObserversRef","numTranscriptFocusObservers","setNumTranscriptFocusObservers","getActivityByKey","dispatchTranscriptFocusByActivityKey","prevActivityKey","Symbol","activityKey","activity","observeTranscriptFocus","length","context","internalMarkdownItState","_react","_reactSay","_WebChatUIContext","Provider","value","_Dictation","onError","defaultProps","propTypes","PropTypes","any","string","func","oneOfType","oneOf","Composer","activityMiddleware","activityStatusMiddleware","attachmentForScreenReaderMiddleware","attachmentMiddleware","avatarMiddleware","cardActionMiddleware","scrollToEndButtonMiddleware","toastMiddleware","typingIndicatorMiddleware","composerProps","onTelemetry","patchedActivityMiddleware","patchedActivityStatusMiddleware","patchedAttachmentForScreenReaderMiddleware","patchedAttachmentMiddleware","patchedAvatarMiddleware","patchedCardActionMiddleware","patchedToastMiddleware","patchedTypingIndicatorMiddleware","defaultScrollToEndButtonMiddleware","patchedScrollToEndButtonMiddleware","Fragment","_botframeworkWebchatApi","downscaleImageToDataURL","internalErrorBoxClass","ErrorBox","_ActivityTreeComposer","_UITracker","APIComposer"],"sources":["/Users/dylanmurray/Sweng-2022/front/node_modules/botframework-webchat-component/lib/src/Composer.tsx"],"sourcesContent":["import {\n  Composer as APIComposer,\n  ComposerProps as APIComposerProps,\n  hooks,\n  WebSpeechPonyfillFactory\n} from 'botframework-webchat-api';\nimport { Composer as SayComposer } from 'react-say';\nimport { singleToArray } from 'botframework-webchat-core';\nimport createEmotion from '@emotion/css/create-instance';\nimport createStyleSet from './Styles/createStyleSet';\nimport MarkdownIt from 'markdown-it';\nimport PropTypes from 'prop-types';\nimport React, { FC, ReactNode, useCallback, useMemo, useRef, useState } from 'react';\n\nimport {\n  speechSynthesis as bypassSpeechSynthesis,\n  SpeechSynthesisUtterance as BypassSpeechSynthesisUtterance\n} from './hooks/internal/BypassSpeechSynthesisPonyfill';\nimport ActivityTreeComposer from './providers/ActivityTree/ActivityTreeComposer';\nimport addTargetBlankToHyperlinksMarkdown from './Utils/addTargetBlankToHyperlinksMarkdown';\nimport createCSSKey from './Utils/createCSSKey';\nimport createDefaultActivityMiddleware from './Middleware/Activity/createCoreMiddleware';\nimport createDefaultActivityStatusMiddleware from './Middleware/ActivityStatus/createCoreMiddleware';\nimport createDefaultAttachmentForScreenReaderMiddleware from './Middleware/AttachmentForScreenReader/createCoreMiddleware';\nimport createDefaultAttachmentMiddleware from './Middleware/Attachment/createCoreMiddleware';\nimport createDefaultAvatarMiddleware from './Middleware/Avatar/createCoreMiddleware';\nimport createDefaultCardActionMiddleware from './Middleware/CardAction/createCoreMiddleware';\nimport createDefaultScrollToEndButtonMiddleware from './Middleware/ScrollToEndButton/createScrollToEndButtonMiddleware';\nimport createDefaultToastMiddleware from './Middleware/Toast/createCoreMiddleware';\nimport createDefaultTypingIndicatorMiddleware from './Middleware/TypingIndicator/createCoreMiddleware';\nimport Dictation from './Dictation';\nimport downscaleImageToDataURL from './Utils/downscaleImageToDataURL';\nimport ErrorBox from './ErrorBox';\nimport mapMap from './Utils/mapMap';\nimport UITracker from './hooks/internal/UITracker';\nimport WebChatUIContext from './hooks/internal/WebChatUIContext';\n\nconst { useGetActivityByKey, useReferenceGrammarID, useStyleOptions } = hooks;\n\nconst node_env = process.env.node_env || process.env.NODE_ENV;\n\nconst emotionPool = {};\n\nfunction styleSetToEmotionObjects(styleToEmotionObject, styleSet) {\n  return mapMap(styleSet, (style, key) => (key === 'options' ? style : styleToEmotionObject(style)));\n}\n\ntype ComposerCoreProps = {\n  children?: ReactNode;\n  extraStyleSet?: any;\n  nonce?: string;\n  renderMarkdown?: (markdown: string, { markdownRespectCRLF: boolean }, { externalLinkAlt: string }) => string;\n  styleSet?: any;\n  suggestedActionsAccessKey?: boolean | string;\n  webSpeechPonyfillFactory?: WebSpeechPonyfillFactory;\n};\n\nconst ComposerCore: FC<ComposerCoreProps> = ({\n  children,\n  extraStyleSet,\n  nonce,\n  renderMarkdown,\n  styleSet,\n  suggestedActionsAccessKey,\n  webSpeechPonyfillFactory\n}) => {\n  const [dictateAbortable, setDictateAbortable] = useState();\n  const [referenceGrammarID] = useReferenceGrammarID();\n  const [styleOptions] = useStyleOptions();\n  const focusSendBoxCallbacksRef = useRef([]);\n  const focusTranscriptCallbacksRef = useRef([]);\n  const internalMarkdownIt = useMemo(() => new MarkdownIt(), []);\n  const scrollToCallbacksRef = useRef([]);\n  const scrollToEndCallbacksRef = useRef([]);\n\n  // Instead of having a `scrollUpCallbacksRef` and `scrollDownCallbacksRef`, they are combined into a single `scrollRelativeCallbacksRef`.\n  // The first argument tells whether it should go \"up\" or \"down\".\n  const scrollRelativeCallbacksRef = useRef([]);\n\n  const dictationOnError = useCallback(err => {\n    console.error(err);\n  }, []);\n\n  const internalRenderMarkdownInline = useMemo(\n    () => markdown => {\n      const tree = internalMarkdownIt.parseInline(markdown);\n\n      // We should add rel=\"noopener noreferrer\" and target=\"_blank\"\n      const patchedTree = addTargetBlankToHyperlinksMarkdown(tree);\n\n      return internalMarkdownIt.renderer.render(patchedTree);\n    },\n    [internalMarkdownIt]\n  );\n\n  const styleToEmotionObject = useMemo(() => {\n    // Emotion doesn't hash with nonce. We need to provide the pooling mechanism.\n    // 1. If 2 instances use different nonce, they should result in different hash;\n    // 2. If 2 instances are being mounted, pooling will make sure we render only 1 set of <style> tags, instead of 2.\n    const emotion =\n      // Prefix \"id-\" to prevent object injection attack.\n      emotionPool[`id-${nonce}`] ||\n      (emotionPool[`id-${nonce}`] = createEmotion({ key: `webchat--css-${createCSSKey()}`, nonce }));\n\n    return style => emotion.css(style);\n  }, [nonce]);\n\n  const patchedStyleSet = useMemo(\n    () =>\n      styleSetToEmotionObjects(styleToEmotionObject, {\n        ...(styleSet || createStyleSet(styleOptions)),\n        ...extraStyleSet\n      }),\n    [extraStyleSet, styleOptions, styleSet, styleToEmotionObject]\n  );\n\n  const webSpeechPonyfill = useMemo(() => {\n    const ponyfill = webSpeechPonyfillFactory && webSpeechPonyfillFactory({ referenceGrammarID });\n    const { speechSynthesis, SpeechSynthesisUtterance } = ponyfill || {};\n\n    return {\n      ...ponyfill,\n      speechSynthesis: speechSynthesis || bypassSpeechSynthesis,\n      SpeechSynthesisUtterance: SpeechSynthesisUtterance || BypassSpeechSynthesisUtterance\n    };\n  }, [referenceGrammarID, webSpeechPonyfillFactory]);\n\n  const scrollPositionObserversRef = useRef([]);\n\n  const dispatchScrollPosition = useCallback(\n    event => scrollPositionObserversRef.current.forEach(observer => observer(event)),\n    [scrollPositionObserversRef]\n  );\n\n  const observeScrollPosition = useCallback(\n    observer => {\n      scrollPositionObserversRef.current = [...scrollPositionObserversRef.current, observer];\n\n      return () => {\n        scrollPositionObserversRef.current = scrollPositionObserversRef.current.filter(target => target !== observer);\n      };\n    },\n    [scrollPositionObserversRef]\n  );\n\n  const transcriptFocusObserversRef = useRef([]);\n  const [numTranscriptFocusObservers, setNumTranscriptFocusObservers] = useState(0);\n\n  const getActivityByKey = useGetActivityByKey();\n\n  const dispatchTranscriptFocusByActivityKey = useMemo(() => {\n    let prevActivityKey: string | Symbol | undefined = Symbol();\n\n    return activityKey => {\n      if (activityKey !== prevActivityKey) {\n        prevActivityKey = activityKey;\n\n        const event = { activity: getActivityByKey(activityKey) };\n\n        transcriptFocusObserversRef.current.forEach(observer => observer(event));\n      }\n    };\n  }, [getActivityByKey, transcriptFocusObserversRef]);\n\n  const observeTranscriptFocus = useCallback(\n    observer => {\n      transcriptFocusObserversRef.current = [...transcriptFocusObserversRef.current, observer];\n      setNumTranscriptFocusObservers(transcriptFocusObserversRef.current.length);\n\n      return () => {\n        transcriptFocusObserversRef.current = transcriptFocusObserversRef.current.filter(target => target !== observer);\n        setNumTranscriptFocusObservers(transcriptFocusObserversRef.current.length);\n      };\n    },\n    [transcriptFocusObserversRef, setNumTranscriptFocusObservers]\n  );\n\n  const context = useMemo(\n    () => ({\n      dictateAbortable,\n      dispatchScrollPosition,\n      dispatchTranscriptFocusByActivityKey,\n      focusSendBoxCallbacksRef,\n      focusTranscriptCallbacksRef,\n      internalMarkdownItState: [internalMarkdownIt],\n      internalRenderMarkdownInline,\n      nonce,\n      numTranscriptFocusObservers,\n      observeScrollPosition,\n      observeTranscriptFocus,\n      renderMarkdown,\n      scrollRelativeCallbacksRef,\n      scrollToCallbacksRef,\n      scrollToEndCallbacksRef,\n      setDictateAbortable,\n      styleSet: patchedStyleSet,\n      styleToEmotionObject,\n      suggestedActionsAccessKey,\n      webSpeechPonyfill\n    }),\n    [\n      dictateAbortable,\n      dispatchScrollPosition,\n      dispatchTranscriptFocusByActivityKey,\n      focusSendBoxCallbacksRef,\n      focusTranscriptCallbacksRef,\n      internalMarkdownIt,\n      internalRenderMarkdownInline,\n      nonce,\n      numTranscriptFocusObservers,\n      observeScrollPosition,\n      observeTranscriptFocus,\n      patchedStyleSet,\n      renderMarkdown,\n      scrollRelativeCallbacksRef,\n      scrollToCallbacksRef,\n      scrollToEndCallbacksRef,\n      setDictateAbortable,\n      styleToEmotionObject,\n      suggestedActionsAccessKey,\n      webSpeechPonyfill\n    ]\n  );\n\n  return (\n    <SayComposer ponyfill={webSpeechPonyfill}>\n      <WebChatUIContext.Provider value={context}>\n        {children}\n        <Dictation onError={dictationOnError} />\n      </WebChatUIContext.Provider>\n    </SayComposer>\n  );\n};\n\nComposerCore.defaultProps = {\n  children: undefined,\n  extraStyleSet: undefined,\n  nonce: undefined,\n  renderMarkdown: undefined,\n  styleSet: undefined,\n  suggestedActionsAccessKey: 'A a Å å',\n  webSpeechPonyfillFactory: undefined\n};\n\nComposerCore.propTypes = {\n  extraStyleSet: PropTypes.any,\n  nonce: PropTypes.string,\n  renderMarkdown: PropTypes.func,\n  styleSet: PropTypes.any,\n  suggestedActionsAccessKey: PropTypes.oneOfType([PropTypes.oneOf([false]), PropTypes.string]),\n  webSpeechPonyfillFactory: PropTypes.func\n};\n\ntype ComposerProps = APIComposerProps &\n  ComposerCoreProps & {\n    nonce?: string;\n    webSpeechPonyfillFactory?: WebSpeechPonyfillFactory;\n  };\n\nconst Composer: FC<ComposerProps> = ({\n  activityMiddleware,\n  activityStatusMiddleware,\n  attachmentForScreenReaderMiddleware,\n  attachmentMiddleware,\n  avatarMiddleware,\n  cardActionMiddleware,\n  children,\n  extraStyleSet,\n  renderMarkdown,\n  scrollToEndButtonMiddleware,\n  styleSet,\n  suggestedActionsAccessKey,\n  toastMiddleware,\n  typingIndicatorMiddleware,\n  webSpeechPonyfillFactory,\n  ...composerProps\n}) => {\n  const { nonce, onTelemetry } = composerProps;\n\n  const patchedActivityMiddleware = useMemo(\n    () => [...singleToArray(activityMiddleware), ...createDefaultActivityMiddleware()],\n    [activityMiddleware]\n  );\n\n  const patchedActivityStatusMiddleware = useMemo(\n    () => [...singleToArray(activityStatusMiddleware), ...createDefaultActivityStatusMiddleware()],\n    [activityStatusMiddleware]\n  );\n\n  const patchedAttachmentForScreenReaderMiddleware = useMemo(\n    () => [\n      ...singleToArray(attachmentForScreenReaderMiddleware),\n      ...createDefaultAttachmentForScreenReaderMiddleware()\n    ],\n    [attachmentForScreenReaderMiddleware]\n  );\n\n  const patchedAttachmentMiddleware = useMemo(\n    () => [...singleToArray(attachmentMiddleware), ...createDefaultAttachmentMiddleware()],\n    [attachmentMiddleware]\n  );\n\n  const patchedAvatarMiddleware = useMemo(\n    () => [...singleToArray(avatarMiddleware), ...createDefaultAvatarMiddleware()],\n    [avatarMiddleware]\n  );\n\n  const patchedCardActionMiddleware = useMemo(\n    () => [...singleToArray(cardActionMiddleware), ...createDefaultCardActionMiddleware()],\n    [cardActionMiddleware]\n  );\n\n  const patchedToastMiddleware = useMemo(\n    () => [...singleToArray(toastMiddleware), ...createDefaultToastMiddleware()],\n    [toastMiddleware]\n  );\n\n  const patchedTypingIndicatorMiddleware = useMemo(\n    () => [...singleToArray(typingIndicatorMiddleware), ...createDefaultTypingIndicatorMiddleware()],\n    [typingIndicatorMiddleware]\n  );\n\n  const defaultScrollToEndButtonMiddleware = useMemo(() => createDefaultScrollToEndButtonMiddleware(), []);\n\n  const patchedScrollToEndButtonMiddleware = useMemo(\n    () => [...singleToArray(scrollToEndButtonMiddleware), ...defaultScrollToEndButtonMiddleware],\n    [defaultScrollToEndButtonMiddleware, scrollToEndButtonMiddleware]\n  );\n\n  return (\n    <React.Fragment>\n      <APIComposer\n        activityMiddleware={patchedActivityMiddleware}\n        activityStatusMiddleware={patchedActivityStatusMiddleware}\n        attachmentForScreenReaderMiddleware={patchedAttachmentForScreenReaderMiddleware}\n        attachmentMiddleware={patchedAttachmentMiddleware}\n        avatarMiddleware={patchedAvatarMiddleware}\n        cardActionMiddleware={patchedCardActionMiddleware}\n        downscaleImageToDataURL={downscaleImageToDataURL}\n        // Under dev server of create-react-app, \"NODE_ENV\" will be set to \"development\".\n        internalErrorBoxClass={node_env === 'development' ? ErrorBox : undefined}\n        nonce={nonce}\n        scrollToEndButtonMiddleware={patchedScrollToEndButtonMiddleware}\n        toastMiddleware={patchedToastMiddleware}\n        typingIndicatorMiddleware={patchedTypingIndicatorMiddleware}\n        {...composerProps}\n      >\n        <ActivityTreeComposer>\n          <ComposerCore\n            extraStyleSet={extraStyleSet}\n            nonce={nonce}\n            renderMarkdown={renderMarkdown}\n            styleSet={styleSet}\n            suggestedActionsAccessKey={suggestedActionsAccessKey}\n            webSpeechPonyfillFactory={webSpeechPonyfillFactory}\n          >\n            {children}\n            {onTelemetry && <UITracker />}\n          </ComposerCore>\n        </ActivityTreeComposer>\n      </APIComposer>\n    </React.Fragment>\n  );\n};\n\nComposer.defaultProps = {\n  ...APIComposer.defaultProps,\n  ...ComposerCore.defaultProps,\n  children: undefined\n};\n\nComposer.propTypes = {\n  ...APIComposer.propTypes,\n  ...ComposerCore.propTypes,\n  children: PropTypes.any\n};\n\nexport default Composer;\n\nexport type { ComposerProps };\n"]},"metadata":{},"sourceType":"script"}