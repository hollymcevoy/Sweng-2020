{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _createCustomEvent = _interopRequireDefault(require(\"./createCustomEvent\"));\n\nvar _createDeferred = _interopRequireDefault(require(\"./createDeferred\"));\n\nvar _createErrorEvent = _interopRequireDefault(require(\"./createErrorEvent\"));\n\nfunction speakUtterance(_x, _x2, _x3) {\n  return _speakUtterance.apply(this, arguments);\n}\n\nfunction _speakUtterance() {\n  _speakUtterance = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(ponyfill, utterance, startCallback) {\n    var speechSynthesis, startDeferred, errorDeferred, endDeferred, startEvent, finishedSpeaking, endPromise, endEvent;\n    return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            speechSynthesis = ponyfill.speechSynthesis;\n            startDeferred = (0, _createDeferred[\"default\"])();\n            errorDeferred = (0, _createDeferred[\"default\"])();\n            endDeferred = (0, _createDeferred[\"default\"])();\n            utterance.addEventListener('end', endDeferred.resolve);\n            utterance.addEventListener('error', errorDeferred.resolve);\n            utterance.addEventListener('start', startDeferred.resolve); // if (speechSynthesis.speaking) {\n            //   console.warn(`ASSERTION: speechSynthesis.speaking should not be truthy before we call speak`);\n            // }\n\n            speechSynthesis.speak(utterance);\n            _context4.next = 10;\n            return Promise.race([errorDeferred.promise, startDeferred.promise]);\n\n          case 10:\n            startEvent = _context4.sent;\n\n            if (!(startEvent.type === 'error')) {\n              _context4.next = 13;\n              break;\n            }\n\n            throw startEvent.error;\n\n          case 13:\n            endPromise = Promise.race([errorDeferred.promise, endDeferred.promise]);\n            startCallback && startCallback( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n              return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      if (finishedSpeaking) {\n                        _context3.next = 4;\n                        break;\n                      }\n\n                      speechSynthesis.cancel();\n                      _context3.next = 4;\n                      return endPromise;\n\n                    case 4:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, _callee3);\n            })));\n            _context4.next = 17;\n            return endPromise;\n\n          case 17:\n            endEvent = _context4.sent;\n            finishedSpeaking = true; // if (speechSynthesis.speaking) {\n            //   console.warn(`ASSERTION: speechSynthesis.speaking should not be truthy after speak is stopped`);\n            // }\n            // console.debug(`ENDED: ${ utterance.text }`);\n\n            if (!(endEvent.type === 'error')) {\n              _context4.next = 21;\n              break;\n            }\n\n            throw endEvent.error;\n\n          case 21:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n  return _speakUtterance.apply(this, arguments);\n}\n\nvar QueuedUtterance = /*#__PURE__*/function () {\n  function QueuedUtterance(ponyfill, utterance, _ref) {\n    var onEnd = _ref.onEnd,\n        onError = _ref.onError,\n        onStart = _ref.onStart;\n    (0, _classCallCheck2[\"default\"])(this, QueuedUtterance);\n    this._cancelled = false;\n    this._deferred = (0, _createDeferred[\"default\"])();\n    this._onEnd = onEnd;\n    this._onError = onError;\n    this._onStart = onStart;\n    this._ponyfill = ponyfill;\n    this._speaking = false;\n    this._utterance = utterance;\n    this.promise = this._deferred.promise;\n  }\n\n  (0, _createClass2[\"default\"])(QueuedUtterance, [{\n    key: \"cancel\",\n    value: function () {\n      var _cancel = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this._cancelled = true;\n                _context.t0 = this._cancel;\n\n                if (!_context.t0) {\n                  _context.next = 5;\n                  break;\n                }\n\n                _context.next = 5;\n                return this._cancel();\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function cancel() {\n        return _cancel.apply(this, arguments);\n      }\n\n      return cancel;\n    }()\n  }, {\n    key: \"speak\",\n    value: function speak() {\n      var _this = this;\n\n      if (this._speaking) {\n        console.warn(\"ASSERTION: QueuedUtterance is already speaking or has spoken.\");\n      }\n\n      this._speaking = true;\n      (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!_this._cancelled) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                throw new Error('cancelled');\n\n              case 2:\n                _context2.next = 4;\n                return speakUtterance(_this._ponyfill, _this._utterance, function (cancel) {\n                  if (_this._cancelled) {\n                    cancel();\n                    throw new Error('cancelled');\n                  } else {\n                    _this._cancel = cancel;\n                    _this._onStart && _this._onStart((0, _createCustomEvent[\"default\"])('start'));\n                  }\n                });\n\n              case 4:\n                if (!_this._cancelled) {\n                  _context2.next = 6;\n                  break;\n                }\n\n                throw new Error('cancelled');\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))().then(function () {\n        _this._onEnd && _this._onEnd((0, _createCustomEvent[\"default\"])('end'));\n\n        _this._deferred.resolve();\n      }, function (error) {\n        _this._onError && _this._onError((0, _createErrorEvent[\"default\"])(error));\n\n        _this._deferred.reject(error);\n      });\n      return this.promise;\n    }\n  }]);\n  return QueuedUtterance;\n}();\n\nexports[\"default\"] = QueuedUtterance;","map":{"version":3,"mappings":"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","names":["speakUtterance","ponyfill","utterance","startCallback","speechSynthesis","startDeferred","errorDeferred","endDeferred","addEventListener","resolve","speak","_context4","Promise","race","promise","startEvent","type","error","endPromise","finishedSpeaking","_context3","cancel","endEvent","QueuedUtterance","onEnd","onError","onStart","_cancelled","_deferred","_onEnd","_onError","_onStart","_ponyfill","_speaking","_utterance","_context","_cancel","console","warn","_this","_context2","Error","then","reject"],"sources":["/Users/dylanmurray/Sweng-2022/front/node_modules/react-say/src/QueuedUtterance.js"],"sourcesContent":["import createCustomEvent from './createCustomEvent';\nimport createDeferred from './createDeferred';\nimport createErrorEvent from './createErrorEvent';\n\nasync function speakUtterance(ponyfill, utterance, startCallback) {\n  const { speechSynthesis } = ponyfill;\n\n  const startDeferred = createDeferred();\n  const errorDeferred = createDeferred();\n  const endDeferred = createDeferred();\n\n  utterance.addEventListener('end', endDeferred.resolve);\n  utterance.addEventListener('error', errorDeferred.resolve);\n  utterance.addEventListener('start', startDeferred.resolve);\n\n  // if (speechSynthesis.speaking) {\n  //   console.warn(`ASSERTION: speechSynthesis.speaking should not be truthy before we call speak`);\n  // }\n\n  speechSynthesis.speak(utterance);\n\n  const startEvent = await Promise.race([\n    errorDeferred.promise,\n    startDeferred.promise\n  ]);\n\n  if (startEvent.type === 'error') {\n    throw startEvent.error;\n  }\n\n  let finishedSpeaking;\n  const endPromise = Promise.race([\n    errorDeferred.promise,\n    endDeferred.promise\n  ]);\n\n  startCallback && startCallback(async () => {\n    if (!finishedSpeaking) {\n      speechSynthesis.cancel();\n      await endPromise;\n    }\n  });\n\n  const endEvent = await endPromise;\n\n  finishedSpeaking = true;\n\n  // if (speechSynthesis.speaking) {\n  //   console.warn(`ASSERTION: speechSynthesis.speaking should not be truthy after speak is stopped`);\n  // }\n\n  // console.debug(`ENDED: ${ utterance.text }`);\n\n  if (endEvent.type === 'error') {\n    throw endEvent.error;\n  }\n}\n\nexport default class QueuedUtterance {\n  constructor(ponyfill, utterance, { onEnd, onError, onStart }) {\n    this._cancelled = false;\n    this._deferred = createDeferred();\n    this._onEnd = onEnd;\n    this._onError = onError;\n    this._onStart = onStart;\n    this._ponyfill = ponyfill;\n    this._speaking = false;\n    this._utterance = utterance;\n\n    this.promise = this._deferred.promise;\n  }\n\n  async cancel() {\n    this._cancelled = true;\n    this._cancel && await this._cancel();\n  }\n\n  speak() {\n    if (this._speaking) {\n      console.warn(`ASSERTION: QueuedUtterance is already speaking or has spoken.`);\n    }\n\n    this._speaking = true;\n\n    (async () => {\n      if (this._cancelled) {\n        throw new Error('cancelled');\n      }\n\n      await speakUtterance(this._ponyfill, this._utterance, cancel => {\n        if (this._cancelled) {\n          cancel();\n\n          throw new Error('cancelled');\n        } else {\n          this._cancel = cancel;\n          this._onStart && this._onStart(createCustomEvent('start'));\n        }\n      });\n\n      if (this._cancelled) {\n        throw new Error('cancelled');\n      }\n    })().then(() => {\n      this._onEnd && this._onEnd(createCustomEvent('end'));\n      this._deferred.resolve();\n    }, error => {\n      this._onError && this._onError(createErrorEvent(error));\n      this._deferred.reject(error);\n    });\n\n    return this.promise;\n  }\n}\n"]},"metadata":{},"sourceType":"script"}