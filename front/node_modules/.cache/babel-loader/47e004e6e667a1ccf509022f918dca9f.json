{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/dylanmurray/Sweng-2022/front/node_modules/@babel/runtime/regenerator/index.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = useSendFiles;\n\nvar _botframeworkWebchatApi = require(\"botframework-webchat-api\");\n\nvar _react = require(\"react\");\n\nvar _index = _interopRequireDefault(require(\"../Utils/downscaleImageToDataURL/index\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nvar useAPISendFiles = _botframeworkWebchatApi.hooks.useSendFiles,\n    useStyleOptions = _botframeworkWebchatApi.hooks.useStyleOptions,\n    useTrackTiming = _botframeworkWebchatApi.hooks.useTrackTiming;\n\nfunction canMakeThumbnail(_ref) {\n  var name = _ref.name;\n  return /\\.(gif|jpe?g|png)$/i.test(name);\n}\n\nfunction makeThumbnail(_x, _x2, _x3, _x4, _x5) {\n  return _makeThumbnail.apply(this, arguments);\n}\n\nfunction _makeThumbnail() {\n  _makeThumbnail = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(file, width, height, contentType, quality) {\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return (0, _index.default)(file, width, height, contentType, quality);\n\n          case 3:\n            return _context3.abrupt(\"return\", _context3.sent);\n\n          case 6:\n            _context3.prev = 6;\n            _context3.t0 = _context3[\"catch\"](0);\n            console.warn(\"Web Chat: Failed to downscale image due to \".concat(_context3.t0, \".\"));\n\n          case 9:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[0, 6]]);\n  }));\n  return _makeThumbnail.apply(this, arguments);\n}\n\nfunction useSendFiles() {\n  var sendFiles = useAPISendFiles();\n\n  var _useStyleOptions = useStyleOptions(),\n      _useStyleOptions2 = _slicedToArray(_useStyleOptions, 1),\n      _useStyleOptions2$ = _useStyleOptions2[0],\n      enableUploadThumbnail = _useStyleOptions2$.enableUploadThumbnail,\n      uploadThumbnailContentType = _useStyleOptions2$.uploadThumbnailContentType,\n      uploadThumbnailHeight = _useStyleOptions2$.uploadThumbnailHeight,\n      uploadThumbnailQuality = _useStyleOptions2$.uploadThumbnailQuality,\n      uploadThumbnailWidth = _useStyleOptions2$.uploadThumbnailWidth;\n\n  var trackTiming = useTrackTiming();\n  return (0, _react.useCallback)( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(files) {\n      var attachments;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(files && files.length)) {\n                _context2.next = 6;\n                break;\n              }\n\n              files = [].slice.call(files); // TODO: [P3] We need to find revokeObjectURL on the UI side\n              //       Redux store should not know about the browser environment\n              //       One fix is to use ArrayBuffer instead of object URL, but that would requires change to DirectLineJS\n\n              _context2.next = 4;\n              return Promise.all([].map.call(files, /*#__PURE__*/function () {\n                var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(file) {\n                  var thumbnail;\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          if (!(_index.default && enableUploadThumbnail && canMakeThumbnail(file))) {\n                            _context.next = 4;\n                            break;\n                          }\n\n                          _context.next = 3;\n                          return trackTiming('sendFiles:makeThumbnail', makeThumbnail(file, uploadThumbnailWidth, uploadThumbnailHeight, uploadThumbnailContentType, uploadThumbnailQuality));\n\n                        case 3:\n                          thumbnail = _context.sent;\n\n                        case 4:\n                          return _context.abrupt(\"return\", _objectSpread({\n                            name: file.name,\n                            size: file.size,\n                            url: window.URL.createObjectURL(file)\n                          }, thumbnail && {\n                            thumbnail: thumbnail\n                          }));\n\n                        case 5:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                }));\n\n                return function (_x7) {\n                  return _ref3.apply(this, arguments);\n                };\n              }()));\n\n            case 4:\n              attachments = _context2.sent;\n              sendFiles(attachments);\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x6) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [enableUploadThumbnail, sendFiles, trackTiming, uploadThumbnailContentType, uploadThumbnailHeight, uploadThumbnailQuality, uploadThumbnailWidth]);\n}","map":{"version":3,"mappings":";;;;;;;;;AAGA;;AACA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAsBA,eAAtB,GAA2EC,8BAAnEC,YAAR;AAAA,IAAuCC,eAAvC,GAA2EF,8BAApCE,eAAvC;AAAA,IAAwDC,cAAxD,GAA2EH,8BAAnBG,cAAxD;;AAEA,SAASC,gBAAT,OAAoC;AAAA,MAARC,IAAQ,QAARA,IAAQ;AAClC,SAAO,sBAAuBC,IAAvB,CAA4BD,IAA5B,CAAP;AACD;;SAEcE,c;;;;;4EAAf,kBAA6BC,IAA7B,EAAmCC,KAAnC,EAA0CC,MAA1C,EAAkDC,WAAlD,EAA+DC,OAA/D;AAAA;AAAA;AAAA;AAAA;AAAAC;AAAAA;AAAA,mBAEiB,oBAAwBL,IAAxB,EAA8BC,KAA9B,EAAqCC,MAArC,EAA6CC,WAA7C,EAA0DC,OAA1D,CAFjB;;AAAA;AAAA;;AAAA;AAAAC;AAAAA;AAIIC,mBAAO,CAACC,IAARD;;AAJJ;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;AAQe,SAASb,YAAT,GAAiD;AAC9D,MAAMe,SAAS,GAAGjB,eAAe,EAAjC;;AACA,yBAQIG,eAAe,EARnB;AAAA;AAAA;AAAA,MAEIe,qBAFJ,sBAEIA,qBAFJ;AAAA,MAGIC,0BAHJ,sBAGIA,0BAHJ;AAAA,MAIIC,qBAJJ,sBAIIA,qBAJJ;AAAA,MAKIC,sBALJ,sBAKIA,sBALJ;AAAA,MAMIC,oBANJ,sBAMIA,oBANJ;;AASA,MAAMC,WAAW,GAAGnB,cAAc,EAAlC;AAEA,SAAO;AAAA,yEACL,kBAAMoB,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACMA,KAAK,IAAIA,KAAK,CAACC,MADrB;AAAAC;AAAA;AAAA;;AAEIF,mBAAK,GAAG,GAAGG,KAAH,CAASC,IAAT,CAAcJ,KAAd,CAARA,CAFJ,CAII;AACA;AACA;;AANJE;AAAA,qBAOsDG,OAAO,CAACC,GAARD,CAChD,GAAGE,GAAH,CAAOH,IAAP,CAAYJ,KAAZ;AAAA,qFAAmB,iBAAMf,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCAGbuB,kBAA2Bd,qBAA3Bc,IAAoD3B,gBAAgB,CAACI,IAAD,CAHvD;AAAAwB;AAAA;AAAA;;AAAAA;AAAA,iCAIGV,WAAW,CAC3B,yBAD2B,EAE3Bf,aAAa,CACXC,IADW,EAEXa,oBAFW,EAGXF,qBAHW,EAIXD,0BAJW,EAKXE,sBALW,CAFc,CAJd;;AAAA;AAIfa,mCAJe,gBAIfA;;AAJe;AAAA;AAiBf5B,gCAAI,EAAEG,IAAI,CAACH,IAjBI;AAkBf6B,gCAAI,EAAE1B,IAAI,CAAC0B,IAlBI;AAmBfC,+BAAG,EAAEC,MAAM,CAACC,GAAPD,CAAWE,eAAXF,CAA2B5B,IAA3B4B;AAnBU,6BAoBXH,SAAS,IAAI;AAAEA,qCAAS,EAATA;AAAF,2BApBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAnB;;AAAA;AAAA;AAAA;AAAA,kBADgDL,CAPtD;;AAAA;AAOUW,yBAPV,iBAOUA;AA0BNvB,uBAAS,CAACuB,WAAD,CAATvB;;AAjCJ;AAAA;AAAA;AAAA;AAAA;AAAA;AADK;;AAAA;AAAA;AAAA;AAAA,OAqCL,CACEC,qBADF,EAEED,SAFF,EAGEM,WAHF,EAIEJ,0BAJF,EAKEC,qBALF,EAMEC,sBANF,EAOEC,oBAPF,CArCK,CAAP;AA+CD","names":["useAPISendFiles","hooks","useSendFiles","useStyleOptions","useTrackTiming","canMakeThumbnail","name","test","makeThumbnail","file","width","height","contentType","quality","_context3","console","warn","sendFiles","enableUploadThumbnail","uploadThumbnailContentType","uploadThumbnailHeight","uploadThumbnailQuality","uploadThumbnailWidth","trackTiming","files","length","_context2","slice","call","Promise","all","map","downscaleImageToDataURL","_context","thumbnail","size","url","window","URL","createObjectURL","attachments"],"sources":["/Users/dylanmurray/Sweng-2022/front/node_modules/botframework-webchat-component/lib/src/hooks/useSendFiles.ts"],"sourcesContent":["/* eslint no-magic-numbers: [\"error\", { \"ignore\": [0, 1024] }] */\n\nimport { DirectLineAttachment } from 'botframework-webchat-core';\nimport { hooks } from 'botframework-webchat-api';\nimport { useCallback } from 'react';\n\nimport downscaleImageToDataURL from '../Utils/downscaleImageToDataURL/index';\n\nconst { useSendFiles: useAPISendFiles, useStyleOptions, useTrackTiming } = hooks;\n\nfunction canMakeThumbnail({ name }) {\n  return /\\.(gif|jpe?g|png)$/iu.test(name);\n}\n\nasync function makeThumbnail(file, width, height, contentType, quality) {\n  try {\n    return await downscaleImageToDataURL(file, width, height, contentType, quality);\n  } catch (error) {\n    console.warn(`Web Chat: Failed to downscale image due to ${error}.`);\n  }\n}\n\nexport default function useSendFiles(): (files: File[]) => void {\n  const sendFiles = useAPISendFiles();\n  const [\n    {\n      enableUploadThumbnail,\n      uploadThumbnailContentType,\n      uploadThumbnailHeight,\n      uploadThumbnailQuality,\n      uploadThumbnailWidth\n    }\n  ] = useStyleOptions();\n  const trackTiming = useTrackTiming();\n\n  return useCallback(\n    async files => {\n      if (files && files.length) {\n        files = [].slice.call(files);\n\n        // TODO: [P3] We need to find revokeObjectURL on the UI side\n        //       Redux store should not know about the browser environment\n        //       One fix is to use ArrayBuffer instead of object URL, but that would requires change to DirectLineJS\n        const attachments: DirectLineAttachment[] = await Promise.all(\n          [].map.call(files, async file => {\n            let thumbnail;\n\n            if (downscaleImageToDataURL && enableUploadThumbnail && canMakeThumbnail(file)) {\n              thumbnail = await trackTiming(\n                'sendFiles:makeThumbnail',\n                makeThumbnail(\n                  file,\n                  uploadThumbnailWidth,\n                  uploadThumbnailHeight,\n                  uploadThumbnailContentType,\n                  uploadThumbnailQuality\n                )\n              );\n            }\n\n            return {\n              name: file.name,\n              size: file.size,\n              url: window.URL.createObjectURL(file),\n              ...(thumbnail && { thumbnail })\n            };\n          })\n        );\n\n        sendFiles(attachments);\n      }\n    },\n    [\n      enableUploadThumbnail,\n      sendFiles,\n      trackTiming,\n      uploadThumbnailContentType,\n      uploadThumbnailHeight,\n      uploadThumbnailQuality,\n      uploadThumbnailWidth\n    ]\n  );\n}\n"]},"metadata":{},"sourceType":"script"}